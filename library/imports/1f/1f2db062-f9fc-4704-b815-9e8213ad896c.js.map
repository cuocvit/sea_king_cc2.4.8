{"version":3,"sources":["assets\\start-scene\\scripts\\ShipMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { BuildTypeEnum, HeroTypeEnum } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { Utils } from './Utils';\r\nimport { TempData } from './TempData';\r\nimport { NodePoolItem } from './NodePoolItem';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass ShipMgr extends NodePoolItem {\r\n    @property(cc.Node)\r\n    private caseNode: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private normalBattle: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private rewardBattle: cc.Node | null = null;\r\n\r\n    @property(cc.Button)\r\n    private btnShip: cc.Button | null = null;\r\n\r\n    protected onLoad(): void {\r\n        gm.ui.on(\"ship_goods_change\", this.refreshItem, this);\r\n        gm.ui.on(\"ship_play_anim\", this.shipPlayAnim, this);\r\n        this.node.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED, this.playAnimFinishCb, this);\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        this.btnShip.interactable = true;\r\n        this.normalBattle.getComponent(cc.Button).interactable = true;\r\n        this.rewardBattle.getComponent(cc.Button).interactable = true;\r\n        this.refreshItem();\r\n        if (!(this.node.getComponent(cc.Animation).getAnimationState(\"ship_out\").isPlaying ||\r\n            this.node.getComponent(cc.Animation).getAnimationState(\"ship_in\").isPlaying)) {\r\n            this.node.getComponent(cc.Animation).play(\"ship_normal\");\r\n        }\r\n    }\r\n\r\n    private playAnimFinishCb(animation: string, event: { name: string }): void {\r\n        this.btnShip.interactable = true;\r\n        this.normalBattle.getComponent(cc.Button).interactable = true;\r\n        this.rewardBattle.getComponent(cc.Button).interactable = true;\r\n        if (\"ship_out\" == event.name) {\r\n            this.shipOutFight();\r\n        } else if (\"ship_in\" == event.name) {\r\n            this.shipInGetGoods();\r\n        }\r\n    }\r\n\r\n    private shipOutFight(): void {\r\n        const mapType = TempData.map_type;\r\n        cc.log(mapType + \"          mapType\");\r\n        if (1 == mapType) {\r\n            gm.data.fight_temp_data.match_fight();\r\n        } else if (2 == mapType) {\r\n            if (gm.data.fight_temp_data.match_caves_map()) {\r\n                gm.ui.show_fight();\r\n            } else {\r\n                gm.ui.show_notice(\"Đã đạt cấp độ cao nhất, hãy chờ cấp độ tiếp theo!\");\r\n            }\r\n        } else if (3 == mapType) {\r\n            gm.data.fight_temp_data.match_happy_map();\r\n            gm.ui.show_fight();\r\n        }\r\n    }\r\n\r\n    private shipInGetGoods(): void {\r\n        const tempHeroArray = gm.data.fight_temp_data.battle_hero_array;\r\n        const deathHeroDataArray = gm.data.fight_temp_data.fight_result_data.death_hero_data_array;\r\n        const aliveHeroDataArray = gm.data.fight_temp_data.fight_result_data.alive_hero_data_array;\r\n\r\n        deathHeroDataArray.length;\r\n        if (!gm.data.mapCell_data.isGuide) {\r\n            const towerData = gm.data.mapCell_data.getBuildDataByType(BuildTypeEnum.TOWER_TYPE);\r\n            if (towerData && 2 <= towerData.buildLvl && gm.data.fight_data.fight_count % 2 == 0) {\r\n                gm.ui.show_panel(gm.const.SuperRecruit);\r\n            }\r\n        }\r\n\r\n        if (2 < gm.data.fight_data.fight_count && gm.data.fight_data.fight_count % 3 == 1 && !gm.data.mapCell_data.guideGift.guideIsGet) {\r\n            gm.ui.show_panel(gm.const.GUIDEGIFT);\r\n        }\r\n\r\n        if (gm.data.server_data.has_new_defense_log) {\r\n            gm.ui.show_panel(gm.const.MailLogNotice);\r\n            gm.data.server_data.has_new_defense_log = false;\r\n            gm.data.server_data.mail_red_point = false;\r\n        }\r\n\r\n        for (let heroIndex = 0; heroIndex < tempHeroArray.length; heroIndex++) {\r\n            gm.ui.emit(\"set_item_battle_hero_operty\", tempHeroArray[heroIndex].cellID, true);\r\n            if (0 < deathHeroDataArray.length) {\r\n                for (let deadHeroIndex = deathHeroDataArray.length - 1; 0 <= deadHeroIndex; deadHeroIndex--) {\r\n                    if (deathHeroDataArray[deadHeroIndex].id == tempHeroArray[heroIndex].itemID) {\r\n                        const heroConfig = gm.data.config_data.getHeroCfgByID(deathHeroDataArray[deadHeroIndex].id);\r\n                        if (heroConfig) {\r\n                            if (heroConfig.hero_type == HeroTypeEnum.SUPER_HERO_TYPE) {\r\n                                gm.data.mapCell_data.addSuperHeroData(tempHeroArray[heroIndex].itemID, tempHeroArray[heroIndex].cellID, 0);\r\n                                gm.ui.emit(\"item_children_refresh\", tempHeroArray[heroIndex].cellID);\r\n                                deathHeroDataArray.splice(deadHeroIndex, 1);\r\n                                gm.ui.set_module_args(gm.const.SUPERHEROOP.key, [tempHeroArray[heroIndex].itemID, tempHeroArray[heroIndex].cellID, false]);\r\n                                gm.ui.async_show_module(gm.const.SUPERHEROOP)\r\n\r\n                            } else {\r\n                                gm.data.mapCell_data.delCellItemByCellID(tempHeroArray[heroIndex].cellID);\r\n                                gm.ui.emit(\"item_children_refresh\", tempHeroArray[heroIndex].cellID), deathHeroDataArray.splice(deadHeroIndex, 1);\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let aliveHeroIndex = 0; aliveHeroIndex < aliveHeroDataArray.length; aliveHeroIndex++) {\r\n            const aliveHero = aliveHeroDataArray[aliveHeroIndex];\r\n            if (aliveHero && aliveHero.hero_type == HeroTypeEnum.SUPER_HERO_TYPE) {\r\n                for (let battleHeroIndex = 0; battleHeroIndex < tempHeroArray.length; battleHeroIndex++) {\r\n                    const battleHero = tempHeroArray[battleHeroIndex];\r\n                    if (aliveHero.id == battleHero.itemID) {\r\n                        gm.data.mapCell_data.addSuperHeroData(battleHero.itemID, battleHero.cellID, aliveHero.hp);\r\n                        gm.ui.emit(\"item_children_refresh\", battleHero.cellID);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        gm.data.fight_temp_data.get_all_result_data();\r\n        this.refreshItem();\r\n        this.node.getComponent(cc.Animation).play(\"ship_normal\");\r\n    }\r\n\r\n    public refreshItem(): void {\r\n        this.caseNode.active = false;\r\n        this.rewardBattle.active = false;\r\n        this.normalBattle.active = false;\r\n\r\n        if (gm.data.mapCell_data.buildData[BuildTypeEnum.SEAGOINGBOAT_TYPE] && gm.data.mapCell_data.buildData[BuildTypeEnum.SEAGOINGBOAT_TYPE].buildLvl > 0) {\r\n            this.caseNode.active = gm.data.mapCell_data._warehouseList.length > 0;\r\n            if (!gm.data.mapCell_data.isGuide && gm.data.mapCell_data.isFirstBattle) {\r\n                this.rewardBattle.active = true;\r\n            } else {\r\n                this.normalBattle.active = true;\r\n            }\r\n\r\n            if (this.caseNode?.active) {\r\n                Utils.set_sprite_state(this.normalBattle, cc.Sprite.State.GRAY);\r\n            } else {\r\n                Utils.set_sprite_state(this.normalBattle, cc.Sprite.State.NORMAL);\r\n            }\r\n        }\r\n    }\r\n\r\n    public onClickShip(): void {\r\n        if (gm.data.mapCell_data.isGuide && gm.data.mapCell_data.roleGuideVO.guideID != 13) {\r\n            return;\r\n        }\r\n        if (this.caseNode?.active) {\r\n            gm.ui.show_notice(\"Hãy dỡ hàng trên tàu trước khi chiến đấu!\");\r\n        } else if (gm.data.mapCell_data.buildData[BuildTypeEnum.SEAGOINGBOAT_TYPE] && gm.data.mapCell_data.buildData[BuildTypeEnum.SEAGOINGBOAT_TYPE].buildLvl > 0) {\r\n            if (gm.data.mapCell_data.isGuide) {\r\n                gm.channel.report_event(\"ohayoo_game_guide\", {\r\n                    guideid: 10,\r\n                    guidedesc: cc.js.formatStr(\"10.Nhấp vào nút Đột kích trên tàu\")\r\n                });\r\n                gm.ui.mapMainUI.checkHandAnimDelay();\r\n            }\r\n            const t: number = !gm.data.mapCell_data.isGuide && gm.data.mapCell_data.isFirstBattle ? 3 : 1;\r\n            gm.ui.set_module_args(gm.const.GOBATTLE.key, t);\r\n            gm.ui.async_show_module(gm.const.GOBATTLE);\r\n        }\r\n    }\r\n\r\n    public revenge(targetUid: string): void {\r\n        if (this.caseNode?.active) {\r\n            gm.ui.show_notice(\"Hãy dỡ hàng trên tàu trước khi chiến đấu!\");\r\n        } else if (gm.data.mapCell_data.buildData[BuildTypeEnum.SEAGOINGBOAT_TYPE] && gm.data.mapCell_data.buildData[BuildTypeEnum.SEAGOINGBOAT_TYPE].buildLvl > 0) {\r\n            gm.data.mail_temp_data.target_uid = targetUid;\r\n            gm.ui.set_module_args(gm.const.GOBATTLE.key, 1);\r\n            gm.ui.async_show_module(gm.const.GOBATTLE);\r\n        }\r\n    }\r\n\r\n    private shipPlayAnim(animType: number): void {\r\n        if (animType == 1) {\r\n            this.btnShip.interactable = false;\r\n            this.normalBattle.getComponent(cc.Button).interactable = false;\r\n            this.rewardBattle.getComponent(cc.Button).interactable = false;\r\n            this.node.getComponent(cc.Animation).play(\"ship_out\");\r\n        } else if (animType == 2) {\r\n            this.btnShip.interactable = false;\r\n            this.normalBattle.getComponent(cc.Button).interactable = false;\r\n            this.rewardBattle.getComponent(cc.Button).interactable = false;\r\n            this.node.getComponent(cc.Animation).play(\"ship_in\");\r\n        }\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        gm.ui.off(\"ship_goods_change\", this.refreshItem, this);\r\n        gm.ui.off(\"ship_play_anim\", this.shipPlayAnim, this);\r\n        this.node.getComponent(cc.Animation).off(cc.Animation.EventType.FINISHED, this.playAnimFinishCb, this);\r\n    }\r\n}\r\n\r\nexport default ShipMgr;\r\n"]}