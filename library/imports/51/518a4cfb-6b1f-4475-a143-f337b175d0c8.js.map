{"version":3,"sources":["assets\\start-scene\\scripts\\ItemFly.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { NodePoolItem } from './NodePoolItem';\r\nimport { ItemTypeEnum, BundleName } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { Utils } from './Utils';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class ItemFly extends NodePoolItem {\r\n    private _start_pos: cc.Vec3 = new cc.Vec3(0, 0);\r\n    private _target_pos: cc.Vec3 = new cc.Vec3(-300, 500);\r\n\r\n    protected onEnable(): void {\r\n        this.node.zIndex = gm.const.MAX_CELL_NUM + 4;\r\n        this.do_node_anim();\r\n    }\r\n\r\n    public init_fly_anim(itemId: number, startPos: cc.Vec3, targetPos: cc.Vec3 | null = null): void {\r\n        const itemType = 3e4 < itemId ? ItemTypeEnum.HERO_TYPE : ItemTypeEnum.ITEM_TYPE;\r\n        if (itemType == ItemTypeEnum.HERO_TYPE) {\r\n            const heroConfig = gm.data.config_data.getHeroCfgByID(itemId)\r\n            if (heroConfig) {\r\n                gm.pool.async_get(BundleName.COMMON, \"prefabs/model/\" + heroConfig.heroid, NodePoolItem, (t) => {\r\n                    console.log(\"hero node\", this.node.childrenCount);\r\n                    if (0 == this.node.childrenCount) {\r\n                        this.node.addChild(t.node);\r\n                        t.node.x = 0;\r\n                        t.node.y = -15;\r\n                        if (t.getComponent(sp.Skeleton)) {\r\n                            t.getComponent(sp.Skeleton).setSkin(\"front\");\r\n                            t.getComponent(sp.Skeleton).setAnimation(0, \"stay\", true);\r\n                        }\r\n                    } else {\r\n                        gm.pool.put(t.node);\r\n                    }\r\n                });\r\n            }\r\n        } else if (!(itemType != ItemTypeEnum.ITEM_TYPE)) {\r\n            const itemConfig = gm.data.config_data.getItemCfgByID(itemId)\r\n            if (itemConfig) {\r\n                Utils.async_set_sprite_frame(this.node.getComponent(cc.Sprite), BundleName.MAP, \"res/\" + itemConfig.icon);\r\n            }\r\n        }\r\n\r\n        this._start_pos = gm.ui.mapMainUI.mapContent.convertToNodeSpaceAR(startPos);\r\n        this._target_pos = gm.ui.mapMainUI.mapContent.convertToNodeSpaceAR(targetPos)\r\n    }\r\n\r\n    private do_node_anim(): void {\r\n        this.node.active = true;\r\n        this.node.setPosition(cc.v2(this._start_pos.x, this._start_pos.y));\r\n        this.node.scale = gm.ui.mapMainUI.mapContent.scale;\r\n\r\n        const moveAction = cc.moveTo(.3, this._target_pos.x, this._target_pos.y);\r\n        this.node.runAction(cc.sequence(moveAction, cc.callFunc(() => {\r\n            gm.pool.put_children(this.node);\r\n            gm.pool.put(this.node);\r\n        })))\r\n    }\r\n}"]}