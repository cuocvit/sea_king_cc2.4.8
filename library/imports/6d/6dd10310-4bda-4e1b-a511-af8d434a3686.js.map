{"version":3,"sources":["assets\\start-scene\\scripts\\MapBuildUpgrade.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { Utils } from './Utils';\r\nimport { BundleName, RewardIdEnum, SetItemNumEnum, BuildTypeEnum } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { ReportData } from './NetUtils';\r\nimport { Build } from '../../common/configs/build';\r\nimport { BuildData } from './MapCellCfgData';\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class MapBuildUpgrade extends cc.Component {\r\n    @property(cc.Label)\r\n    private lblName: cc.Label | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblNextLvl: cc.Label | null = null;\r\n\r\n    @property([cc.Node])\r\n    private meterialNode: cc.Node[] = [];\r\n\r\n    @property(cc.Label)\r\n    private lblBuildName: cc.Label | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblCoin: cc.Label | null = null;\r\n\r\n    @property([cc.SpriteFrame])\r\n    private btnSprList: cc.SpriteFrame[] = [];\r\n\r\n    @property(cc.Sprite)\r\n    private btnSpr: cc.Sprite | null = null;\r\n\r\n    private _curBuildCfg: Build | null = null;\r\n    private _buildData: BuildData | null = null;\r\n    private _matraEnough: boolean = true;\r\n    private _tempList: number[] = [];\r\n\r\n    public initData(buildId: number, cellID?: number): void {\r\n        this._curBuildCfg = gm.data.config_data.getBuildCfgByID(buildId);\r\n        this._buildData = gm.data.mapCell_data.getBuildDataByType(this._curBuildCfg.buildType);\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        gm.ui.on(\"coin_change\", this.refreshCoin, this);\r\n        gm.ui.on(\"build_metarail_change\", this.refreshPanel, this);\r\n        gm.ui.on(\"update_build_upgrade\", this.updateUpgrade, this);\r\n        this.refreshPanel();\r\n        gm.audio.play_effect(gm.const.AUDIO_4_UPGRADE_OPEN);\r\n    }\r\n\r\n    private updateUpgrade(): void {\r\n        this.refreshPanel();\r\n    }\r\n\r\n    private refreshCoin(): void {\r\n        this.lblCoin.string = this._buildData?.upNeedCoin.toString();\r\n        this.lblCoin.node.color = cc.Color.RED;\r\n        if (gm.data.mapCell_data.roleCoinData.coinNum >= this._buildData.upNeedCoin) {\r\n            this.lblCoin.node.color = cc.Color.BLACK.fromHEX(\"#FFD53C\");\r\n        }\r\n    }\r\n\r\n    private refreshPanel(): void {\r\n        this._matraEnough = true;\r\n        this._tempList = [];\r\n        if (this._curBuildCfg) {\r\n            this._buildData = gm.data.mapCell_data.getBuildDataByType(this._curBuildCfg.buildType);\r\n            if (this._buildData) {\r\n                this.lblName.string = this._curBuildCfg.buildName;\r\n                this.lblNextLvl.string = \"（Nâng lên cấp \" + (this._curBuildCfg.buildLv + 1) + \")\";\r\n\r\n                for (let index = 0; index < this.meterialNode.length; index++) {\r\n                    this.meterialNode[index].active = false;\r\n                }\r\n\r\n                let index = 0;\r\n                for (const key in this._buildData.metrailData) {\r\n                    this.meterialNode[index].active = true;\r\n                    this.meterialNode[index].children[1].getComponent(cc.Label).string = this._buildData.metrailData[key].cur + \"/\" + this._buildData.metrailData[key].max;\r\n                    const itemConfig = gm.data.config_data.getItemCfgByID(this._buildData.metrailData[key].id);\r\n                    if (itemConfig) {\r\n                        Utils.async_set_sprite_frame(this.meterialNode[index].children[0].getComponent(cc.Sprite), BundleName.MAP, \"res/\" + itemConfig.icon);\r\n                        this._tempList.push(parseInt(key));\r\n                        if (this._buildData.metrailData[key].cur >= this._buildData.metrailData[key].max) {\r\n                            (this.meterialNode[index].children[2].active = !1,\r\n                                this.meterialNode[index].children[3].active = !0,\r\n                                this.meterialNode[index].color = cc.Color.BLACK.fromHEX(\"#86cbB4e\"))\r\n                        } else {\r\n                            this._matraEnough = false\r\n                            this.meterialNode[index].color = cc.Color.WHITE;\r\n                            this.meterialNode[index].children[2].active = true;\r\n                            this.meterialNode[index].children[3].active = false;\r\n                            this.meterialNode[index].children[2].children[0].width = this._buildData.metrailData[key].cur / this._buildData.metrailData[key].max * 108;\r\n\r\n                            const coinNum = gm.data.mapCell_data.getCoinNum(parseInt(key), this._buildData.metrailData[key].id);\r\n                            this.meterialNode[index].children[2].children[1].active = coinNum;\r\n                            this.meterialNode[index].children[2].children[2].active = !coinNum;\r\n                        }\r\n                        index++;\r\n                    }\r\n                }\r\n                this.btnSpr.spriteFrame = this._matraEnough ? this.btnSprList[1] : this.btnSprList[0];\r\n                this.refreshCoin()\r\n            }\r\n        }\r\n    }\r\n\r\n    private onClickClose(): void {\r\n        this.node.active = false;\r\n    }\r\n\r\n    private onClickAddMetrail(event: cc.Event, index: string): void {\r\n        const idx = parseInt(index);\r\n        gm.data.mapCell_data.onekeyGetAllMertrail(this._curBuildCfg.buildType, this._tempList[idx]);\r\n        this.refreshPanel();\r\n    }\r\n\r\n    private onClickVideoAddMetrail(event: cc.Event, index: string): void {\r\n        if (gm.data.mapCell_data.getIsHaveSpeceCellID()) {\r\n            const selectedIndex = parseInt(index);\r\n            this._buildData = gm.data.mapCell_data.getBuildDataByType(this._curBuildCfg.buildType);\r\n            if (this._buildData) {\r\n                let materialIndex = 0;\r\n                for (const materialKey in this._buildData.metrailData) {\r\n                    if (materialIndex == selectedIndex) {\r\n                        const materialID = this._buildData.metrailData[materialKey].id;\r\n                        let itemAmount: number;\r\n                        if (materialID == RewardIdEnum.WOOD) {\r\n                            itemAmount = 108;\r\n                        } else if (materialID == RewardIdEnum.IRON) {\r\n                            itemAmount = 78;\r\n                        } else {\r\n                            itemAmount = this._buildData.metrailData[materialKey].max - this._buildData.metrailData[materialKey].cur;\r\n                        }\r\n\r\n                        ReportData.instance.report_once_point(10537);\r\n                        ReportData.instance.report_point(10538);\r\n                        gm.channel.show_video_ad(() => {\r\n                            ReportData.instance.report_once_point(10637);\r\n                            ReportData.instance.report_point(10638);\r\n                            gm.data.mapCell_data.addItem(materialID, itemAmount);\r\n                            gm.ui.set_module_args(gm.const.GETREWARDOP.key, {\r\n                                idList: [materialID],\r\n                                numList: [itemAmount]\r\n                            });\r\n                            gm.ui.async_show_module(gm.const.GETREWARDOP);\r\n                            gm.data.mapCell_data.onekeyGetAllMertrail(this._curBuildCfg.buildType, this._tempList[selectedIndex]);\r\n                            this.refreshPanel()\r\n                        }, this);\r\n                        break\r\n                    }\r\n                    materialIndex++\r\n                }\r\n            }\r\n        } else {\r\n            gm.ui.show_auto_merge_message();\r\n        }\r\n    }\r\n\r\n    private onClickUpgrade(): void {\r\n        if (this._matraEnough && gm.data.mapCell_data.roleCoinData.coinNum < this._buildData.upNeedCoin) {\r\n            gm.ui.set_module_args(gm.const.GETCOINOP.key, false);\r\n            gm.ui.async_show_module(gm.const.GETCOINOP);\r\n            return;\r\n        }\r\n\r\n        if (this._matraEnough) {\r\n            gm.audio.play_effect(gm.const.AUDIO_6_JIANZUSHEGNJI);\r\n            this.scheduleOnce(() => {\r\n                gm.audio.play_effect(gm.const.AUDIO_7_BUILDING_UPGRADING)\r\n            }, 0.5);\r\n\r\n            gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.REDUCE_ITEM_TYPE, this._buildData.upNeedCoin);\r\n            gm.ui.mapMainUI.playBuildUpgradeAnim(this._buildData.buildID);\r\n            gm.data.mapCell_data.upgradeBuild(this._buildData.buildID);\r\n            this.node.active = false;\r\n            const newBuildData = gm.data.mapCell_data.getBuildDataByType(this._curBuildCfg.buildType);\r\n            if (newBuildData) {\r\n                if (1 == newBuildData.buildLvl) {\r\n                    if (!gm.data.mapCell_data.isGuide) {\r\n                        gm.const.openBuildID = this._curBuildCfg.buildID;\r\n                        const buildData = gm.data.mapCell_data.getBuildDataByType(this._curBuildCfg.buildType);\r\n                        if (buildData) {\r\n                            const buildConfig = gm.data.config_data.getBuildCfgByID(buildData.buildID);\r\n                            if (buildConfig) {\r\n                                if (buildConfig.buildType == BuildTypeEnum.BARRACKS_TYPE) {\r\n                                    gm.ui.show_panel(gm.const.BARRACKS_LIST);\r\n                                    gm.ui.set_module_args(gm.const.GUIDE_SHOW_TIPS_OP.key, 2);\r\n                                    gm.ui.show_panel(gm.const.GUIDE_SHOW_TIPS_OP);\r\n\r\n                                } else if (buildConfig.buildType == BuildTypeEnum.STALL_TYPE) {\r\n                                    gm.ui.show_panel(gm.const.Store);\r\n\r\n                                } else if (buildConfig.buildType == BuildTypeEnum.GARRISION_TYPE) {\r\n                                    gm.ui.show_panel(gm.const.DEFENSE);\r\n                                    gm.ui.set_module_args(gm.const.GUIDE_SHOW_TIPS_OP.key, 3);\r\n                                    gm.ui.show_panel(gm.const.GUIDE_SHOW_TIPS_OP);\r\n\r\n                                } else if (buildConfig.buildType == BuildTypeEnum.SEAGOINGBOAT_TYPE) {\r\n                                    gm.ui.show_panel(gm.const.GOBATTLE);\r\n\r\n                                } else if (0 < buildConfig.buildLv) {\r\n                                    if (buildConfig.buildType == BuildTypeEnum.WHARFTAX_TYPE) {\r\n                                        gm.ui.set_module_args(gm.const.GUIDE_SHOW_TIPS_OP.key, 1);\r\n                                        gm.ui.show_panel(gm.const.GUIDE_SHOW_TIPS_OP);\r\n                                    } else if (buildConfig.buildType == BuildTypeEnum.PRIVATEHOUSING_TYPE) {\r\n                                        gm.ui.set_module_args(gm.const.GUIDE_SHOW_TIPS_OP.key, 4);\r\n\r\n                                        gm.ui.show_panel(gm.const.GUIDE_SHOW_TIPS_OP);\r\n                                    }\r\n                                    gm.ui.set_module_args(gm.const.BUILDINFO.key, buildConfig.buildID);\r\n                                    gm.ui.show_panel(gm.const.BUILDINFO);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    gm.ui.emit(\"build_upgrade\");\r\n                    gm.ui.emit(\"build_show_stateIcon\", true);\r\n\r\n                } else if (1 < newBuildData.buildLvl && !gm.data.mapCell_data.isGuide) {\r\n                    gm.const.openBuildID = this._curBuildCfg.buildID;\r\n                    const buildData = gm.data.mapCell_data.getBuildDataByType(this._curBuildCfg.buildType);\r\n                    if (buildData) {\r\n                        const buildConfig = gm.data.config_data.getBuildCfgByID(buildData.buildID);\r\n                        if (buildConfig) {\r\n                            if (!(buildConfig.buildType == BuildTypeEnum.BARRACKS_TYPE || buildConfig.buildType == BuildTypeEnum.STALL_TYPE)) {\r\n                                if (buildConfig.buildType == BuildTypeEnum.GARRISION_TYPE) {\r\n                                    gm.ui.show_panel(gm.const.DEFENSE);\r\n                                } else if (buildConfig.buildType == BuildTypeEnum.SEAGOINGBOAT_TYPE) {\r\n                                    gm.ui.show_panel(gm.const.GOBATTLE);\r\n                                } else if (0 < buildConfig.buildLv) {\r\n                                    gm.ui.set_module_args(gm.const.BUILDINFO.key, buildConfig.buildID);\r\n                                    gm.ui.show_panel(gm.const.BUILDINFO);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    gm.ui.show_panel(gm.const.BUILD_UPGRADE);\r\n                    gm.ui.emit(\"build_upgrade\");\r\n                    gm.ui.emit(\"build_show_stateIcon\", true);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.ui.off(\"coin_change\", this.refreshCoin, this);\r\n        gm.ui.off(\"build_metarail_change\", this.refreshPanel, this);\r\n        gm.ui.off(\"update_build_upgrade\", this.updateUpgrade, this);\r\n        gm.audio.play_effect(gm.const.AUDIO_3_UPGRADE_CLOSE);\r\n        gm.ui.mapMainUI.setMapUiShow(true);\r\n        gm.ui.emit(\"build_show_stateIcon\", true);\r\n    }\r\n}\r\n"]}