{"version":3,"sources":["assets\\start-scene\\scripts\\GoBattleBuyItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { Utils } from './Utils';\r\nimport { RewardIdEnum, BundleName, SetItemNumEnum } from './Constants';\r\nimport { TempData } from './TempData';\r\nimport { gm } from './GameManager';\r\nimport { DefenseHeroItemVO, roleGoBattleItemVO } from './MapCellCfgData';\r\nimport { ReportData } from './NetUtils';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass GoBattleBuyItem extends cc.Component {\r\n    @property(cc.Sprite)\r\n    private heroColorSpr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private heroSpr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private heroLvlSpr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Label)\r\n    private price_lbl: cc.Label | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private cost_sprite: cc.Sprite | null = null;\r\n\r\n    private heroID: number = 0;\r\n    private heroDiam: number = 0;\r\n\r\n    public initdata(heroID: number, heroDiam: number): void {\r\n        this.heroID = heroID;\r\n        this.heroDiam = heroDiam;\r\n        const heroConfig = gm.data.config_data.getHeroCfgByID(this.heroID);\r\n        if (heroConfig) {\r\n            Utils.async_set_sprite_frame(this.heroColorSpr, BundleName.COMMON, \"res/color_\" + heroConfig.lv);\r\n            Utils.async_set_sprite_frame(this.heroSpr, BundleName.COMMON, \"res/handbook/\" + this.heroID);\r\n            Utils.async_set_sprite_frame(this.heroLvlSpr, BundleName.BOOK, \"res/icon_lv\" + heroConfig.lv);\r\n            this.price_lbl.string = this.heroDiam.toString();\r\n            this.cost_sprite.node.color = cc.Color.WHITE;\r\n            this.price_lbl.node.getComponent(cc.LabelOutline).enabled = true;\r\n            this.price_lbl.node.color = cc.Color.BLACK.fromHEX(\"#FFDA58\");\r\n            this.price_lbl.node.getComponent(cc.LabelOutline).color = cc.Color.BLACK.fromHEX(\"#7D2713\");\r\n            this.cost_sprite.node.height = 50;\r\n            this.cost_sprite.node.width = 50;\r\n\r\n            if (this.heroDiam == 0) {\r\n                this.price_lbl.string = \"Miễn phí\";\r\n                this.cost_sprite.node.color = cc.Color.BLACK.fromHEX(\"#253D45\");\r\n                this.price_lbl.node.color = cc.Color.BLACK.fromHEX(\"#1C3F00\");\r\n                this.price_lbl.node.getComponent(cc.LabelOutline).enabled = false;\r\n                Utils.async_set_sprite_frame(this.cost_sprite, BundleName.COMMON, \"res/handbook/video_1\");\r\n                this.cost_sprite.node.width = 55;\r\n                this.cost_sprite.node.height = 40;\r\n            } else if (this.heroDiam > 200) {\r\n                Utils.async_set_sprite_frame(this.cost_sprite, BundleName.COMMON, \"res/handbook/\" + RewardIdEnum.GOLD);\r\n            } else {\r\n                Utils.async_set_sprite_frame(this.cost_sprite, BundleName.COMMON, \"res/handbook/\" + RewardIdEnum.DIAMOND);\r\n            }\r\n        }\r\n    }\r\n\r\n    private onClickAddHeroTobattle(): void {\r\n        if (gm.data.fight_temp_data.get_battle_hero_is_space()) {\r\n            if (this.heroDiam == 0) {\r\n                gm.channel.show_video_ad(this.addHero, this);\r\n            } else if (this.heroDiam > 200) {\r\n                if (gm.data.mapCell_data.roleCoinData.coinNum < this.heroDiam) {\r\n                    gm.ui.set_module_args(gm.const.GETCOINOP.key, false);\r\n                    gm.ui.show_panel(gm.const.GETCOINOP);\r\n                    return;\r\n                }\r\n                gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.REDUCE_ITEM_TYPE, this.heroDiam);\r\n                this.addHero();\r\n            } else {\r\n                if (gm.data.mapCell_data.roleCoinData.diamondNum < this.heroDiam) {\r\n                    gm.ui.set_module_args(gm.const.GETCOINOP.key, true);\r\n                    gm.ui.show_panel(gm.const.GETCOINOP);\r\n                    return;\r\n                }\r\n                gm.data.mapCell_data.setAddGameDiamond(SetItemNumEnum.REDUCE_ITEM_TYPE, this.heroDiam);\r\n                this.addHero();\r\n            }\r\n        } else {\r\n            gm.ui.show_notice(\"Bạn không có đủ ô trống, vui lòng dọn dẹp chúng trước\");\r\n        }\r\n    }\r\n\r\n    private addHero(): void {\r\n        let spaceIndex: number;\r\n\r\n        if (TempData.getDefenseType() != 2) {\r\n            spaceIndex = gm.data.mapCell_data.getRoleSpceListShift();\r\n            const heroID = this.heroID;\r\n            gm.data.mapCell_data.addItem(heroID, 1, spaceIndex);\r\n            const heroConfig = gm.data.config_data.getHeroCfgByID(heroID);\r\n            const roleGoBattleItem = new roleGoBattleItemVO();\r\n            roleGoBattleItem.cellID = spaceIndex;\r\n\r\n            if (heroConfig) {\r\n                roleGoBattleItem.itemID = heroConfig.heroid;\r\n                roleGoBattleItem.itemType = heroConfig.occupation;\r\n                roleGoBattleItem.hp = heroConfig.hp;\r\n                roleGoBattleItem.maxHp = heroConfig.hp;\r\n                gm.data.fight_temp_data.battle_hero_array.push(roleGoBattleItem);\r\n            }\r\n\r\n            switch (this.heroID) {\r\n                case 34003:\r\n                    ReportData.instance.report_once_point(10900);\r\n                    ReportData.instance.report_point(10901);\r\n                    break;\r\n                case 35003:\r\n                    ReportData.instance.report_once_point(10902);\r\n                    ReportData.instance.report_point(10903);\r\n                    break;\r\n                case 37003:\r\n                    ReportData.instance.report_once_point(10904);\r\n                    ReportData.instance.report_point(10905);\r\n                    break;\r\n                case 38003:\r\n                    ReportData.instance.report_once_point(10906);\r\n                    ReportData.instance.report_point(10907);\r\n                    break;\r\n                case 39003:\r\n                    ReportData.instance.report_once_point(10908);\r\n                    ReportData.instance.report_point(10909);\r\n                    break;\r\n            }\r\n\r\n            gm.ui.emit(\"refreshHeroBattle\");\r\n            gm.ui.emit(\"refreshBattleHero\");\r\n\r\n        } else if (gm.data.fight_temp_data.get_defense_hero_is_space()) {\r\n            spaceIndex = gm.data.mapCell_data.getRoleSpceListShift();\r\n            const heroID = this.heroID;\r\n            gm.data.mapCell_data.addItem(heroID, 1, spaceIndex);\r\n            const roleData = gm.data.mapCell_data.role_map_data[spaceIndex];\r\n\r\n            if (roleData.itemID > 30000) {\r\n                const heroConfig = gm.data.config_data.getHeroCfgByID(heroID);\r\n                if (heroConfig) {\r\n                    const defenseHeroItem = new DefenseHeroItemVO();\r\n                    defenseHeroItem.cellID = spaceIndex;\r\n                    defenseHeroItem.heroid = heroID;\r\n                    defenseHeroItem.heroUID = roleData.heroUID;\r\n                    gm.data.mapCell_data.addDefenseDataByID(defenseHeroItem);\r\n                }\r\n                gm.ui.emit(\"refreshHeroBattle\");\r\n                gm.ui.emit(\"refreshBattleHero\");\r\n                gm.data.mapCell_data.async_write_data();\r\n            }\r\n        }\r\n    }\r\n\r\n    private reset(): void {\r\n        this.heroSpr.spriteFrame = null;\r\n        this.heroLvlSpr.spriteFrame = null;\r\n    }\r\n\r\n}\r\n\r\nexport { GoBattleBuyItem };"]}