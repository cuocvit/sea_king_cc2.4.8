{"version":3,"sources":["assets\\start-scene\\scripts\\CsvReader.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// @@\r\nenum CsvState {\r\n    Start = 1,\r\n    ID = 2,\r\n    String = 3,\r\n    EndString = 4,\r\n    Switch = 5,\r\n    FieldEnd = 6,\r\n    End = 7\r\n}\r\n\r\n// @@\r\nclass CsvRecordSet {\r\n    private _fields: string[];\r\n    // @@\r\n    constructor() {\r\n        this._fields = [];\r\n    }\r\n    // @@\r\n    public append(field: string): void {\r\n        this._fields.push(field);\r\n    }\r\n    // @@\r\n    public field(index: number): string {\r\n        return this._fields[index];\r\n    }\r\n    // @@\r\n    public fieldsCopy(): string[] {\r\n        return this._fields.concat();\r\n    }\r\n    // @@ (not used)\r\n    /* public count(): number {\r\n        return this._fields.length;\r\n    } */\r\n    // @@\r\n    public reset(): void {\r\n        this._fields.splice(0, this._fields.length);\r\n    }\r\n}\r\n\r\n// @@\r\nexport class CsvReader {\r\n    // @@\r\n    private charPos: number;\r\n    private content: string;\r\n    public rs: CsvRecordSet;\r\n\r\n    // @@\r\n    public constructor() {\r\n        this.charPos = 0;\r\n    }\r\n\r\n    // @@\r\n    public init(content: string): void {\r\n        this.content = content;\r\n        this.rs = new CsvRecordSet();\r\n    }\r\n\r\n    // @@\r\n    public next(): boolean {\r\n        this.rs.reset();\r\n        if (this.charPos >= this.content.length) return false;\r\n        //\r\n        let state: CsvState = CsvState.Start;\r\n        let pos: number = this.charPos;\r\n        let field: string = \"\";\r\n        //\r\n        while (state !== CsvState.End) {\r\n            if (pos >= this.content.length) break;\r\n            let valid: boolean = true;\r\n            let char: string = this.content[pos++];\r\n            switch (char) {\r\n                case \" \":\r\n                case \"\\t\":\r\n                case \";\":\r\n                    if (state === CsvState.Start) {\r\n                        valid = false;\r\n                    } else if (state !== CsvState.String) {\r\n                        state = CsvState.FieldEnd;\r\n                        valid = false;\r\n                    }\r\n                    break;\r\n                case \"\\r\":\r\n                    valid = false;\r\n                    break;\r\n                case \"\\n\":\r\n                    state = CsvState.End;\r\n                    valid = false;\r\n                    break;\r\n                case '\"':\r\n                case \"'\":\r\n                    state = state !== CsvState.String ? CsvState.String : CsvState.EndString;\r\n                    valid = false;\r\n                    break;\r\n                case \"\\\\\":\r\n                    if (pos < this.content.length) {\r\n                        switch (this.content.charAt(pos)) {\r\n                            case \"t\":\r\n                                char = \"\\t\";\r\n                                pos++;\r\n                                break;\r\n                            case \"n\":\r\n                                char = \"\\n\";\r\n                                pos++;\r\n                        }\r\n                        if (state !== CsvState.String) state = CsvState.ID;\r\n                    }\r\n                    break;\r\n                default:\r\n                    if (state !== CsvState.String) state = CsvState.ID;\r\n            }\r\n            if (valid) field = field.concat(char);\r\n            //\r\n            switch (state) {\r\n                case CsvState.FieldEnd:\r\n                    this.rs.append(field);\r\n                    field = \"\";\r\n                    state = CsvState.Start;\r\n                    break;\r\n                case CsvState.End:\r\n                    if (field.length) this.rs.append(field);\r\n            }\r\n        }\r\n        this.charPos = pos;\r\n        return true;\r\n    } // end: next\r\n}\r\n"]}