{"version":3,"sources":["assets\\book\\scripts\\NodeBookFormula.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AACA,iEAAiE;AACjE,qEAA2D;AAC3D,uEAAsE;AACtE,yDAAwD;AACxD,+CAA0C;AAC1C,mDAA8C;AAExC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA8B,mCAAY;IAyBtC;QAAA,YACI,iBAAO,SAGV;QA3BO,eAAS,GAAY,IAAI,CAAC;QAG1B,iBAAW,GAAY,IAAI,CAAC;QAG5B,YAAM,GAAc,IAAI,CAAC;QAGzB,YAAM,GAAc,IAAI,CAAC;QAGzB,WAAK,GAAY,IAAI,CAAC;QAGtB,cAAQ,GAAa,IAAI,CAAC;QAG1B,eAAS,GAAY,IAAI,CAAC;QAO9B,KAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,KAAI,CAAC,OAAO,GAAG,CAAC,CAAC;;IACrB,CAAC;IAEM,8BAAI,GAAX,UAAY,MAAc,EAAE,KAAiB;QAA7C,iBAgBC;QAhB2B,sBAAA,EAAA,SAAiB;QACzC,IAAM,UAAU,GAAY,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QACvD,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,UAAU,CAAC;QACpC,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,UAAU,CAAC;QACrC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACtB,IAAI,CAAC,UAAU;YAAE,OAAO;QACxB,IAAM,QAAQ,GAAG,gBAAE,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,EAAE,MAAM,CAAC,QAAQ,EAAE,CAAe,CAAC;QAC3F,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC;QACrC,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,MAAM,EAAE,sBAAU,CAAC,MAAM,EAAE,eAAe,GAAG,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3G,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,MAAM,EAAE,sBAAU,CAAC,MAAM,EAAE,eAAe,GAAG,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3G,IAAI,CAAC,YAAY,CAAC,UAAC,QAAsB;YACrC,KAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACnC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACtB,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;QAC9B,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,mCAAS,GAAjB,UAAkB,KAAa;QAC3B,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzC,IAAI,KAAK,IAAI,CAAC,EAAE;YACZ,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,GAAG,CAAC;SAChC;aAAM;YACH,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,CAAC,CAAC;YAC3B,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC,KAAK,EAAE,CAAC;SAC5E;IACL,CAAC;IAEO,qCAAW,GAAnB;QACI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC7C,IAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACpC,gBAAE,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SAC9B;QACD,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;IACzB,CAAC;IAEO,sCAAY,GAApB,UAAqB,QAA0C;QAA/D,iBAMC;QALG,gBAAE,CAAC,IAAI,CAAC,SAAS,CAAC,sBAAU,CAAC,IAAI,EAAE,mBAAmB,EAAE,sBAAY,EAAE,UAAC,QAAQ;YAC3E,QAAQ,CAAC,KAAK,EAAE,CAAC;YACjB,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC/B,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACvB,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,uCAAa,GAArB,UAAsB,MAAc;QAChC,OAAO,gBAAE,CAAC,IAAI,CAAC,YAAY,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;IAC9D,CAAC;IAES,wDAA8B,GAAxC,UAAyC,KAAe,EAAE,UAAiB;QAAjB,2BAAA,EAAA,iBAAiB;QACvE,IAAM,QAAQ,GAAG,gBAAE,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAe,CAAC;QACjG,IAAM,KAAK,GAAG,gBAAE,CAAC,EAAE,CAAC,UAAU,CAAC,gBAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC;QAEzD,IAAI,QAAQ,CAAC,QAAQ,IAAI,wBAAc,CAAC,aAAa,EAAE;YACnD,IAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAChD,gBAAE,CAAC,EAAE,CAAC,eAAe,CAAC,gBAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;YAChE,gBAAE,CAAC,EAAE,CAAC,UAAU,CAAC,gBAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;SAC/C;aAAM,IAAI,QAAQ,CAAC,QAAQ,IAAI,wBAAc,CAAC,kBAAkB,EAAE;YAC/D,gBAAE,CAAC,EAAE,CAAC,eAAe,CAAC,gBAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YACrE,gBAAE,CAAC,EAAE,CAAC,UAAU,CAAC,gBAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;SAC/C;aAAM;YACH,IAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAChD,gBAAE,CAAC,EAAE,CAAC,eAAe,CAAC,gBAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;YAChE,gBAAE,CAAC,EAAE,CAAC,UAAU,CAAC,gBAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;SAC/C;IACL,CAAC;IAEM,+BAAK,GAAZ;QACI,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzC,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,GAAG,CAAC;QAC7B,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAnGD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;sDACgB;IAGlC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;wDACkB;IAGpC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACa;IAGjC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACa;IAGjC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;kDACY;IAG9B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;qDACe;IAGlC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;sDACgB;IApBhC,eAAe;QADpB,OAAO;OACF,eAAe,CAuGpB;IAAD,sBAAC;CAvGD,AAuGC,CAvG6B,2BAAY,GAuGzC;AAED,kBAAe,eAAe,CAAC","file":"","sourceRoot":"/","sourcesContent":["import { BookConfig } from '../../common/configs/books';\r\nimport { BundleName } from '../../start-scene/scripts/Constants';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { NodePoolItem } from '../../start-scene/scripts/NodePoolItem';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\nimport NodeBookItem from './NodeBookItem';\r\nimport SceneBookLogic from './SceneBookLogic';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass NodeBookFormula extends NodePoolItem {\r\n    @property(cc.Node)\r\n    private node_lock: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    private node_unlock: cc.Node = null;\r\n\r\n    @property(cc.Sprite)\r\n    private icon_1: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    private icon_2: cc.Sprite = null;\r\n\r\n    @property(cc.Node)\r\n    private pos_3: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    private lab_name: cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    private node_root: cc.Node = null;\r\n\r\n    private tBookItems: NodeBookItem[];\r\n    private iItemId: number;\r\n\r\n    private constructor() {\r\n        super();\r\n        this.tBookItems = [];\r\n        this.iItemId = 0;\r\n    }\r\n\r\n    public init(itemId: number, delay: number = 0): void {\r\n        const isUnlocked: boolean = this.checkIsUnlock(itemId);\r\n        this.node_lock.active = !isUnlocked;\r\n        this.node_unlock.active = isUnlocked;\r\n        this.iItemId = itemId;\r\n        this.delayShow(delay);\r\n        if (!isUnlocked) return;\r\n        const itemData = gm.config.get_row_data(\"BookConfigData\", itemId.toString()) as BookConfig;\r\n        this.lab_name.string = itemData.name;\r\n        Utils.async_set_sprite_frame(this.icon_1, BundleName.COMMON, \"res/handbook/\" + itemData.unlock_formula[0]);\r\n        Utils.async_set_sprite_frame(this.icon_2, BundleName.COMMON, \"res/handbook/\" + itemData.unlock_formula[1]);\r\n        this.loadBookItem((bookItem: NodeBookItem) => {\r\n            this.pos_3.addChild(bookItem.node);\r\n            bookItem.init(itemId);\r\n            bookItem.node.scale = 0.6;\r\n        });\r\n    }\r\n\r\n    private delayShow(delay: number): void {\r\n        cc.Tween.stopAllByTarget(this.node_root);\r\n        if (delay <= 0) {\r\n            this.node_root.opacity = 255;\r\n        } else {\r\n            this.node_root.opacity = 0;\r\n            cc.tween(this.node_root).delay(delay).to(0.42, { opacity: 255 }).start();\r\n        }\r\n    }\r\n\r\n    private recyleNodes(): void {\r\n        for (let i = 0; i < this.tBookItems.length; i++) {\r\n            const bookItem = this.tBookItems[i];\r\n            gm.pool.put(bookItem.node);\r\n        }\r\n        this.tBookItems = [];\r\n    }\r\n\r\n    private loadBookItem(callback: (bookItem: NodeBookItem) => void): void {\r\n        gm.pool.async_get(BundleName.BOOK, \"prefabs/book_item\", NodeBookItem, (bookItem) => {\r\n            bookItem.reset();\r\n            this.tBookItems.push(bookItem);\r\n            callback(bookItem);\r\n        });\r\n    }\r\n\r\n    private checkIsUnlock(itemId: number): boolean {\r\n        return gm.data.mapCell_data.checkBookItemIsUnlock(itemId);\r\n    }\r\n\r\n    protected editor_on_button_click_handler(event: cc.Event, customData = null): void {\r\n        const itemData = gm.config.get_row_data(\"BookConfigData\", this.iItemId.toString()) as BookConfig;\r\n        const logic = gm.ui.get_module(gm.const.BOOK).getLogic();\r\n\r\n        if (itemData.sub_type == SceneBookLogic.SUB_TYPE_HERO) {\r\n            const levelList = logic.getLvList(this.iItemId);\r\n            gm.ui.set_module_args(gm.const.BOOK_HERO_DETAIL.key, levelList);\r\n            gm.ui.show_panel(gm.const.BOOK_HERO_DETAIL);\r\n        } else if (itemData.sub_type == SceneBookLogic.SUB_TYPE_HERO_WALL) {\r\n            gm.ui.set_module_args(gm.const.BOOK_HERO_DETAIL.key, [this.iItemId]);\r\n            gm.ui.show_panel(gm.const.BOOK_HERO_DETAIL);\r\n        } else {\r\n            const levelList = logic.getLvList(this.iItemId);\r\n            gm.ui.set_module_args(gm.const.BOOK_ITEM_DETAIL.key, levelList);\r\n            gm.ui.show_panel(gm.const.BOOK_ITEM_DETAIL);\r\n        }\r\n    }\r\n\r\n    public reset(): void {\r\n        cc.Tween.stopAllByTarget(this.node_root);\r\n        this.node_root.opacity = 255;\r\n        this.recyleNodes();\r\n    }\r\n\r\n}\r\n\r\nexport default NodeBookFormula;"]}