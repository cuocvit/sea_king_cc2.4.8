{"version":3,"sources":["assets\\start-scene\\scripts\\ShowGift.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { SetItemNumEnum, RewardIdEnum } from './Constants';\r\nimport { gm } from './GameManager';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass ShowGift extends cc.Component {\r\n    @property(cc.Node)\r\n    private bar1: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private bar2: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private widthBg: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private widthBg1: cc.Node | null = null;\r\n\r\n    @property([cc.Node])\r\n    private giftItem: cc.Node[] = [];\r\n\r\n    private _itemID: number | null = null;\r\n    private _cellID: number | null = null;\r\n    private _maxNumList: { [key: number]: number } = {\r\n        12: 8,\r\n        13: 8,\r\n        14: 5\r\n    };\r\n\r\n    protected onEnable(): void {\r\n        this.bar2.stopAllActions();\r\n        this.node.zIndex = gm.const.MAX_CELL_NUM + 3;\r\n        if (this._cellID && this._itemID) {\r\n            this.node.y = gm.ui.mapMainUI.mapContent.getChildByName(this._cellID.toString()).y + 90;\r\n            this.node.x = gm.ui.mapMainUI.mapContent.getChildByName(this._cellID.toString()).x + 30;\r\n\r\n            const itemConfig = gm.data.config_data.getItemCfgByID(this._itemID);\r\n            if (itemConfig) {\r\n                const maxNum = this._maxNumList[itemConfig.type];\r\n                if (maxNum) {\r\n                    this.bar1.width = 30 * maxNum - 10;\r\n                    this.bar2.width = 30 * maxNum - 10;\r\n                    this.bar1.x = .5 * -this.bar1.width;\r\n                    this.bar2.x = .5 * -this.bar2.width;\r\n                    this.widthBg.width = 30 * maxNum + 15;\r\n                    this.widthBg1.width = 30 * maxNum + 15;\r\n\r\n                    for (let index = 0; index < this.giftItem.length; index++) {\r\n                        this.giftItem[index].active = index < maxNum;\r\n                        this.giftItem[index].color = itemConfig.lv - 2 >= maxNum - 1 - index ? cc.Color.GREEN : cc.Color.WHITE;\r\n                    }\r\n\r\n                    this.bar1.scaleX = 1;\r\n                    this.bar2.scaleX = (itemConfig.lv - 2) / (maxNum - 1);\r\n\r\n                    this.bar2.runAction(cc.sequence(cc.delayTime(.2), cc.scaleTo(.4, (itemConfig.lv - 1) / (maxNum - 1), 1),\r\n                        cc.callFunc(() => {\r\n                            this.giftItem[maxNum - 1 - (itemConfig.lv - 1)].color = cc.Color.GREEN\r\n                        }), cc.delayTime(2),\r\n                        cc.callFunc(() => {\r\n                            if (itemConfig.lv == maxNum) {\r\n                                gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.ADD_ITEM_TYPE, itemConfig.number);\r\n                                gm.ui.show_coin_fly(RewardIdEnum.DIAMOND, this.node.convertToWorldSpaceAR(cc.Vec3.ZERO), itemConfig.number);\r\n                            }\r\n                            this.node.active = false;\r\n                        })));\r\n                }\r\n            }\r\n        } else {\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    public initData(itemID: number, cellID: number): void {\r\n        this.bar2?.stopAllActions();\r\n        this._itemID = itemID;\r\n        this._cellID = cellID;\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.bar2.stopAllActions();\r\n    }\r\n}\r\n\r\nexport default ShowGift;"]}