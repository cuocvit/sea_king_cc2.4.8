{"version":3,"sources":["assets\\lucky_wheel\\scripts\\LuckyWheel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameModule } from '../../start-scene/scripts/GameModule';\r\nimport { SetItemNumEnum, } from '../../start-scene/scripts/Constants';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\nimport { ReportData } from '../../start-scene/scripts/NetUtils';\r\nimport { TempData } from '../../start-scene/scripts/TempData';\r\nimport { BANNER_AD_TYPE } from \"../../start-scene/scripts/ChannelManager\";\r\nimport { Timer } from '../../start-scene/scripts/Timer';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass LuckyWheel extends GameModule {\r\n    @property(cc.Button)\r\n    private close_btn: cc.Button = null;\r\n\r\n    @property(cc.Node)\r\n    private rotate_node: cc.Node = null;\r\n\r\n    @property(cc.Button)\r\n    private video_draw_btn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private free_draw_btn: cc.Button = null;\r\n\r\n    @property(cc.Label)\r\n    private free_left_sec_lbl: cc.Label = null;\r\n\r\n    @property(cc.RichText)\r\n    private left_count_lbl: cc.RichText = null;\r\n\r\n    @property(cc.Node)\r\n    private light_node: cc.Node = null;\r\n\r\n    private _timer: Timer | null = null;\r\n\r\n    protected onEnable(): void {\r\n        TempData.mainFunShowLucky = true;\r\n        gm.channel.show_banner_ad(BANNER_AD_TYPE.ALL);\r\n        this.update_view();\r\n        this.rotate_node.rotation = 360 / gm.const.LUCKY_WHEEL_REWARD_ARRAY.length * gm.data.lucky_wheel_data.last_reward_index;\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.channel.hide_banner_ad(BANNER_AD_TYPE.ALL);\r\n        gm.ui.mapMainUI.show_lucky_wheel_node_entry();\r\n        this._timer && this._timer.stop();\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        const target = event.target;\r\n        const luckyWheelData = gm.data.lucky_wheel_data;\r\n\r\n        if (target == this.close_btn.node) {\r\n            gm.ui.async_hide_module(gm.const.LuckyWheel);\r\n        } else if (target == this.video_draw_btn.node) {\r\n            if (luckyWheelData.left_lucky_wheel_video_count > 0) {\r\n                ReportData.instance.report_once_point(10533);\r\n                ReportData.instance.report_point(10534);\r\n                gm.channel.show_video_ad(() => {\r\n                    ReportData.instance.report_once_point(10633);\r\n                    ReportData.instance.report_point(10634);\r\n                    this.video_draw_btn.interactable = false;\r\n                    this.close_btn.interactable = false;\r\n                    Utils.set_sprite_state(this.video_draw_btn.node, cc.Sprite.State.GRAY);\r\n                    Utils.set_sprite_state(this.close_btn.node, cc.Sprite.State.GRAY);\r\n                    this.draw();\r\n                }, this);\r\n            } else {\r\n                gm.ui.show_notice(\"Không đủ lượt, hãy quay lại vào ngày mai!!!\");\r\n            }\r\n        } else if (target == this.free_draw_btn.node) {\r\n            if (luckyWheelData.left_lucky_wheel_video_count > 0) {\r\n                this.free_draw_btn.interactable = false;\r\n                this.close_btn.interactable = false;\r\n                Utils.set_sprite_state(this.free_draw_btn.node, cc.Sprite.State.GRAY);\r\n                Utils.set_sprite_state(this.close_btn.node, cc.Sprite.State.GRAY);\r\n                this.draw();\r\n                luckyWheelData.free_timestamp = Date.now() + gm.const.FREE_DRAW_TIME_INTERVAL;\r\n            } else {\r\n                gm.ui.show_notice(\"Không đủ lượt, hãy quay lại vào ngày mai!!!\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public update_view(): void {\r\n        const luckyWheelData = gm.data.lucky_wheel_data;\r\n        this.left_count_lbl.string = cc.js.formatStr(\"<b>Lượt quay còn lại（<color=#56ff49>%d lần</color>）</b>\", luckyWheelData.left_lucky_wheel_video_count);\r\n\r\n        if (luckyWheelData.left_lucky_wheel_free_count > 0) {\r\n            this.video_draw_btn.node.active = false;\r\n        } else if (luckyWheelData.left_lucky_wheel_video_count > 0) {\r\n            if (Date.now() > luckyWheelData.free_timestamp) {\r\n                this.free_draw_btn.interactable = true;\r\n                this.free_draw_btn.node.active = true;\r\n                this.video_draw_btn.interactable = false;\r\n                this.video_draw_btn.node.active = false;\r\n                this.free_left_sec_lbl.string = \"\";\r\n            } else {\r\n                const remainingTime = Math.ceil((luckyWheelData.free_timestamp - Date.now()) / 1000);\r\n                if (!this._timer) {\r\n                    this._timer = new Timer();\r\n                }\r\n                this._timer.start((startTime: number, currentTime: number) => {\r\n                    this.free_left_sec_lbl.string = cc.js.formatStr(\"%s后免费\", Utils.format_time(currentTime - startTime));\r\n                    if (currentTime <= startTime) {\r\n                        this.update_view();\r\n                    }\r\n                }, 1000, remainingTime);\r\n                this.video_draw_btn.interactable = true;\r\n                this.video_draw_btn.node.active = true;\r\n                Utils.set_sprite_state(this.video_draw_btn.node, cc.Sprite.State.NORMAL);\r\n                this.free_draw_btn.interactable = false;\r\n                this.free_draw_btn.node.active = false;\r\n            }\r\n        } else {\r\n            this.video_draw_btn.interactable = false;\r\n            this.video_draw_btn.node.active = true;\r\n            this.free_draw_btn.interactable = false;\r\n            this.free_draw_btn.node.active = false;\r\n        }\r\n        this.close_btn.interactable = true;\r\n        Utils.set_sprite_state(this.close_btn.node, cc.Sprite.State.NORMAL);\r\n    }\r\n\r\n    private random_index(): number {\r\n        let totalWeight = 0;\r\n        for (let reward of gm.const.LUCKY_WHEEL_REWARD_ARRAY) {\r\n            totalWeight += reward.weight;\r\n        }\r\n        const randomValue = Math.random() * totalWeight;\r\n        let accumulatedWeight = 0;\r\n        for (let i = 0; i < gm.const.LUCKY_WHEEL_REWARD_ARRAY.length; i++) {\r\n            accumulatedWeight += gm.const.LUCKY_WHEEL_REWARD_ARRAY[i].weight;\r\n            if (accumulatedWeight > randomValue) {\r\n                return i;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    private draw(): void {\r\n        const luckyWheelData = gm.data.lucky_wheel_data;\r\n        const rotationPerReward = 360 / gm.const.LUCKY_WHEEL_REWARD_ARRAY.length;\r\n        const randomIndex = this.random_index();\r\n        const totalRotation = 360 - luckyWheelData.last_reward_index * rotationPerReward + 1080 + randomIndex * rotationPerReward;\r\n\r\n        this.light_node.active = false;\r\n        this.light_node.opacity = 255;\r\n        this.rotate_node.rotation = luckyWheelData.last_reward_index * rotationPerReward;\r\n\r\n        this.rotate_node.runAction(cc.sequence(\r\n            cc.rotateBy(3.8, totalRotation).easing(cc.easeCubicActionOut()),\r\n            cc.callFunc(() => {\r\n                this.light_node.active = true;\r\n                this.light_node.runAction(cc.sequence(\r\n                    cc.blink(1, 10),\r\n                    cc.callFunc(() => {\r\n                        this.light_node.opacity = 255;\r\n                        const reward = gm.const.LUCKY_WHEEL_REWARD_ARRAY[randomIndex];\r\n                        if (reward.type == 0) {\r\n                            gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.ADD_ITEM_TYPE, reward.num);\r\n                            gm.ui.show_coin_fly(reward.id, this.node.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n                        } else if (reward.type == 1) {\r\n                            gm.data.mapCell_data.setAddGameDiamond(SetItemNumEnum.ADD_ITEM_TYPE, reward.num);\r\n                            gm.ui.show_coin_fly(reward.id, this.node.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n                        } else if (reward.type == 2) {\r\n                            gm.data.mapCell_data.addBarrelNum(reward.num);\r\n                            gm.ui.set_module_args(gm.const.GETREWARDOP.key, {\r\n                                idList: [reward.id],\r\n                                numList: [reward.num]\r\n                            });\r\n                            gm.ui.async_show_module(gm.const.GETREWARDOP);\r\n                        } else if (reward.type == 3 || reward.type == 4) {\r\n                            const itemList = [];\r\n                            for (let i = 0; i < reward.num; i++) {\r\n                                itemList.push(reward.id);\r\n                            }\r\n                            gm.ui.set_module_args(gm.const.GETREWARDOP.key, {\r\n                                idList: [reward.id],\r\n                                numList: [reward.num]\r\n                            });\r\n                            gm.ui.async_show_module(gm.const.GETREWARDOP);\r\n                            gm.data.mapCell_data.addWareHouseList(itemList);\r\n                        }\r\n                        luckyWheelData.last_reward_index = randomIndex;\r\n                        if (luckyWheelData.left_lucky_wheel_free_count > 0) {\r\n                            luckyWheelData.left_lucky_wheel_free_count--;\r\n                        } else if (luckyWheelData.left_lucky_wheel_video_count > 0) {\r\n                            luckyWheelData.left_lucky_wheel_video_count--;\r\n                        }\r\n                        luckyWheelData.async_write_data();\r\n                        this.update_view();\r\n                    })\r\n                ));\r\n            }, this)\r\n        ));\r\n    }\r\n}"]}