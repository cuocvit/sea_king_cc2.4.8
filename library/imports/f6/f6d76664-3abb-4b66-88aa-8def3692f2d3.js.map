{"version":3,"sources":["assets\\fight\\scripts\\FightResult.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ChannelManager } from '../../start-scene/scripts/ChannelManager';\r\nimport { BundleName, BuildTypeEnum } from '../../start-scene/scripts/Constants';\r\nimport { FightConstants } from '../../start-scene/scripts/FightConstants';\r\nimport { RecordData } from '../../start-scene/scripts/RecordData';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { GameModule } from '../../start-scene/scripts/GameModule';\r\nimport { ListView } from '../../start-scene/scripts/ListView';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\nimport { ReportData } from '../../start-scene/scripts/NetUtils';\r\nimport { LadderBuildding } from '../../common/configs/ladder_building';\r\nimport { LadderLVConfig } from '../../common/configs/ladder_lv';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass FightResult extends GameModule {\r\n    @property(cc.Node)\r\n    private mask_node: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    private star_lbl: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    private gold_lbl: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    private bucket_lbl: cc.Label = null;\r\n\r\n    @property(ListView)\r\n    private prop_list: ListView = null;\r\n\r\n    @property(ListView)\r\n    private death_hero_list: ListView = null;\r\n\r\n    @property(cc.Button)\r\n    private home_btn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private watch_ad_btn: cc.Button = null;\r\n\r\n    @property(cc.Sprite)\r\n    private cur_ladder_lv_spr: cc.Sprite = null;\r\n\r\n    @property(cc.Label)\r\n    private cur_star_lbl: cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    private hand_node: cc.Node = null;\r\n\r\n    private CURTIMES: number = 2;\r\n\r\n    protected onEnable(): void {\r\n        if (gm.data.record_data.record_type == 0) {\r\n            gm.channel.record_stop(false);\r\n        }\r\n        this.mask_node.color = FightConstants.SEA_AREA_COLOR_ARRAY[gm.data.fight_temp_data.play_type];\r\n        this.update_view();\r\n        if (!gm.data.mapCell_data.isGuide &&\r\n            gm.channel.get_channel_name() == ChannelManager.TT_GAME &&\r\n            gm.data.record_data.record_type == 0 &&\r\n            gm.data.record_data.left_push_share_count > 0\r\n        ) {\r\n            gm.ui.show_panel(gm.const.RecordShare);\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.prop_list.reset();\r\n        this.death_hero_list.reset();\r\n        if (gm.data.record_data.record_type == 0) {\r\n            gm.data.record_data.record_state = 0;\r\n            gm.data.record_data.record_timestamp = 0;\r\n            gm.data.event_emitter.emit(RecordData.RECORD_STATE_CHANGE);\r\n            gm.data.record_data.async_write_data();\r\n        }\r\n    }\r\n\r\n    private update_view(): void {\r\n        const fightResultData = gm.data.fight_temp_data.fight_result_data;\r\n        this.gold_lbl.string = \"X\" + fightResultData.gold_num;\r\n        this.bucket_lbl.string = \"X\" + fightResultData.bucket_num;\r\n        this.prop_list.setData(fightResultData.prop_data_array);\r\n        this.death_hero_list.setData(fightResultData.death_hero_data_array);\r\n\r\n        const rank = gm.data.ladder_temp_data.convert_rank_to_lv(gm.data.ladder_temp_data.rank);\r\n        const ladderData = gm.config.get_row_data(\"LadderLvConfigData\", rank.toString()) as LadderLVConfig;\r\n        Utils.async_set_sprite_frame(this.cur_ladder_lv_spr, BundleName.LADDER, \"res/\" + ladderData.icon_id);\r\n\r\n        let starChange = 0;\r\n        if (fightResultData.result == 1) {\r\n            this.star_lbl.node.color = cc.Color.GREEN;\r\n            starChange = fightResultData.star_num;\r\n            this.star_lbl.string = \"+ \" + fightResultData.star_num;\r\n        } else {\r\n            this.star_lbl.node.color = cc.Color.RED;\r\n            const buildData = gm.data.mapCell_data.getBuildDataByType(BuildTypeEnum.GARRISION_TYPE);\r\n            if (buildData && buildData.buildLvl >= 1) {\r\n                this.star_lbl.string = \"- \" + ladderData.failed_star;\r\n                starChange = -ladderData.failed_star;\r\n            } else {\r\n                this.star_lbl.string = \"- 0\";\r\n                starChange = 0;\r\n            }\r\n        }\r\n        this.cur_star_lbl.string = Math.max(0, gm.data.ladder_temp_data.total_star + starChange).toString();\r\n        this.watch_ad_btn.node.active = !gm.data.mapCell_data.isGuide;\r\n        this.hand_node.active = gm.data.mapCell_data.isGuide;\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        if (event.target == this.home_btn.node) {\r\n            gm.data.fight_temp_data.map_end_many_times = 1;\r\n            gm.ui.async_hide_module(gm.const.FightResult);\r\n            gm.ui.async_hide_module(gm.const.Fight);\r\n            gm.ui.show_start();\r\n            gm.channel.report_event(\"ohayoo_game_guide\", {\r\n                guideid: 17,\r\n                guidedesc: cc.js.formatStr(\"17.点击结算界面的返航按钮\")\r\n            });\r\n        } else if (event.target == this.watch_ad_btn.node) {\r\n            gm.channel.show_video_ad(this.watch_ad_cb, this);\r\n        }\r\n    }\r\n\r\n    private watch_ad_cb(): void {\r\n        ReportData.instance.report_once_point(10829);\r\n        ReportData.instance.report_point(10830);\r\n        gm.ui.async_hide_module(gm.const.FightResult);\r\n        gm.ui.async_hide_module(gm.const.Fight);\r\n        gm.data.fight_temp_data.map_end_many_times = this.CURTIMES;\r\n        gm.ui.show_start();\r\n        gm.channel.report_event(\"ohayoo_game_guide\", {\r\n            guideid: 17,\r\n            guidedesc: cc.js.formatStr(\"17.点击结算界面的返航按钮\")\r\n        });\r\n    }\r\n}"]}