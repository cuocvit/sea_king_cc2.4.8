{"version":3,"sources":["assets\\start-scene\\scripts\\SignData.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAGA,6CAAmC;AACnC,6CAA4C;AAE5C,EAAE;AACF;IAA8B,4BAAW;IAcrC,IAAI;IACJ;QAAA,YACI,iBAAO,SAQV;QAPG,KAAI,CAAC,WAAW,GAAG,UAAU,CAAC,CAAC,cAAc;QAC7C,KAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QAClB,KAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,KAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,KAAI,CAAC,aAAa,GAAG,CAAC,CAAC;QACvB,KAAI,CAAC,eAAe,GAAG,EAAE,CAAC;QAC1B,KAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;;IAClC,CAAC;IAED,aAAa;IACN,kCAAe,GAAtB,UAAuB,QAA8B;QAArD,iBA4CC;QA3CG,iBAAM,eAAe,YAAC,UAAC,IAAS;YAC5B,IAAI,KAAI,CAAC,OAAO,EAAE;gBACd,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBAClD,MAAM,CAAC,cAAc,CAAC,KAAI,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,YAAY,CAAC,SAAS,CAAC,CAAC;iBAC1E;gBACD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACtD,MAAM,CAAC,cAAc,CAAC,KAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,EAAE,eAAe,CAAC,SAAS,CAAC,CAAC;iBACjF;aACJ;iBAAM;gBACH,KAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;gBAClB,KAAI,CAAC,UAAU,GAAG,CAAC,CAAC;gBACpB,IAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;gBACxB,IAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;gBACpD,KAAI,CAAC,WAAW,GAAG,SAAS,GAAG,CAAC,SAAS,GAAG,EAAE,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC,GAAG,KAAK,CAAC;gBACnF,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,WAAW,GAAG,KAAK,CAAC;gBAC9C,EAAE;gBACF,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,aAAa,EAAE,CAAC,EAAE,EAAE;oBAC7C,IAAM,QAAQ,GAAG,IAAI,YAAY,EAAE,CAAC;oBACpC,QAAQ,CAAC,WAAW,GAAG,CAAC,CAAC;oBACzB,QAAQ,CAAC,GAAG,GAAG,CAAC,KAAI,CAAC,QAAQ,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC;oBAChE,QAAQ,CAAC,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjC,IAAM,OAAO,GAAG,gBAAE,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,EAAE,QAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAe,CAAC;oBAChG,IAAI,OAAO,EAAE;wBACT,QAAQ,CAAC,YAAY,GAAG,OAAO,CAAC,YAAY,CAAC;qBAChD;oBACD,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBACvC;gBACD,EAAE;gBACF,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,aAAa,EAAE,CAAC,EAAE,EAAE;oBAC7C,IAAM,WAAW,GAAG,IAAI,eAAe,EAAE,CAAC;oBAC1C,WAAW,CAAC,WAAW,GAAG,CAAC,CAAC;oBAC5B,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC;oBACtB,IAAM,OAAO,GAAG,gBAAE,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC,KAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAe,CAAC;oBACvG,IAAI,OAAO,EAAE;wBACT,WAAW,CAAC,WAAW,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;qBAC3D;oBACD,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;iBAC9C;gBACD,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBACpB,KAAI,CAAC,gBAAgB,EAAE,CAAC;aAC3B;YACD,IAAI,QAAQ;gBAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;IACP,CAAC,EAAC,uBAAuB;IAEzB,IAAI;IACG,mCAAgB,GAAvB,UAAwB,QAAqB;QACzC,gBAAE,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;QACvD,iBAAM,gBAAgB,YAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;IA5ED,IAAI;IACU,0BAAiB,GAAW,kBAAkB,CAAC;IAC/C,sBAAa,GAAW,EAAE,CAAC;IAC3B,sBAAa,GAAW,CAAC,CAAC;IAC1B,sBAAa,GAAW,CAAC,CAAC;IAyE5C,eAAC;CA9ED,AA8EC,CA9E6B,yBAAW,GA8ExC;AA9EY,4BAAQ;AAgFrB,6BAA6B;AAC7B;IAMI;QACI,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;QACtB,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;QACb,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IAC3B,CAAC;IACL,mBAAC;AAAD,CAZA,AAYC,IAAA;AAZY,oCAAY;AAczB,0BAA0B;AAC1B;IAKI;QACI,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;QACtB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACnB,CAAC;IACL,sBAAC;AAAD,CATA,AASC,IAAA;AATY,0CAAe","file":"","sourceRoot":"/","sourcesContent":["// @\r\nimport { rewardArr } from '../../common/configs/ladder_building';\r\nimport { OtherReward, SignConfig } from '../../common/configs/sign';\r\nimport { gm } from './GameManager';\r\nimport { StorageBase } from './StorageBase';\r\n\r\n//\r\nexport class SignData extends StorageBase {\r\n    // @\r\n    public static EVENT_DATA_CHANGE: string = \"sign_data_change\";\r\n    public static MAX_DAY_COUNT: number = 30;\r\n    public static SIGN_LOOP_DAY: number = 7;\r\n    public static MAX_BUY_COUNT: number = 3;\r\n    // @\r\n    public sign_day: number;\r\n    public sign_state: number;\r\n    private create_time: number; // (public mode not used)\r\n    public next_day_time: number;\r\n    public sign_data_array: SignItemData[];\r\n    public sign_buy_data_array: SignBuyItemData[];\r\n\r\n    // @\r\n    constructor() {\r\n        super();\r\n        this.STORAGE_KEY = \"SignData\"; // StorageBase\r\n        this.sign_day = 0;\r\n        this.sign_state = 0;\r\n        this.create_time = 0;\r\n        this.next_day_time = 0;\r\n        this.sign_data_array = [];\r\n        this.sign_buy_data_array = [];\r\n    }\r\n\r\n    // @, !!!type\r\n    public async_read_data(callback?: (data: any) => void): void {\r\n        super.async_read_data((data: any) => {\r\n            if (this.is_init) {\r\n                for (let i = 0; i < this.sign_data_array.length; i++) {\r\n                    Object.setPrototypeOf(this.sign_data_array[i], SignItemData.prototype);\r\n                }\r\n                for (let i = 0; i < this.sign_buy_data_array.length; i++) {\r\n                    Object.setPrototypeOf(this.sign_buy_data_array[i], SignBuyItemData.prototype);\r\n                }\r\n            } else {\r\n                this.sign_day = 0;\r\n                this.sign_state = 0;\r\n                const date = new Date();\r\n                const timestamp = Math.floor(date.getTime() / 1000);\r\n                this.create_time = timestamp - (timestamp - 60 * date.getTimezoneOffset()) % 86400;\r\n                this.next_day_time = this.create_time + 86400;\r\n                //\r\n                for (let i = 0; i < SignData.SIGN_LOOP_DAY; i++) {\r\n                    const signItem = new SignItemData();\r\n                    signItem.array_index = i;\r\n                    signItem.day = (this.sign_day + i + 1) % SignData.MAX_DAY_COUNT;\r\n                    signItem.state = i === 0 ? 1 : 0;\r\n                    const rowData = gm.config.get_row_data(\"SignConfigData\", signItem.day.toString()) as SignConfig;\r\n                    if (rowData) {\r\n                        signItem.reward_array = rowData.reward_array;\r\n                    }\r\n                    this.sign_data_array.push(signItem);\r\n                }\r\n                //\r\n                for (let i = 0; i < SignData.MAX_BUY_COUNT; i++) {\r\n                    const signBuyItem = new SignBuyItemData();\r\n                    signBuyItem.array_index = i;\r\n                    signBuyItem.state = 1;\r\n                    const rowData = gm.config.get_row_data(\"SignConfigData\", (this.sign_day + 1).toString()) as SignConfig;\r\n                    if (rowData) {\r\n                        signBuyItem.reward_data = rowData.other_reward_array[i];\r\n                    }\r\n                    this.sign_buy_data_array.push(signBuyItem);\r\n                }\r\n                this.is_init = true;\r\n                this.async_write_data();\r\n            }\r\n            if (callback) callback(data);\r\n        });\r\n    } // end: async_read_data\r\n\r\n    // @\r\n    public async_write_data(callback?: () => void): void {\r\n        gm.data.event_emitter.emit(SignData.EVENT_DATA_CHANGE);\r\n        super.async_write_data(callback);\r\n    }\r\n}\r\n\r\n// @, !!! reward_array: any[]\r\nexport class SignItemData {\r\n    public array_index: number;\r\n    public day: number;\r\n    public state: number;\r\n    public reward_array: rewardArr[]; // ?\r\n\r\n    constructor() {\r\n        this.array_index = -1;\r\n        this.day = 0;\r\n        this.state = 0;\r\n        this.reward_array = [];\r\n    }\r\n}\r\n\r\n// @ , !! reward_data: any\r\nexport class SignBuyItemData {\r\n    public array_index: number;\r\n    public state: number;\r\n    public reward_data: OtherReward;\r\n\r\n    constructor() {\r\n        this.array_index = -1;\r\n        this.state = 0;\r\n    }\r\n}\r\n"]}