{"version":3,"sources":["assets\\book\\scripts\\SceneBookLogic.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BookConfig } from '../../common/configs/books';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport SceneBookView from './SceneBookView';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass SceneBookLogic extends cc.Component {\r\n    private pView: SceneBookView | null;\r\n    private tSubTypeLists: Record<number, number[]> | null;\r\n    private tLvLists: Record<number, number[]> | null;\r\n    private sCurTab: string | null = null;\r\n    private tDelayCds: Record<number, number> | null;\r\n\r\n    public static readonly SUB_TYPE_HERO: number = 1;\r\n    public static readonly SUB_TYPE_HERO_WALL: number = 2;\r\n    public static readonly SUB_TYPE_MATERIAL_NORMAL: number = 3;\r\n    public static readonly SUB_TYPE_MATERIAL_SPECIAL: number = 4;\r\n    public static readonly SUB_TYPE_MATERIAL_RARE: number = 5;\r\n    public static readonly SUB_TYPE_DECORATE: number = 6;\r\n    public static readonly SUB_TYPE_SUPER_HERO: number = 7;\r\n    public static readonly SUB_TYPE_DEFEND: number = 8;\r\n\r\n    public constructor() {\r\n        super();\r\n        this.pView = null;\r\n        this.tSubTypeLists = null;\r\n        this.tLvLists = null;\r\n        this.sCurTab = null;\r\n        this.tDelayCds = null;\r\n    }\r\n\r\n    public setView(view: SceneBookView): void {\r\n        this.pView = view;\r\n    }\r\n\r\n    protected onLoad(): void { }\r\n\r\n    private doEvent(): void { }\r\n\r\n    protected onEnable(): void {\r\n        this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO);\r\n        this.showTabHero();\r\n        this.refreshRed();\r\n    }\r\n\r\n    private getMaxLvListBySubType(subType: number): number[] {\r\n        const list = this.getListBySubType(subType);\r\n        const maxLvList: number[] = [];\r\n        for (let i = 0; i < list.length; i++) {\r\n            let item = list[i];\r\n            const lvList = this.getLvList(item);\r\n            let maxItem = item;\r\n            for (let j = 0; j < lvList.length; j++) {\r\n                const lvItem = lvList[j];\r\n                if (this.checkIsUnlock(lvItem)) {\r\n                    maxItem = lvItem;\r\n                }\r\n            }\r\n            maxLvList.push(maxItem);\r\n        }\r\n        return maxLvList;\r\n    }\r\n\r\n    private getLvListBySubType(...subTypes: number[]): number[] {\r\n        const lvList: number[] = [];\r\n        for (let i = 0; i < subTypes.length; i++) {\r\n            const subType = subTypes[i];\r\n            const list = this.getListBySubType(subType);\r\n            for (let j = 0; j < list.length; j++) {\r\n                const item = list[j];\r\n                const levels = this.getLvList(item);\r\n                lvList.push(...levels);\r\n            }\r\n        }\r\n        return lvList;\r\n    }\r\n\r\n    private getListBySubType(subType: number): number[] {\r\n        if (this.tSubTypeLists == null) {\r\n            this.tSubTypeLists = {};\r\n            this.tLvLists = {};\r\n            const configData = gm.config.get_config_data(\"BookConfigData\");\r\n            for (const key in configData.data) {\r\n                const item = configData.data[key] as BookConfig;\r\n                if (this.tSubTypeLists[item.sub_type] == null) {\r\n                    this.tSubTypeLists[item.sub_type] = [];\r\n\r\n                }\r\n                if (this.getLv(item.id) == 1) {\r\n                    this.tSubTypeLists[item.sub_type].push(item.id);\r\n                }\r\n                const lvKey = Math.floor(item.id / 10);\r\n                if (this.tLvLists[lvKey] == null) {\r\n                    this.tLvLists[lvKey] = [];\r\n                }\r\n                this.tLvLists[lvKey].push(item.id);\r\n            }\r\n        }\r\n        return this.tSubTypeLists[subType] || [];\r\n    }\r\n\r\n    private checkListHaveRed(list: number[], hasRed: boolean = false): boolean {\r\n        if (hasRed) return true;\r\n        for (let i = 0; i < list.length; i++) {\r\n            if (gm.data.mapCell_data.checkBookItemHaveUnlockReward(list[i])) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public refreshRed(): void {\r\n        const heroList = this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO);\r\n        const heroWallList = this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO_WALL);\r\n        const heroWallLvList = this.getLvList(heroWallList[0]);\r\n        let hasRed = this.checkListHaveRed(heroList, false);\r\n        hasRed = this.checkListHaveRed(heroWallLvList, hasRed);\r\n        this.pView.refreshRed(\"btn_hero\", hasRed);\r\n\r\n        const materialList = this.getLvListBySubType(SceneBookLogic.SUB_TYPE_MATERIAL_NORMAL, SceneBookLogic.SUB_TYPE_MATERIAL_SPECIAL, SceneBookLogic.SUB_TYPE_MATERIAL_RARE);\r\n        hasRed = this.checkListHaveRed(materialList, false);\r\n        this.pView.refreshRed(\"btn_item\", hasRed);\r\n\r\n        const decorateList = this.getLvListBySubType(SceneBookLogic.SUB_TYPE_DECORATE);\r\n        hasRed = this.checkListHaveRed(decorateList, false);\r\n        this.pView.refreshRed(\"btn_decorate\", hasRed);\r\n    }\r\n\r\n    private showTabHero(): void {\r\n        this.sCurTab = \"btn_hero\";\r\n        this.pView.showTabPanel(\"btn_hero\");\r\n        this.pView.refreshSelectTabBtn(\"btn_hero\");\r\n        this.pView.recyleBookItems();\r\n\r\n        const superHeroList = this.getListBySubType(SceneBookLogic.SUB_TYPE_SUPER_HERO);\r\n        const heroList = this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO);\r\n        const defendList = this.getListBySubType(SceneBookLogic.SUB_TYPE_DEFEND);\r\n        const heroWallList = this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO_WALL);\r\n        const heroWallLvList = this.getLvList(heroWallList[0]);\r\n\r\n        this.resetDelayCds(heroList, heroWallLvList);\r\n        this.pView.initSuperHeroList(superHeroList);\r\n        this.pView.initHeroList(heroList);\r\n        this.pView.initDefendList(defendList);\r\n        this.pView.initWallList(heroWallLvList);\r\n    }\r\n\r\n    private showTabItem(): void {\r\n        this.pView.recyleBookItems();\r\n        this.sCurTab = \"btn_item\";\r\n        this.pView.showTabPanel(\"btn_item\");\r\n        this.pView.refreshSelectTabBtn(\"btn_item\");\r\n\r\n        const normalList = this.getMaxLvListBySubType(SceneBookLogic.SUB_TYPE_MATERIAL_NORMAL);\r\n        const specialList = this.getMaxLvListBySubType(SceneBookLogic.SUB_TYPE_MATERIAL_SPECIAL);\r\n        const rareList = this.getMaxLvListBySubType(SceneBookLogic.SUB_TYPE_MATERIAL_RARE);\r\n\r\n        this.resetDelayCds(normalList, specialList, rareList);\r\n        this.pView.initNormalList(normalList);\r\n        this.pView.initSpecialList(specialList);\r\n        this.pView.initResList(rareList);\r\n    }\r\n\r\n    private showTabDecorate(): void {\r\n        this.pView.recyleBookItems();\r\n        this.sCurTab = \"btn_decorate\";\r\n        this.pView.showTabPanel(\"btn_decorate\");\r\n        this.pView.refreshSelectTabBtn(\"btn_decorate\");\r\n\r\n        const decorateList = this.getMaxLvListBySubType(SceneBookLogic.SUB_TYPE_DECORATE);\r\n        this.resetDelayCds(decorateList);\r\n        this.pView.initDecorateList(decorateList);\r\n    }\r\n\r\n    private showTabFormula(): void {\r\n        this.pView.recyleBookItems();\r\n        this.sCurTab = \"btn_formula\";\r\n        this.pView.showTabPanel(\"btn_formula\");\r\n        this.pView.refreshSelectTabBtn(\"btn_formula\");\r\n        this.resetDelayCds();\r\n\r\n        const heroList = this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO);\r\n        const heroWallList = this.getListBySubType(SceneBookLogic.SUB_TYPE_HERO_WALL);\r\n        const heroWallLvList = this.getLvList(heroWallList[0]);\r\n        const formulaGroups: Record<string, number[]> = {};\r\n\r\n        for (let i = 0; i < heroList.length; i++) {\r\n            const item = heroList[i];\r\n            const rowData = gm.config.get_row_data(\"BookConfigData\", item.toString()) as BookConfig;\r\n            if (rowData.unlock_formula.length > 0) {\r\n                if (!formulaGroups[rowData.formula_group]) {\r\n                    formulaGroups[rowData.formula_group] = [];\r\n                }\r\n                formulaGroups[rowData.formula_group].push(item);\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < heroWallLvList.length; i++) {\r\n            const item = heroWallLvList[i];\r\n            const rowData = gm.config.get_row_data(\"BookConfigData\", item.toString()) as BookConfig;\r\n            if (rowData.unlock_formula.length > 0) {\r\n                if (!formulaGroups[rowData.formula_group]) {\r\n                    formulaGroups[rowData.formula_group] = [];\r\n                }\r\n                formulaGroups[rowData.formula_group].push(item);\r\n            }\r\n        }\r\n\r\n        this.pView.initFormulaList(formulaGroups);\r\n    }\r\n\r\n    private resetDelayCds(...lists: number[][]): void {\r\n        if (lists.length == 0) {\r\n            this.tDelayCds = null;\r\n        } else {\r\n            this.tDelayCds = {};\r\n            let delay = 0;\r\n            for (let i = 0; i < lists.length; i++) {\r\n                const list = lists[i];\r\n                for (let j = 0; j < list.length; j++) {\r\n                    this.tDelayCds[list[j]] = delay += 0.1;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public getDelayCd(id: number): number {\r\n        return this.tDelayCds && this.tDelayCds[id] !== null ? this.tDelayCds[id] : 0;\r\n    }\r\n\r\n    public refreshCurTab(): void {\r\n        if (this.sCurTab != null) {\r\n            this.onBtnClick(this.sCurTab);\r\n        }\r\n    }\r\n\r\n    private getLv(id: number): number {\r\n        return id - 10 * Math.floor(id / 10);\r\n    }\r\n\r\n    public getLvList(id: number): number[] {\r\n        const lvKey = Math.floor(id / 10);\r\n        return this.tLvLists ? this.tLvLists[lvKey] || [] : [];\r\n    }\r\n\r\n    public checkIsUnlock(id: number): boolean {\r\n        return gm.data.mapCell_data.checkBookItemIsUnlock(id);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.ui.emit(\"bookRedStatus\");\r\n    }\r\n\r\n    public onBtnClick(buttonId: string, event: cc.Event = null): void {\r\n        switch (buttonId) {\r\n            case \"btn_close\":\r\n            case \"bg\":\r\n                gm.ui.async_hide_module(gm.const.BOOK);\r\n                break;\r\n            case \"btn_hero\":\r\n                this.showTabHero();\r\n                break;\r\n            case \"btn_item\":\r\n                this.showTabItem();\r\n                break;\r\n            case \"btn_decorate\":\r\n                this.showTabDecorate();\r\n                break;\r\n            case \"btn_formula\":\r\n                this.showTabFormula();\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nexport default SceneBookLogic;"]}