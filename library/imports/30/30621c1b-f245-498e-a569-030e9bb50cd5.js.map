{"version":3,"sources":["assets\\start-scene\\scripts\\NewHeroAnim.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { Utils } from './Utils';\r\nimport { BundleName } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { NodePoolItem } from './NodePoolItem';\r\nimport { HeroConfig } from '../../common/configs/hero';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass NewHeroAnim extends cc.Component {\r\n    @property(cc.Sprite)\r\n    private hero_sprite: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private hero_color_sprite: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private hero_profession_sprite: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private hero_profession2_sprite: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private left_item_sprite: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private right_item_sprite: cc.Sprite | null = null;\r\n\r\n    @property(cc.Label)\r\n    private hero_name_lbl: cc.Label | null = null;\r\n\r\n    @property(cc.Node)\r\n    private roleNode: cc.Node | null = null;\r\n\r\n    private _heroID: number = 0;\r\n\r\n    protected onEnable(): void {\r\n        this.node.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED, this.playAnimEnd, this);\r\n        if (0 < this.roleNode.childrenCount) {\r\n            gm.pool.put_children(this.roleNode);\r\n        }\r\n\r\n        gm.audio.play_effect(gm.const.AUDIO_163_UNLOCK_NEW_HERO_ANIM);\r\n        this._heroID = gm.ui.get_module_args(gm.const.NEWHEROANIM.key) as number;\r\n        this.hero_color_sprite.node.active = this.hero_profession_sprite.node.active = this.hero_profession2_sprite.node.active = this.hero_name_lbl.node.active = true;\r\n\r\n        const heroData = gm.config.get_row_data(\"HeroConfigData\", this._heroID.toString()) as HeroConfig;\r\n        if (!heroData) {\r\n            gm.pool.put_children(this.roleNode);\r\n            gm.ui.async_hide_module(gm.const.NEWHEROANIM);\r\n            return;\r\n        }\r\n\r\n        gm.pool.async_get(BundleName.COMMON, \"prefabs/model/\" + heroData.heroid, NodePoolItem, (nodePoolItem) => {\r\n            if (0 == this.roleNode.childrenCount) {\r\n                this.roleNode.addChild(nodePoolItem.node);\r\n                nodePoolItem.node.x = 0;\r\n                nodePoolItem.node.y = -69;\r\n                nodePoolItem.node.scale = 2.5;\r\n                if (nodePoolItem.getComponent(sp.Skeleton)) {\r\n                    nodePoolItem.getComponent(sp.Skeleton).setSkin(\"front\");\r\n                    nodePoolItem.getComponent(sp.Skeleton).setAnimation(0, \"stay\", true);\r\n                }\r\n            } else {\r\n                gm.pool.put(nodePoolItem.node);\r\n            }\r\n        });\r\n\r\n        Utils.async_set_sprite_frame(this.hero_color_sprite, BundleName.COMMON, \"res/circleColor_\" + heroData.color);\r\n        Utils.async_set_sprite_frame(this.hero_sprite, BundleName.COMMON, \"res/heroCircleImg/\" + heroData.heroid);\r\n        this.hero_name_lbl.string = heroData.name;\r\n\r\n        if (heroData.occupation <= 6) {\r\n            this.hero_profession_sprite.node.active = true;\r\n            if (3 < heroData.occupation) {\r\n                this.hero_profession2_sprite.node.active = true;\r\n                Utils.async_set_sprite_frame(this.hero_profession_sprite, BundleName.BUILD_FUNCTION, \"res/1\");\r\n                Utils.async_set_sprite_frame(this.hero_profession2_sprite, BundleName.BUILD_FUNCTION, \"res/2\");\r\n            } else {\r\n                Utils.async_set_sprite_frame(this.hero_profession_sprite, BundleName.BUILD_FUNCTION, \"res/\" + heroData.occupation);\r\n                this.hero_profession2_sprite.node.active = false;\r\n            }\r\n\r\n        } else {\r\n            this.hero_profession_sprite.node.active = this.hero_profession2_sprite.node.active = !1;\r\n        }\r\n\r\n        Utils.async_set_sprite_frame(this.left_item_sprite, BundleName.COMMON, \"res/heroCircleImg/\" + heroData.itemType[0]);\r\n        Utils.async_set_sprite_frame(this.right_item_sprite, BundleName.MAP, \"res/\" + heroData.itemType[1]);\r\n        this.node.getComponent(cc.Animation).play();\r\n    }\r\n\r\n    private playAnimEnd(event: cc.Animation.EventType, animationName: { name: string }): void {\r\n        if (\"newHero\" == animationName.name) {\r\n            gm.pool.put_children(this.roleNode);\r\n            gm.ui.async_hide_module(gm.const.NEWHEROANIM);\r\n        }\r\n    }\r\n}\r\n\r\nexport default NewHeroAnim;"]}