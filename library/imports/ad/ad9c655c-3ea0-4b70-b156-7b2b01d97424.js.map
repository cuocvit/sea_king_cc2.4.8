{"version":3,"sources":["assets\\start-scene\\scripts\\WaterBarrelItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// *-*\r\nimport { Utils } from './Utils';\r\nimport { BundleName } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { NodePoolItem } from './NodePoolItem';\r\nimport { roleBarrelItemVO } from './MapCellCfgData';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class WaterBarrelItem extends NodePoolItem {\r\n  @property(cc.Sprite)\r\n  private barrelSpr: cc.Sprite | null = null;\r\n\r\n  private _curBarrelData: roleBarrelItemVO;\r\n  private _curIndex: number;\r\n\r\n  constructor() {\r\n    super();\r\n    this._curIndex = 0;\r\n    this._curBarrelData = {} as roleBarrelItemVO;\r\n  }\r\n\r\n  public initData(curBarrelData: roleBarrelItemVO, curIndex: number): void {\r\n    this._curBarrelData = curBarrelData;\r\n    this.node.position = this._curBarrelData.itemPos;\r\n    this._curIndex = curIndex;\r\n  }\r\n\r\n  protected onEnable(): void {\r\n    Utils.async_set_sprite_frame(this.barrelSpr, BundleName.MAP, \"res/barrel/\" + this._curBarrelData.itemID),\r\n      this.node.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED, (t, e) => {\r\n        if (\"case_open\" == e.name) {\r\n          this.node.getComponent(cc.Button).interactable = true;\r\n          this.node.getComponent(cc.Animation).play(\"case_normal\");\r\n\r\n        } else if (\"case_close\" == e.name) {\r\n          gm.data.mapCell_data.addBarrelInMap(this._curBarrelData.itemID);\r\n          gm.pool.put(this.node);\r\n          if (gm.data.mapCell_data.isGuide) {\r\n            gm.ui.mapMainUI.checkHandAnimDelay();\r\n          }\r\n        }\r\n      }, this);\r\n\r\n    for (let index = 0; index < this.node.childrenCount; index++) {\r\n      this.node.children[index].opacity = 0;\r\n    }\r\n\r\n    this.scheduleOnce(() => {\r\n      this.node.getComponent(cc.Animation).play(\"case_open\");\r\n    }, .3 * this._curIndex);\r\n  }\r\n\r\n  private onClickOpen(): void {\r\n    if (gm.data.mapCell_data.getIsHaveSpeceCellID()) {\r\n      gm.audio.play_effect(gm.const.AUDIO_10_JIANMUTONG);\r\n      for (let index = 0; index < gm.data.mapCell_data.waterBarrelList.length; index++) {\r\n        if (gm.data.mapCell_data.waterBarrelList[index].itemIndex == this._curBarrelData.itemIndex) {\r\n          gm.data.mapCell_data.waterBarrelList.splice(index, 1);\r\n          gm.data.mapCell_data.async_write_data();\r\n        }\r\n      }\r\n      gm.ui.mapMainUI.handAnim.active = false,\r\n        this.node.getComponent(cc.Button).interactable = false,\r\n        this.node.getComponent(cc.Animation).play(\"case_close\")\r\n    } else {\r\n      gm.ui.show_auto_merge_message();\r\n    }\r\n  }\r\n\r\n  protected onDisable(): void {\r\n    this.node.getComponent(cc.Animation).targetOff(this);\r\n  }\r\n}"]}