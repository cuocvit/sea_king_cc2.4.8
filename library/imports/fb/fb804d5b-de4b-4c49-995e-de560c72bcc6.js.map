{"version":3,"sources":["assets\\record\\scripts\\RecordEntry.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { RecordData } from '../../start-scene/scripts/RecordData';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { NodePoolItem } from '../../start-scene/scripts/NodePoolItem';\r\nimport { Timer } from '../../start-scene/scripts/Timer';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass RecordEntry extends NodePoolItem {\r\n  @property(cc.Button)\r\n  private record_start_btn: cc.Button = null;\r\n\r\n  @property(cc.Button)\r\n  private record_stop_btn: cc.Button = null;\r\n\r\n  @property(cc.Label)\r\n  private time_lbl: cc.Label = null;\r\n\r\n  private _time: Timer | null = null;\r\n\r\n  protected onEnable(): void {\r\n    gm.data.event_emitter.on(RecordData.RECORD_STATE_CHANGE, this.on_record_state_change_handler, this);\r\n    this.on_record_state_change_handler();\r\n  }\r\n\r\n  protected onDisable(): void {\r\n    gm.data.event_emitter.off(RecordData.RECORD_STATE_CHANGE, this.on_record_state_change_handler, this);\r\n    if (this._time) this._time.stop();\r\n  }\r\n\r\n  private editor_on_button_click_handler(event: cc.Event): void {\r\n    if (event.target == this.record_start_btn.node) {\r\n      gm.ui.show_panel(gm.const.Record);\r\n    } else if (event.target == this.record_stop_btn.node) {\r\n      if (Math.floor((Date.now() - gm.data.record_data.record_timestamp) / 1e3) < RecordData.MIN_RECORD_TIME) {\r\n        gm.ui.show_notice(cc.js.formatStr(\"Thời gian ghi không được ít hơn %d giây!!!\", RecordData.MIN_RECORD_TIME))\r\n      } else {\r\n        this.stop_record();\r\n      }\r\n    }\r\n  }\r\n\r\n  private on_record_state_change_handler(): void {\r\n    this.record_start_btn.node.active = 1 != gm.data.record_data.record_state;\r\n    this.record_stop_btn.node.active = 1 == gm.data.record_data.record_state;\r\n    if (1 == gm.data.record_data.record_type) {\r\n      if (1 == gm.data.record_data.record_state) {\r\n        if (!this._time) {\r\n          this._time = new Timer;\r\n        }\r\n\r\n        if (!this._time.is_running) {\r\n          this._time.start(() => {\r\n            const elapsedTime = Math.floor((Date.now() - gm.data.record_data.record_timestamp) / 1e3);\r\n            this.time_lbl.string = Utils.time_format(elapsedTime, \"mm:ss\");\r\n            if (elapsedTime >= RecordData.AUTO_END_RECORD_TIME) {\r\n              this._time.stop();\r\n              this.stop_record();\r\n            }\r\n          }, 1e3, 0);\r\n        }\r\n\r\n      } else if (this._time) {\r\n        this._time.stop();\r\n      }\r\n    }\r\n  }\r\n\r\n  private stop_record(): void {\r\n    gm.channel.record_stop(false);\r\n    gm.data.record_data.record_state = 2;\r\n    gm.data.event_emitter.emit(RecordData.RECORD_STATE_CHANGE);\r\n    gm.ui.show_panel(gm.const.Record);\r\n  }\r\n}"]}