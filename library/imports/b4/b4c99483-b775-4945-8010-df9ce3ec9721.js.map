{"version":3,"sources":["assets\\start-scene\\scripts\\CavesUnlock.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { Utils } from './Utils';\r\nimport { SpecialEnum, SetItemNumEnum, BundleName } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { TaskConditionType } from './TaskData';\r\nimport { ReportData } from './NetUtils';\r\nimport { Special } from \"../../common/configs/special\";\r\nimport { special } from './MapCellCfgData';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport interface LocalData {\r\n    mertrail: { [key: number]: number };\r\n}\r\n\r\n@ccclass\r\nclass CavesUnlock extends cc.Component {\r\n    @property([cc.Node])\r\n    private meterialNode: cc.Node[] = [];\r\n\r\n    @property(cc.Label)\r\n    private lblCoin: cc.Label | null = {} as cc.Label;\r\n\r\n    @property([cc.SpriteFrame])\r\n    private btnSprList: cc.SpriteFrame[] = [];\r\n\r\n    @property(cc.Sprite)\r\n    private btnSpr: cc.Sprite | null = null;\r\n\r\n    private _curSpecialCfg: Special | null = null;\r\n    private _localdData: special | null = null;\r\n    private _curFunID: SpecialEnum = SpecialEnum.CAVES_TYPE;\r\n    private _matraEnough: boolean = true;\r\n    private _tempList: number[] = [];\r\n\r\n    protected onEnable(): void {\r\n        gm.ui.on(\"coin_change\", this.refreshCoin, this);\r\n        this._curSpecialCfg = gm.data.config_data.getSpecialByID(this._curFunID);\r\n        this._localdData = gm.data.mapCell_data.specialList[this._curFunID];\r\n        this.refreshPanel();\r\n    }\r\n\r\n    private refreshPanel(): void {\r\n        this._matraEnough = true;\r\n        this._tempList = [];\r\n        if (this._curSpecialCfg && this._localdData) {\r\n            for (let index = 0; index < this.meterialNode.length; index++) {\r\n                this.meterialNode[index].active = true;\r\n            }\r\n\r\n            for (let index = 0; index < this._curSpecialCfg.prop.length; index++) {\r\n                const prop = this._curSpecialCfg.prop[index];\r\n                if (0 < prop) {\r\n                    this._tempList.push(prop);\r\n                    this.meterialNode[index].active = true;\r\n                    this.meterialNode[index].children[1].getComponent(cc.Label).string = this._localdData.mertrail[prop] + \"/\" + this._curSpecialCfg.value[index];\r\n                    const heroCfg = gm.data.config_data.getHeroCfgByID(prop);\r\n                    if (heroCfg) {\r\n                        Utils.async_set_sprite_frame(this.meterialNode[index].children[0].getComponent(cc.Sprite), BundleName.COMMON, \"res/heroCircleImg/\" + heroCfg.icon);\r\n                    }\r\n\r\n                    if (this._localdData.mertrail[prop] < this._curSpecialCfg.value[index]) {\r\n                        this._matraEnough = false;\r\n                        this.meterialNode[index].color = cc.Color.WHITE;\r\n                        this.meterialNode[index].children[2].active = true;\r\n                        this.meterialNode[index].children[3].active = false;\r\n                        this.meterialNode[index].children[2].children[0].width = this._localdData.mertrail[prop] / this._curSpecialCfg.value[index] * 80;\r\n                        this.meterialNode[index].children[2].children[1].children[0].active = !gm.data.mapCell_data.getHeroNum(heroCfg.occupation, heroCfg.heroid);\r\n\r\n                    } else {\r\n                        this.meterialNode[index].children[2].active = false;\r\n                        this.meterialNode[index].children[3].active = true;\r\n                        this.meterialNode[index].color = cc.Color.BLACK.fromHEX(\"#86cbB4e\");\r\n                    }\r\n                }\r\n            }\r\n            this.refreshCoin();\r\n        }\r\n    }\r\n\r\n    private onClickClose(): void {\r\n        this.node.active = false;\r\n    }\r\n\r\n    private onClickAddMetrail(event: cc.Event, index: string): void {\r\n        const idx = parseInt(index);\r\n        gm.data.mapCell_data.onekeyGetAllSpecialHeroMertrail(this._curFunID, this._tempList[idx]);\r\n        this.refreshPanel();\r\n    }\r\n\r\n    private onClickUpgrade(): void {\r\n        if (this._matraEnough && gm.data.mapCell_data.roleCoinData.coinNum < this._curSpecialCfg.coin) {\r\n            gm.ui.set_module_args(gm.const.GETCOINOP.key, false);\r\n            gm.ui.async_show_module(gm.const.GETCOINOP);\r\n            return;\r\n        }\r\n\r\n        if (this._matraEnough) {\r\n            gm.data.mapCell_data.specialList[SpecialEnum.CAVES_TYPE].state = 2;\r\n            gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.REDUCE_ITEM_TYPE, this._curSpecialCfg.coin);\r\n            gm.ui.emit(\"open_special_fun\", 143);\r\n            gm.ui.mapMainUI.roleBuildAnimNode.active = false;\r\n            gm.data.mapCell_data.lockCaveAllInitCell(gm.const.CAVESAREAID);\r\n            gm.data.task_data.update_task_progress(TaskConditionType.UNLOCK_CAVERN);\r\n            gm.channel.report_event(\"unlock_play\", {\r\n                event_desc: \"解锁玩法\",\r\n                desc: cc.js.formatStr(\"解锁玩法%s\", \"洞窟\")\r\n            });\r\n            ReportData.instance.report_once_point(10604);\r\n            this.onClickClose();\r\n            gm.ui.set_module_args(gm.const.GOBATTLE.key, 2);\r\n            gm.ui.async_show_module(gm.const.GOBATTLE);\r\n        }\r\n    }\r\n\r\n    private refreshCoin(): void {\r\n        this.lblCoin.string = this._curSpecialCfg.coin + \"\";\r\n        this.lblCoin.node.color = cc.Color.RED;\r\n        if (gm.data.mapCell_data.roleCoinData.coinNum >= this._curSpecialCfg.coin) {\r\n            this.lblCoin.node.color = cc.Color.BLACK.fromHEX(\"#FFD53C\");\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.ui.off(\"coin_change\", this.refreshCoin, this);\r\n    }\r\n}\r\n\r\n// export default CavesUnlock;"]}