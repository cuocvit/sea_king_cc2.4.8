{"version":3,"sources":["assets\\test\\scripts\\MapMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import MapEditor from './MapEditor';\r\nimport { MapItemVo } from './MapItemVo';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass MapMgr extends cc.Component {\r\n  @property(cc.EditBox)\r\n  private edit1: cc.EditBox = null;\r\n\r\n  @property(cc.EditBox)\r\n  private edit2: cc.EditBox = null;\r\n\r\n  @property(cc.Node)\r\n  private mapNode: cc.Node = null;\r\n\r\n  @property(cc.Node)\r\n  private itemNode: cc.Node = null;\r\n\r\n  @property(cc.Node)\r\n  private bigMapNode: cc.Node = null;\r\n\r\n  private num1: number = 0;\r\n  private num2: number = 0;\r\n  private _mapList: (MapItemVo | null)[] = [];\r\n\r\n  protected onEnable(): void {\r\n    this.bigMapNode.on(cc.Node.EventType.TOUCH_MOVE, (t) => {\r\n      this.bigMapNode.y += t.getDelta().y;\r\n    }, this);\r\n\r\n    this.itemNode.removeFromParent();\r\n    this.clearAllNode();\r\n    this._mapList = [];\r\n\r\n    const map = cc.sys.localStorage.getItem(\"mapData_sailing\");\r\n    console.log(\"Map: \", map);\r\n    if (map) {\r\n      const data = JSON.parse(map);\r\n      this.num1 = data.row;\r\n      this.num2 = data.col;\r\n      this._mapList = data.mapData;\r\n\r\n      if (!(20 < this.num1 || this.num1 <= 0 || 23 < this.num2 || this.num2 <= 0)) {\r\n        this.mapNode.width = 50 * this.num1, this.clearAllNode();\r\n        for (let num2 = this.bigMapNode.y = 0; num2 < this.num2; num2++) {\r\n          for (let num1 = 0; num1 < this.num1; num1++) {\r\n            const instant = cc.instantiate(this.itemNode);\r\n            instant.children[0].getComponent(cc.Label).string = num2 * this.num1 + num1 + \"\";\r\n            instant.color = null == data.mapData[num2 * this.num1 + num1] ? cc.Color.WHITE : cc.Color.RED;\r\n            data.mapData[num2 * this.num1 + num1];\r\n            this.mapNode.addChild(instant);\r\n            this.mapNode.children[num2].targetOff(this);\r\n          }\r\n        }\r\n\r\n        for (let index = 0; index < this.mapNode.childrenCount; index++) {\r\n          ((index: number) => {\r\n            this.mapNode.children[index].targetOff(this);\r\n            this.mapNode.children[index].on(cc.Node.EventType.TOUCH_END, () => {\r\n              if (this.mapNode.children[index].color.toString() == cc.Color.WHITE.toString()) {\r\n                this.mapNode.children[index].color = cc.Color.RED;\r\n                const mapItemVo = new MapItemVo\r\n                mapItemVo.itemID = index;\r\n                mapItemVo.itemIndex = 0;\r\n                mapItemVo.itemImgIndex = 1;\r\n                mapItemVo.itemYOffset = 9;\r\n                mapItemVo.itemTreeId = 0;\r\n                mapItemVo.itemTreeX = 0;\r\n                mapItemVo.itemTreeY = 76;\r\n                mapItemVo.isObstruct = 0;\r\n                this._mapList[index] = mapItemVo;\r\n              } else {\r\n                this.mapNode.children[index].color = cc.Color.WHITE;\r\n                this._mapList[index] = null;\r\n              }\r\n            }, this)\r\n          })(index);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  protected onDisable(): void { }\r\n\r\n  private clearAllNode(): void {\r\n    this.mapNode.children.forEach((child) => {\r\n      child.targetOff(this);\r\n      child.destroy();\r\n      child.removeFromParent();\r\n    });\r\n\r\n    this.mapNode.removeAllChildren();\r\n    this.edit1.string = \"0\";\r\n    this.edit2.string = \"0\";\r\n  }\r\n\r\n  private onClickNewEdit(): void {\r\n    this.num1 = parseInt(this.edit1.string);\r\n    this.num2 = parseInt(this.edit2.string);\r\n\r\n    if (!(20 < this.num1 || this.num1 <= 0 || 23 < this.num2 || this.num2 <= 0)) {\r\n      this.mapNode.width = 50 * this.num1;\r\n      this.clearAllNode();\r\n\r\n      for (let num2 = this.bigMapNode.y = 0; num2 < this.num2; num2++) {\r\n        for (let num1 = 0; num1 < this.num1; num1++) {\r\n          var o = cc.instantiate(this.itemNode);\r\n          o.children[0].getComponent(cc.Label).string = num2 * this.num1 + num1 + \"\";\r\n          o.color = cc.Color.WHITE;\r\n          this.mapNode.addChild(o);\r\n          this.mapNode.children[num2].targetOff(this);\r\n          this._mapList.push(null);\r\n        }\r\n      }\r\n      this.bigMapNode.on(cc.Node.EventType.TOUCH_MOVE, (t) => {\r\n        this.bigMapNode.y += t.getDelta().y;\r\n      }, this);\r\n\r\n      for (let index = 0; index < this.mapNode.childrenCount; index++) {\r\n        ((index: number) => {\r\n          this.mapNode.children[index].on(cc.Node.EventType.TOUCH_END, () => {\r\n            if (this.mapNode.children[index].color.toString() == cc.Color.WHITE.toString()) {\r\n              this.mapNode.children[index].color = cc.Color.RED;\r\n              const mapItemVo = new MapItemVo;\r\n              mapItemVo.itemID = index;\r\n              mapItemVo.itemIndex = 0;\r\n              mapItemVo.itemImgIndex = 1;\r\n              mapItemVo.itemYOffset = 9;\r\n              mapItemVo.itemTreeId = 0;\r\n              mapItemVo.itemTreeX = 0;\r\n              mapItemVo.itemTreeY = 76;\r\n              mapItemVo.isObstruct = 0;\r\n              mapItemVo.areaID = 0;\r\n              this._mapList[index] = mapItemVo;\r\n            } else {\r\n              this.mapNode.children[index].color = cc.Color.WHITE;\r\n              this._mapList[index] = null;\r\n            }\r\n          }, this)\r\n        })(index)\r\n      }\r\n    }\r\n  }\r\n\r\n  private onClickCreateMap(): void {\r\n    let itemIndex = 0;\r\n    for (let i = 0; i < this._mapList.length; i++) {\r\n      if (this._mapList[i]) {\r\n        this._mapList[i].itemIndex = itemIndex;\r\n        itemIndex++;\r\n      }\r\n    }\r\n    console.log(this._mapList);\r\n    const mapData = { row: this.num1, col: this.num2, mapData: this._mapList };\r\n    cc.sys.localStorage.setItem(\"mapData_sailing\", JSON.stringify(mapData));\r\n    this.node.parent.getChildByName(\"MapEdit\").getComponent(MapEditor).initData(this.num1, this.num2, this._mapList);\r\n    this.node.parent.getChildByName(\"MapEdit\").active = true;\r\n    this.node.active = false;\r\n  }\r\n}\r\n"]}