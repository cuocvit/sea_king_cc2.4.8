{"version":3,"sources":["assets\\start-scene\\scripts\\HeroStarData.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAEA,6CAAmC;AACnC,6CAA4C;AAE5C,EAAE;AACF;IAAkC,gCAAW;IAMzC,IAAI;IACJ;QAAA,YACI,iBAAO,SAGV;QARD,EAAE;QACK,oBAAc,GAA2B,EAAE,CAAC;QAK/C,KAAI,CAAC,WAAW,GAAG,cAAc,CAAC,CAAC,kBAAkB;QACrD,KAAI,CAAC,cAAc,GAAG,EAAE,CAAC;;IAC7B,CAAC;IAED,QAAQ;IACD,sCAAe,GAAtB,UAA0B,QAA4B;QAAtD,iBASC;QARG,iBAAM,eAAe,YAAC,UAAC,IAAO;YAC1B,IAAI,CAAC,KAAI,CAAC,OAAO,EAAE;gBACf,KAAI,CAAC,gBAAgB,EAAE,CAAC;gBACxB,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBACpB,KAAI,CAAC,gBAAgB,EAAE,CAAC;aAC3B;YACD,IAAI,QAAQ;gBAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;IACP,CAAC;IAED,QAAQ;IACA,uCAAgB,GAAxB;QACI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;YAC/C,IAAM,cAAc,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,EAAE,CAAC;YAC5D,KAAK,IAAM,GAAG,IAAI,cAAc,EAAE;gBAC9B,IAAI,cAAc,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;oBACpC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;iBACpE;aACJ;SACJ;IACL,CAAC;IAED,QAAQ;IACD,sCAAe,GAAtB,UAAuB,MAAc;QACjC,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,SAAS,EAAE;YAC1C,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SACpC;QACD,IAAI,CAAC,gBAAgB,EAAE,CAAC;IAC5B,CAAC;IAED,QAAQ;IACD,sCAAe,GAAtB,UAAuB,MAAc;QACjC,IAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAM,OAAO,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QACrE,IAAI,SAAS,KAAK,QAAQ,IAAI,OAAO,EAAE;YACnC,OAAO,OAAO,CAAC;SAClB;aAAM;YACH,OAAO,IAAI,CAAC;SACf;IACL,CAAC;IAED,2BAA2B;IACpB,uCAAgB,GAAvB,UAAwB,QAAqB;QACzC,gBAAE,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC;QAC3D,iBAAM,gBAAgB,YAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;IA3DD,IAAI;IACmB,8BAAiB,GAAW,sBAAsB,CAAC;IA2D9E,mBAAC;CA7DD,AA6DC,CA7DiC,yBAAW,GA6D5C;AA7DY,oCAAY","file":"","sourceRoot":"/","sourcesContent":["// @\r\nimport { StarConfig } from '../../common/configs/star';\r\nimport { gm } from './GameManager';\r\nimport { StorageBase } from './StorageBase';\r\n\r\n//\r\nexport class HeroStarData extends StorageBase {\r\n    // @\r\n    public static readonly EVENT_DATA_CHANGE: string = \"heroStar_data_change\";\r\n    //\r\n    public hero_star_data: Record<number, number> = {};\r\n\r\n    // @\r\n    constructor() {\r\n        super();\r\n        this.STORAGE_KEY = \"HeroStarData\"; // (extends super)\r\n        this.hero_star_data = {};\r\n    }\r\n\r\n    // @ !!!\r\n    public async_read_data<T>(callback?: (data: T) => void): void {\r\n        super.async_read_data((data: T) => {\r\n            if (!this.is_init) {\r\n                this.initHeroStarData();\r\n                this.is_init = true;\r\n                this.async_write_data();\r\n            }\r\n            if (callback) callback(data);\r\n        });\r\n    }\r\n\r\n    // @ !!!\r\n    private initHeroStarData(): void {\r\n        if (Object.keys(this.hero_star_data).length === 0) {\r\n            const starConfigList = gm.data.config_data.getStarCfgList();\r\n            for (const key in starConfigList) {\r\n                if (starConfigList.hasOwnProperty(key)) {\r\n                    this.hero_star_data[parseInt(key)] = starConfigList[key][0].star;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // @ !!!\r\n    public upgradeHeroStar(heroId: number): void {\r\n        if (this.hero_star_data[heroId] != undefined) {\r\n            this.hero_star_data[heroId] += 1;\r\n        }\r\n        this.async_write_data();\r\n    }\r\n\r\n    // @ !!!\r\n    public getHeroStarData(heroId: number): StarConfig | null {\r\n        const heroStar = this.hero_star_data[heroId];\r\n        const starCfg = gm.data.config_data.getStarCfgByID(heroId, heroStar);\r\n        if (undefined !== heroStar && starCfg) {\r\n            return starCfg;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    // @ (public mode not used)\r\n    public async_write_data(callback?: () => void): void {\r\n        gm.data.event_emitter.emit(HeroStarData.EVENT_DATA_CHANGE);\r\n        super.async_write_data(callback);\r\n    }\r\n}\r\n"]}