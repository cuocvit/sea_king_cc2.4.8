{"version":3,"sources":["assets\\test\\scripts\\ScaleMapDemo.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass ScaleMapDemo extends cc.Component {\r\n    @property(cc.Node)\r\n    private mapContent: cc.Node | null = null;\r\n\r\n    private startPos1: cc.Vec2 | null = null;\r\n    private startPos2: cc.Vec2 | null = null;\r\n    private pointsDis: number = 0;\r\n\r\n    protected onEnable2(): void {\r\n        console.count(\"onEnable\");\r\n        cc.macro.ENABLE_MULTI_TOUCH = true;\r\n        this.node.on(cc.Node.EventType.TOUCH_START, (event: cc.Event.EventTouch) => {\r\n            const touches = event.getTouches();\r\n            if (touches.length == 2) {\r\n                this.startPos1 = this.node.convertToNodeSpaceAR(touches[0].getLocation());\r\n                this.startPos2 = this.node.convertToNodeSpaceAR(touches[1].getLocation());\r\n                this.pointsDis = this.startPos1.sub(this.startPos2).mag();\r\n            }\r\n        });\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, (event: cc.Event.EventTouch) => {\r\n            const touches = event.getTouches();\r\n            if (touches.length != 2) {\r\n                this.mapContent.x += event.getDelta().x;\r\n                this.mapContent.y += event.getDelta().y;\r\n            } else {\r\n                const pos1 = this.node.convertToNodeSpaceAR(touches[0].getLocation());\r\n                const pos2 = this.node.convertToNodeSpaceAR(touches[1].getLocation());\r\n                const currentDis = pos1.sub(pos2).mag();\r\n                cc.warn(JSON.stringify(pos1));\r\n                cc.warn(JSON.stringify(pos2));\r\n                let scale = this.mapContent.scale;\r\n\r\n                if (currentDis > this.pointsDis) {\r\n                    this.pointsDis = currentDis;\r\n                    scale += 0.05;\r\n                } else if (currentDis < this.pointsDis) {\r\n                    this.pointsDis = currentDis;\r\n                    scale -= 0.05;\r\n                } else {\r\n                    console.warn(\"Scale unchanged\");\r\n                }\r\n\r\n                scale = Math.min(Math.max(scale, 1), 2);\r\n                console.log(`old_scale: ${this.mapContent.scale} new_scale: ${scale}`);\r\n                if (this.mapContent.scale !== scale) {\r\n                    this.mapContent.scale = scale;\r\n                    this.mapContent.getContentSize();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.on_touch_start, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.on_touch_move, this);\r\n    }\r\n\r\n    private on_touch_start(event: cc.Event.EventTouch): void {\r\n        const touches = event.getTouches();\r\n        if (touches.length == 2) {\r\n            this.startPos1 = this.mapContent.convertToNodeSpaceAR(touches[0].getLocation());\r\n            this.startPos2 = this.mapContent.convertToNodeSpaceAR(touches[1].getLocation());\r\n            this.pointsDis = this.startPos1.sub(this.startPos2).mag();\r\n        }\r\n    }\r\n\r\n    private on_touch_move(event: cc.Event.EventTouch): void {\r\n        const touches = event.getTouches();\r\n        if (touches.length != 2) {\r\n            this.mapContent.x += event.getDelta().x;\r\n            this.mapContent.y += event.getDelta().y;\r\n        } else {\r\n            const pos1 = this.mapContent.convertToNodeSpaceAR(touches[0].getLocation());\r\n            const pos2 = this.mapContent.convertToNodeSpaceAR(touches[1].getLocation());\r\n            const currentDis = pos1.sub(pos2).mag();\r\n            cc.warn(JSON.stringify(pos1));\r\n            cc.warn(JSON.stringify(pos2));\r\n            let scale = this.mapContent.scale;\r\n\r\n            if (currentDis > this.pointsDis) {\r\n                scale += 0.05;\r\n            } else if (currentDis < this.pointsDis) {\r\n                scale -= 0.05;\r\n            } else {\r\n                console.warn(\"Scale unchanged\");\r\n            }\r\n\r\n            scale = Math.min(Math.max(scale, 1), 2);\r\n            console.log(`old_scale: ${this.mapContent.scale} new_scale: ${scale}`);\r\n            if (this.mapContent.scale != scale) {\r\n                this.mapContent.scale = scale;\r\n                this.mapContent.getContentSize();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.node.off(cc.Node.EventType.TOUCH_START, this.on_touch_start, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.on_touch_move, this);\r\n    }\r\n}\r\n\r\nexport { ScaleMapDemo };"]}