{"version":3,"sources":["assets\\start-scene\\scripts\\TurtleExchange.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["//\r\nimport { GameModule } from './GameModule';\r\nimport { TurtleExchangeData } from './TurtleExchangeData';\r\nimport { gm } from './GameManager';\r\nimport { ListView } from './ListView';\r\nimport { RewardIdEnum } from './Constants';\r\nimport { Mudule } from \"./UIManager\"\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class TurtleExchange extends GameModule {\r\n    @property(cc.Node)\r\n    private mask_node: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private window_node: cc.Node | null = null;\r\n\r\n    @property(cc.Button)\r\n    private close_btn: cc.Button | null = null;\r\n\r\n    @property(ListView)\r\n    private exchange_list: ListView | null = null;\r\n\r\n    @property(cc.Label)\r\n    private refresh_count_lbl: cc.Label | null = null;\r\n\r\n    @property(cc.Button)\r\n    private refresh_btn: cc.Button | null = null;\r\n\r\n    @property(cc.Label)\r\n    private refresh_diamond_lbl: cc.Label | null = null;\r\n\r\n    private _args: Mudule;\r\n\r\n    protected onEnable(): void {\r\n        this._args = gm.ui.get_module_args(gm.const.Task.key);\r\n        gm.data.event_emitter.on(TurtleExchangeData.EVENT_DATA_CHANGE, this.update_view, this);\r\n        this.mask_node?.on(cc.Node.EventType.TOUCH_END, this.on_touch_end_handler, this);\r\n        this.update_view();\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.data.event_emitter.off(TurtleExchangeData.EVENT_DATA_CHANGE, this.update_view, this);\r\n        this.mask_node?.off(cc.Node.EventType.TOUCH_END, this.on_touch_end_handler, this);\r\n        this.exchange_list?.reset();\r\n    }\r\n\r\n    private update_view(): void {\r\n        const turtleExchangeData = gm.data.turtle_exchange_data;\r\n        this.refresh_count_lbl.string = cc.js.formatStr(\"Số lần：%d/%d\", turtleExchangeData.left_refresh_count, gm.const.TURTLE_EXCHANGE_MAX_REFRESH_COUNT);\r\n        this.refresh_diamond_lbl.string = gm.const.TURTLE_EXCHANGE_REFRESH_DIAMOND.toString();\r\n        this.exchange_list.setData(turtleExchangeData.get_turtle_exchange_data_array());\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        if (event.target === this.close_btn?.node) {\r\n            gm.ui.async_hide_module(gm.const.TurtleExchange);\r\n        } else if (event.target === this.refresh_btn?.node) {\r\n            const mapCellData = gm.data.mapCell_data;\r\n            if (mapCellData.roleCoinData.diamondNum < gm.const.TURTLE_EXCHANGE_REFRESH_DIAMOND) {\r\n                gm.ui.show_notice(\"Không đủ kim cương\");\r\n            } else {\r\n                mapCellData.delCellItem(RewardIdEnum.DIAMOND, gm.const.TURTLE_EXCHANGE_REFRESH_DIAMOND);\r\n                const turtleExchangeData = gm.data.turtle_exchange_data;\r\n                turtleExchangeData.left_refresh_count += gm.const.TURTLE_EXCHANGE_MAX_REFRESH_COUNT;\r\n                turtleExchangeData.async_write_data();\r\n            }\r\n        }\r\n    }\r\n\r\n    private on_touch_end_handler(event: cc.Event): void {\r\n        if (event.target === this.mask_node) {\r\n            gm.ui.async_hide_module(gm.const.TurtleExchange);\r\n        }\r\n    }\r\n}"]}