{"version":3,"sources":["assets\\mail\\scripts\\MailDetails.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BANNER_AD_TYPE } from '../../start-scene/scripts/ChannelManager';\r\nimport { BundleName, RewardIdEnum, SetItemNumEnum } from '../../start-scene/scripts/Constants';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { GameModule } from '../../start-scene/scripts/GameModule';\r\nimport { ListView } from '../../start-scene/scripts/ListView';\r\nimport { MailInboxItemData } from '../../start-scene/scripts/MailTempData';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport interface MailDetailsArgs {\r\n    data: MailInboxItemData\r\n}\r\n\r\n@ccclass\r\nclass MailDetails extends GameModule {\r\n    @property(cc.Button)\r\n    private close_btn: cc.Button | null = null;\r\n\r\n    @property(cc.Button)\r\n    private anywhere_close_btn: cc.Button | null = null;\r\n\r\n    @property(cc.Button)\r\n    private receive_btn: cc.Button | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private icon_spr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Label)\r\n    private title_lbl: cc.Label | null = null;\r\n\r\n    @property(cc.Label)\r\n    private sender_lbl: cc.Label | null = null;\r\n\r\n    @property(cc.Label)\r\n    private content_lbl: cc.Label | null = null;\r\n\r\n    @property(cc.Label)\r\n    private time_lbl: cc.Label | null = null;\r\n\r\n    @property(ListView)\r\n    private reward_list: ListView | null = null;\r\n\r\n    private _args: MailDetailsArgs;\r\n\r\n    protected onEnable(): void {\r\n        this._args = gm.ui.get_module_args(gm.const.MailDetails.key) as MailDetailsArgs;\r\n        this.update_view();\r\n        gm.channel.show_banner_ad(BANNER_AD_TYPE.ALL);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.reward_list.reset();\r\n        gm.channel.hide_banner_ad(BANNER_AD_TYPE.ALL);\r\n    }\r\n\r\n    private update_view(): void {\r\n        const mailData = this._args.data;\r\n        this.title_lbl.string = mailData.mail_title;\r\n        this.content_lbl.string = mailData.mail_text;\r\n        this.sender_lbl.string = \"Người Gửi：\" + mailData.mail_sender;\r\n        Utils.async_set_sprite_frame(this.icon_spr, BundleName.MAIL, \"res/icon_\" + mailData.mail_type);\r\n\r\n        if (!(1 != mailData.mail_type && 2 != mailData.mail_type)) {\r\n            this.reward_list.setData(mailData.reward_array);\r\n        }\r\n\r\n        this.receive_btn.interactable = 0 == mailData.reward_status;\r\n        Utils.set_sprite_state(this.receive_btn.node, 0 == mailData.reward_status ? cc.Sprite.State.NORMAL : cc.Sprite.State.GRAY);\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        if (event.target == this.close_btn.node || event.target == this.anywhere_close_btn.node) {\r\n            gm.ui.async_hide_module(gm.const.MailDetails);\r\n        } else if (event.target == this.receive_btn.node) {\r\n            const argsData = this._args.data;\r\n            const serverData = gm.data.server_data;\r\n            const requestData = {\r\n                uid: serverData.uid,\r\n                token: serverData.token,\r\n                mail_id: argsData.mail_id,\r\n                op_status: 0,\r\n                reward_status: 1\r\n            };\r\n            serverData.op_player_email((response) => {\r\n                if (0 == response.ResultCode) {\r\n                    const rewardListNode = this.reward_list.node;\r\n                    const rewardInfo = {\r\n                        type: 1,\r\n                        idList: [],\r\n                        numList: []\r\n                    };\r\n\r\n                    for (let index = 0; index < argsData.reward_array.length; index++) {\r\n                        const rewardArr = argsData.reward_array[index];\r\n                        if (23001 <= rewardArr.reward_id && rewardArr.reward_id <= 23099) {\r\n                            gm.data.mapCell_data.reelUnlcokHero(rewardArr.reward_id);\r\n\r\n                        } else if (rewardArr.reward_id == RewardIdEnum.GOLD) {\r\n                            gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.ADD_ITEM_TYPE, rewardArr.reward_num);\r\n                            gm.ui.show_coin_fly(RewardIdEnum.GOLD, rewardListNode.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n                            rewardInfo.idList.push(rewardArr.reward_id);\r\n                            rewardInfo.numList.push(rewardArr.reward_num);\r\n\r\n                        } else if (rewardArr.reward_id == RewardIdEnum.DIAMOND) {\r\n                            gm.data.mapCell_data.setAddGameDiamond(SetItemNumEnum.ADD_ITEM_TYPE, rewardArr.reward_num);\r\n                            gm.ui.show_coin_fly(RewardIdEnum.DIAMOND, rewardListNode.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n                            rewardInfo.idList.push(rewardArr.reward_id);\r\n                            rewardInfo.numList.push(rewardArr.reward_num);\r\n\r\n                        } else if (rewardArr.reward_id == RewardIdEnum.BARREL) {\r\n                            gm.data.mapCell_data.addBarrelNum(rewardArr.reward_num);\r\n                            rewardInfo.idList.push(rewardArr.reward_id);\r\n                            rewardInfo.numList.push(rewardArr.reward_num);\r\n\r\n                        } else {\r\n                            const rewardList = [];\r\n                            for (let index = 0; index < rewardArr.reward_num; index++) {\r\n                                rewardList.push(rewardArr.reward_id);\r\n                            }\r\n\r\n                            gm.data.mapCell_data.addWareHouseList(rewardList);\r\n                            rewardInfo.idList.push(rewardArr.reward_id);\r\n                            rewardInfo.numList.push(rewardArr.reward_num);\r\n                        }\r\n                    }\r\n\r\n                    gm.ui.set_module_args(gm.const.GETREWARDOP.key, {\r\n                        idList: rewardInfo.idList,\r\n                        numList: rewardInfo.numList\r\n                    });\r\n\r\n                    gm.ui.async_show_module(gm.const.GETREWARDOP);\r\n                    argsData.reward_status = 1;\r\n                    gm.ui.async_hide_module(gm.const.MailDetails);\r\n                }\r\n            }, requestData)\r\n        }\r\n    }\r\n}"]}