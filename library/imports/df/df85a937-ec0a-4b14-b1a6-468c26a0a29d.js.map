{"version":3,"sources":["assets\\start-scene\\scripts\\NetUtils.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ChannelManager } from \"./ChannelManager\";\r\n\r\n// @\r\nexport class ReportData {\r\n    private static _instance: ReportData | null = null;\r\n    //\r\n    PREFIX: string;\r\n    STORAGE_KEY: string;\r\n    only_once_point_map: Record<string, number>;\r\n    total_count_point_map: Record<string, number>;\r\n\r\n    // @\r\n    private constructor() {\r\n        this.PREFIX = \"P2_\",\r\n            this.STORAGE_KEY = \"ReportData\",\r\n            this.only_once_point_map = {};\r\n        this.total_count_point_map = {};\r\n        this.read_data();\r\n        this.write_data();\r\n    }\r\n\r\n    // @\r\n    public static get instance(): ReportData {\r\n        if (this._instance === null) {\r\n            this._instance = new ReportData();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    // @\r\n    public report_once_point(point: number): void {\r\n        if (!this.only_once_point_map[point]) {\r\n            this.only_once_point_map[point] = 1;\r\n            this.write_data();\r\n            NetUtils.report_point(point);\r\n        }\r\n    }\r\n\r\n    // @\r\n    public report_point(point: number): void {\r\n        NetUtils.report_point(point);\r\n    }\r\n\r\n    // @\r\n    public write_data(replacer?: (this: any, key: string, value: any) => any): void {\r\n        try {\r\n            const data = JSON.stringify(this, replacer);\r\n            cc.sys.localStorage.setItem(this.PREFIX + this.STORAGE_KEY, data);\r\n        } catch (error) {\r\n            cc.error(\"ReportData->write_data error:\", error);\r\n        }\r\n    }\r\n\r\n    // @\r\n    public read_data(): void {\r\n        try {\r\n            const data = cc.sys.localStorage.getItem(this.PREFIX + this.STORAGE_KEY);\r\n            if (data) {\r\n                let parsedData = null;\r\n                try {\r\n                    parsedData = JSON.parse(data);\r\n                } catch (error) {\r\n                    // Player data deserialization failed -> 玩家数据反序列化失败\r\n                    console.error(\"ReportData->read_data error: Player data deserialization failed.\");\r\n                    return;\r\n                }\r\n                for (const key in parsedData) {\r\n                    if (parsedData[key] != null) { // != null <=> !== null & !== undefined\r\n                        if (parsedData[key] instanceof Array) {\r\n                            this[key] = [];\r\n                            while (parsedData[key].length > 0) {\r\n                                this[key].push(parsedData[key].shift());\r\n                            }\r\n                        } else {\r\n                            this[key] = parsedData[key];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            cc.error(\"ReportData->read_data error:\", error);\r\n        }\r\n    } // end: read_data\r\n\r\n    // @\r\n    public clear_data(): void {\r\n        cc.sys.localStorage.removeItem(this.PREFIX + this.STORAGE_KEY);\r\n    }\r\n} // end: ReportData class\r\n\r\n// @\r\nexport class NetUtils {\r\n    public static PREFIX = \"P2_\";\r\n    public static STORAGE_KEY = \"GameUUID\";\r\n    public static VERSION_KEY = \"Version\";\r\n    public static HEAD = \"HEAD\";\r\n    public static GET = \"GET\";\r\n    public static POST = \"POST\";\r\n\r\n    // @\r\n    public static http_request(\r\n        url: string,\r\n        method: string,\r\n        successCallback?: (response: any, xhr: XMLHttpRequest) => void,\r\n        errorCallback?: (error: any, xhr: XMLHttpRequest) => void,\r\n        options?: Record<string, any>\r\n    ): void {\r\n        console.log(\"NetUtils->http_request:\", method, url);\r\n        if (Date.now() > 0) return; // Placeholder condition\r\n        //\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = () => {\r\n            if (xhr.readyState === 4) {\r\n                if (xhr.status >= 200 && xhr.status < 400) {\r\n                    let response = null;\r\n                    try {\r\n                        response = JSON.parse(xhr.responseText);\r\n                    } catch (error) {\r\n                        response = xhr.responseText;\r\n                    }\r\n                    console.log(\"NetUtils->http_request->onreadystatechange:\", response);\r\n                    if (typeof successCallback === \"function\") successCallback(response, xhr);\r\n                } else if (xhr.status < 100 || xhr.status >= 400) {\r\n                    if (typeof errorCallback === \"function\") errorCallback(null, xhr);\r\n                }\r\n            }\r\n        }\r\n        //\r\n        if (typeof options === \"object\") {\r\n            for (const key in options) {\r\n                xhr[key] = options[key];\r\n            }\r\n        }\r\n        xhr.open(method, url, true);\r\n        xhr.send();\r\n        // if (errorCallback) errorCallback(null, {});\r\n    } // end: http_request\r\n\r\n    // @\r\n    public static generate_uuid(): string {\r\n        return Date.now().toString(36) + \"_\" + Math.random().toString(36).substr(2);\r\n    }\r\n\r\n    // @\r\n    public static remove_uuid(): void {\r\n        cc.sys.localStorage.removeItem(this.PREFIX + this.STORAGE_KEY);\r\n    }\r\n\r\n    // @\r\n    public static get_version(): number {\r\n        try {\r\n            const version = cc.sys.localStorage.getItem(this.PREFIX + this.VERSION_KEY);\r\n            return isNaN(version) ? parseInt(version) : 0;\r\n        } catch (error) {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    // @\r\n    public static set_version(version: string): void {\r\n        cc.sys.localStorage.setItem(this.PREFIX + this.VERSION_KEY, version);\r\n    }\r\n\r\n    // @\r\n    public static get game_uuid(): string {\r\n        if (!window.game_uuid) {\r\n            window.game_uuid = cc.sys.localStorage.getItem(this.PREFIX + this.STORAGE_KEY);\r\n            if (!window.game_uuid) {\r\n                window.game_uuid = this.generate_uuid();\r\n                cc.sys.localStorage.setItem(this.PREFIX + this.STORAGE_KEY, window.game_uuid);\r\n            }\r\n        }\r\n        return window.game_uuid;\r\n    }\r\n\r\n    // @\r\n    public static save_game_uuid(): void {\r\n        if (window.game_uuid) {\r\n            console.log(\"save Game: \", window.game_uuid);\r\n            cc.sys.localStorage.setItem(this.PREFIX + this.STORAGE_KEY, window.game_uuid);\r\n        }\r\n    }\r\n\r\n    // @\r\n    public static get channel_name(): string {\r\n        let platformName = \"unknown\";\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            platformName = window.tt ? \"tt-game\" : window.qq ? \"qq-game\" : window.wx ? \"wechat-game\" : \"unknown\";\r\n        } else if (cc.sys.platform === cc.sys.BYTEDANCE_GAME) {\r\n            platformName = \"tt-game\";\r\n        } else {\r\n            platformName = ChannelManager.instance.get_channel_name();\r\n        }\r\n        return platformName;\r\n    }\r\n\r\n    // @\r\n    public static get game_app_name(): string {\r\n        const cName = this.channel_name;\r\n        if (cName === \"tt-game\") {\r\n            return window.tt && window.tt.getSystemInfoSync ? window.tt.getSystemInfoSync().appName : \"unknown\";\r\n        }\r\n        return cName === \"qq-game\" ? \"qq\" : cName === \"wechat-game\" ? \"wechat\" : ChannelManager.instance.get_app_name();\r\n    }\r\n\r\n    // @\r\n    public static report_point(point: number, value: number = 1): void {\r\n        if (this.is_cloud_test()) {\r\n            cc.log(\"NetUtils->report_point: Currently in cloud testing environment, reporting point is disabled.\");\r\n        } else if (point != null && value != null) {\r\n            // != null <=> !== null & !== undefined\r\n            const url = cc.js.formatStr(\r\n                \"https://gameapipy.6hwan.com/log/minigame_report/?gamename=sailing_%s&uuid=%s&op_type=%s&val=%s\",\r\n                this.game_app_name,\r\n                this.game_uuid,\r\n                point.toString(),\r\n                value.toString()\r\n            );\r\n            this.http_request(url, this.POST);\r\n        }\r\n    }\r\n\r\n    // @\r\n    public static is_cloud_test(): boolean {\r\n        return (typeof GameGlobal === \"object\" && GameGlobal.isTest);\r\n    }\r\n} // end: NetUtils class\r\n"]}