{"version":3,"sources":["assets\\special_build\\scripts\\StoreList.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameModule } from '../../start-scene/scripts/GameModule';\r\nimport { ListView } from '../../start-scene/scripts/ListView';\r\nimport { Timer } from '../../start-scene/scripts/Timer';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\nimport { RecordData } from '../../start-scene/scripts/RecordData';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { SetItemNumEnum } from '../../start-scene/scripts/Constants';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass StoreList extends GameModule {\r\n    @property(cc.Node)\r\n    private show_panle: cc.Node = null;\r\n\r\n    @property(ListView)\r\n    private store_list: ListView = null;\r\n\r\n    @property(ListView)\r\n    private daily_list: ListView = null;\r\n\r\n    @property(ListView)\r\n    private video_list: ListView = null;\r\n\r\n    @property(ListView)\r\n    private diamond_list: ListView = null;\r\n\r\n    @property(cc.Button)\r\n    private btn_close: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private btn_refresh: cc.Button = null;\r\n\r\n    @property(cc.Label)\r\n    private ref_time_lbl: cc.Label = null;\r\n\r\n    @property(cc.Button)\r\n    private btn_close_bg: cc.Button = null;\r\n\r\n    private _time: Timer | null = null;\r\n\r\n    protected onLoad(): void { }\r\n\r\n    protected onEnable(): void {\r\n        if (gm.data.store_data.refresh_time <= Date.now() / 1000 || gm.data.store_data.daily_store_array.length > 4) {\r\n            gm.data.store_data.refresh_store();\r\n        }\r\n        gm.data.event_emitter.on(RecordData.RECORD_STATE_CHANGE, this.on_record_state_change_handler, this);\r\n        this.on_record_state_change_handler();\r\n        this.showStoreList();\r\n        this.showStoreDailyList();\r\n        this.showVideoDailyList();\r\n        this.showDiamondDailyList();\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.store_list.reset();\r\n        this.daily_list.reset();\r\n        this.video_list.reset();\r\n        this.diamond_list.reset();\r\n        gm.data.event_emitter.off(RecordData.RECORD_STATE_CHANGE, this.on_record_state_change_handler, this);\r\n        this._time && this._time.stop();\r\n    }\r\n\r\n    private on_record_state_change_handler(): void {\r\n        if (!this._time) {\r\n            this._time = new Timer();\r\n        }\r\n        if (!this._time.is_running) {\r\n            this._time.start(() => {\r\n                const time: number = Math.floor(gm.data.store_data.refresh_time - Date.now() / 1000);\r\n                this.ref_time_lbl.string = \"Thời gian làm mới: \" + Utils.time_format(time, \"mm:ss\");\r\n                if (time <= 0) {\r\n                    gm.data.store_data.refresh_store();\r\n                    this.showStoreDailyList();\r\n                    this.showStoreList();\r\n                }\r\n            }, 1000, 0);\r\n        }\r\n    }\r\n\r\n    private showStoreList(): void {\r\n        this.store_list.setData(gm.data.store_data.store_array);\r\n    }\r\n\r\n    private showStoreDailyList(): void {\r\n        this.daily_list.setData(gm.data.store_data.daily_store_array);\r\n    }\r\n\r\n    private showVideoDailyList(): void {\r\n        this.video_list.setData(gm.data.store_data.video_store_array);\r\n    }\r\n\r\n    private showDiamondDailyList(): void {\r\n        this.diamond_list.setData(gm.data.store_data.diamond_store_array);\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        if (event.target === this.btn_close.node || event.target === this.btn_close_bg.node) {\r\n            gm.ui.async_hide_module(gm.const.Store);\r\n        } else if (event.target === this.btn_refresh.node) {\r\n            if (gm.data.mapCell_data.roleCoinData.diamondNum < 5) {\r\n                gm.ui.show_notice(\"Không đủ kim cương\");\r\n            } else {\r\n                gm.data.mapCell_data.setAddGameDiamond(SetItemNumEnum.REDUCE_ITEM_TYPE, 5);\r\n                gm.data.store_data.refresh_store();\r\n                this.showStoreDailyList();\r\n                this.showStoreList();\r\n                this.showDiamondDailyList();\r\n                this.showVideoDailyList();\r\n            }\r\n        }\r\n    }\r\n}"]}