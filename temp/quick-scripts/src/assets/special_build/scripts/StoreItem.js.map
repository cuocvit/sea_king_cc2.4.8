{"version":3,"sources":["assets\\special_build\\scripts\\StoreItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BundleName, RewardIdEnum } from '../../start-scene/scripts/Constants';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { ListViewItem } from '../../start-scene/scripts/ListViewItem';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\nimport { ReportData } from '../../start-scene/scripts/NetUtils';\r\nimport { ShopConfig } from '../../common/configs/shop';\r\nimport { ItemConfig } from '../../common/configs/item';\r\nimport { HeroConfig } from '../../common/configs/hero';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass StoreItem extends ListViewItem {\r\n    @property(cc.Button)\r\n    private btn_add: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private btn_free: cc.Button = null;\r\n\r\n    @property(cc.Node)\r\n    private btn_sold: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    private price_lbl: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    private count_lbl: cc.Label = null;\r\n\r\n    @property(cc.Sprite)\r\n    private icon_sprite: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    private cost_sprite: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    private lvl_sprite: cc.Sprite = null;\r\n\r\n    @property(cc.Label)\r\n    private item_count_lbl: cc.Label = null;\r\n\r\n    public _data: { id: number, index: number };\r\n\r\n    public get data(): { id: number, index: number } {\r\n        return this._data;\r\n    }\r\n\r\n    public set data(value: { id: number, index: number }) {\r\n        this._data = value;\r\n        this.update_view();\r\n    }\r\n\r\n    public update_view(): void {\r\n        this.node.active = false;\r\n        this.scheduleOnce(() => {\r\n            this.node.active = true;\r\n        }, 0.1 * this._data.index);\r\n\r\n        const rowData = gm.config.get_row_data(\"ShopConfigData\", this._data.id.toString()) as ShopConfig;\r\n        this.item_count_lbl.string = \"\";\r\n        if (rowData.item_num > 1) {\r\n            this.item_count_lbl.string = \"x\" + rowData.item_num;\r\n        }\r\n\r\n\r\n        if (rowData.item_id > 30000) {\r\n            const itemData = gm.config.get_row_data(\"HeroConfigData\", rowData.item_id.toString()) as HeroConfig;\r\n            this.lvl_sprite.node.active = true;\r\n            Utils.async_set_sprite_frame(this.lvl_sprite, BundleName.SPECIAL_BUILD, \"res/\" + itemData.lv);\r\n            Utils.async_set_sprite_frame(this.icon_sprite, BundleName.COMMON, \"res/handbook/\" + itemData.icon);\r\n        } else {\r\n            const itemConfig = gm.config.get_row_data(\"ItemConfigData\", rowData.item_id.toString()) as ItemConfig;\r\n            Utils.async_set_sprite_frame(this.icon_sprite, BundleName.COMMON, \"res/handbook/\" + itemConfig.icon);\r\n            this.lvl_sprite.node.active = false;\r\n        }\r\n\r\n        const storeCount = rowData.shop_type < 100 ? gm.data.store_data.getStoreCount(rowData.shop_id) : gm.data.store_data.getDailyStoreCount(rowData.shop_id);\r\n        this.count_lbl.string = rowData.limit_num - storeCount + \"/\" + rowData.limit_num;\r\n\r\n        if (storeCount >= rowData.limit_num) {\r\n            this.btn_sold.active = true;\r\n            this.btn_free.node.active = false;\r\n            this.btn_add.node.active = false;\r\n        } else {\r\n            this.btn_sold.active = false;\r\n            if (rowData.money_type > 0) {\r\n                this.btn_free.node.active = false;\r\n                this.btn_add.node.active = true;\r\n                this.price_lbl.string = rowData.price.toString();\r\n                const moneyConfig = gm.config.get_row_data(\"ItemConfigData\", rowData.money_type.toString()) as ItemConfig;\r\n                Utils.async_set_sprite_frame(this.cost_sprite, BundleName.COMMON, \"res/handbook/\" + moneyConfig.icon);\r\n            } else {\r\n                this.btn_free.node.active = true;\r\n                this.btn_add.node.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n\r\n    private onClick(): void {\r\n        if (gm.data.mapCell_data.getIsHaveSpeceCellID()) {\r\n            const rowData = gm.config.get_row_data(\"ShopConfigData\", this._data.id.toString()) as ShopConfig;\r\n            const storeCount = rowData.shop_type < 100 ? gm.data.store_data.getStoreCount(rowData.shop_id) : gm.data.store_data.getDailyStoreCount(rowData.shop_id);\r\n            if (storeCount >= rowData.limit_num) {\r\n                gm.ui.show_notice(\"Sản phẩm đã bán hết. Bạn có thể mua lại sau khi làm mới.\");\r\n            } else {\r\n                let moneyType = \"\";\r\n                let audioEffectId1 = 0;\r\n                let audioEffectId2 = 0;\r\n\r\n                if (rowData.money_type > 0) {\r\n                    if (gm.data.mapCell_data.getMertrailIDCount(rowData.money_type) < rowData.price) {\r\n                        gm.ui.show_notice(\"Vật liệu không đủ!!!\");\r\n                        return;\r\n                    }\r\n                    gm.data.mapCell_data.delCellItem(rowData.money_type, rowData.price);\r\n                    switch (rowData.money_type) {\r\n                        case RewardIdEnum.WOOD:\r\n                            gm.audio.play_effect(gm.const.AUDIO_13_WOOD_BUY_ITEM);\r\n                            moneyType = \"木材\";\r\n                            audioEffectId1 = 10815;\r\n                            audioEffectId2 = 10816;\r\n                            break;\r\n                        case RewardIdEnum.GOLD:\r\n                            gm.audio.play_effect(gm.const.AUDIO_16_BUY_ITEM);\r\n                            moneyType = \"金币\";\r\n                            audioEffectId1 = 10813;\r\n                            audioEffectId2 = 10814;\r\n                            break;\r\n                        case RewardIdEnum.IRON:\r\n                            gm.audio.play_effect(gm.const.AUDIO_16_BUY_ITEM);\r\n                            moneyType = \"铁矿\";\r\n                            audioEffectId1 = 10817;\r\n                            audioEffectId2 = 10818;\r\n                            break;\r\n                        case RewardIdEnum.DIAMOND:\r\n                            gm.audio.play_effect(gm.const.AUDIO_14_DIAMOND_BUY_ITEM);\r\n                            moneyType = \"钻石\";\r\n                            audioEffectId1 = 10811;\r\n                            audioEffectId2 = 10812;\r\n                            break;\r\n                        default:\r\n                            gm.audio.play_effect(gm.const.AUDIO_16_BUY_ITEM);\r\n                            break;\r\n                    }\r\n                }\r\n\r\n                const itemConfig = gm.data.config_data.getItemCfgByID(rowData.item_id);\r\n                if (itemConfig) {\r\n                    gm.channel.report_event(\"store_buy_item\", {\r\n                        event_desc: \"货摊购买道具\",\r\n                        money: moneyType,\r\n                        item_index: this._data.index,\r\n                        item_name: itemConfig.name,\r\n                        desc: cc.js.formatStr(\"货摊购买道具%s\", itemConfig.name)\r\n                    });\r\n                    if (audioEffectId1 > 0) {\r\n                        ReportData.instance.report_once_point(audioEffectId1);\r\n                    }\r\n                    if (audioEffectId2 > 0) {\r\n                        ReportData.instance.report_point(audioEffectId2);\r\n                    }\r\n                }\r\n\r\n                gm.data.mapCell_data.addItem(rowData.item_id, rowData.item_num);\r\n                gm.ui.set_module_args(gm.const.GETREWARDOP.key, {\r\n                    idList: [rowData.item_id],\r\n                    numList: [rowData.item_num]\r\n                });\r\n                gm.ui.async_show_module(gm.const.GETREWARDOP);\r\n                if (rowData.shop_type < 100) {\r\n                    gm.data.store_data.updateStore(rowData.shop_id, 1);\r\n                } else {\r\n                    gm.data.store_data.updateDailyStore(rowData.shop_id, 1);\r\n                }\r\n                this.update_view();\r\n            }\r\n        } else {\r\n            gm.ui.show_auto_merge_message();\r\n        }\r\n    }\r\n}"]}