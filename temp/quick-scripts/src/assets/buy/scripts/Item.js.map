{"version":3,"sources":["assets\\buy\\scripts\\Item.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ListViewItem } from \"../../start-scene/scripts/ListViewItem\";\r\nimport { Utils } from \"../../start-scene/scripts/Utils\";\r\nimport { ReportData } from \"../../start-scene/scripts/NetUtils\";\r\nimport { gm } from \"../../start-scene/scripts/GameManager\";\r\nimport {\r\n    RewardIdEnum,\r\n    SetItemNumEnum,\r\n    BundleName,\r\n} from \"../../start-scene/scripts/Constants\";\r\nimport { SignItemData } from \"../../start-scene/scripts/SignData\";\r\nimport { BuyItemData } from \"./data\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class Item extends ListViewItem {\r\n    @property(cc.Label)\r\n    private day_lbl: cc.Label = null;\r\n\r\n    @property([cc.Sprite])\r\n    private reward_spr_array: cc.Sprite[] = [];\r\n\r\n    @property([cc.Label])\r\n    private reward_lbl_array: cc.Label[] = [];\r\n\r\n    @property(cc.Button)\r\n    private receive_btn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private video_receive_btn: cc.Button = null;\r\n\r\n    @property(cc.Sprite)\r\n    private item: cc.Sprite = null;\r\n\r\n    @property(cc.Label)\r\n    private lbl_price: cc.Label = null;\r\n\r\n    public _data: BuyItemData;\r\n\r\n    public get data(): BuyItemData {\r\n        return this._data;\r\n    }\r\n\r\n    public set data(value: BuyItemData) {\r\n        this._data = value;\r\n        this.update_view();\r\n    }\r\n\r\n    public update_view(): void {\r\n        const data = this._data;\r\n        this.day_lbl.string = cc.js.formatStr(\"Khuyến Mãi\");\r\n\r\n        for (let i = 0; i < data.reward_array.length; i++) {\r\n            console.log(data.reward_array);\r\n            Utils.async_set_sprite_frame(\r\n                this.reward_spr_array[i],\r\n                BundleName.MAP,\r\n                \"res/\" + data.reward_array[i].reward_id\r\n            );\r\n            this.reward_lbl_array[i].string =\r\n                data.reward_array[i].reward_num.toString();\r\n        }\r\n\r\n        if (\r\n            data.reward_itemId == 11002 &&\r\n            data.reward_array[1].reward_id == 11002\r\n        ) {\r\n            Utils.async_set_sprite_frame(\r\n                this.item,\r\n                BundleName.MAP,\r\n                \"res/rewardIcon/\" + data.reward_itemId\r\n            );\r\n            this.lbl_price.string = data.reward_price.toLocaleString(\"vi-VN\", {\r\n                style: \"currency\",\r\n                currency: \"VND\",\r\n            });\r\n            this.item.node.scale = 0.7;\r\n        } else {\r\n            Utils.async_set_sprite_frame(this.item, BundleName.Buy, \"\" + 2);\r\n            this.item.node.scale = 1;\r\n            this.lbl_price.string = data.reward_price.toLocaleString(\"vi-VN\", {\r\n                style: \"currency\",\r\n                currency: \"VND\",\r\n            });\r\n        }\r\n        this.receive_btn.interactable = true;\r\n    }\r\n\r\n    public reset(): void {}\r\n\r\n    private vnpay() {\r\n        const data = this.data;\r\n        console.log(\r\n            this.encryptNumber(12345) + \" so tien : \" + data.reward_price\r\n        );\r\n        window.open(\r\n            \"http://localhost:8080/SeverTuanAnh/vnpay_index/\" +\r\n                this.encryptNumber(data.reward_price),\r\n            \"_blank\"\r\n        );\r\n        localStorage.setItem(\"reward_price\", JSON.stringify(data));\r\n    }\r\n\r\n    private encryptNumber(number: number): string {\r\n        const ALPHABET = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n        let numStr = number.toString();\r\n        let encrypted = \"\";\r\n        const key: string = \"KEY\";\r\n        let keyLength = key.length;\r\n\r\n        for (let i = 0; i < numStr.length; i++) {\r\n            let digit = parseInt(numStr[i]);\r\n            let keyChar = key[i % keyLength]; // Lặp key nếu quá ngắn\r\n            let keyShift = ALPHABET.indexOf(keyChar.toUpperCase()); // Chuyển đổi ký tự key thành số\r\n\r\n            if (keyShift === -1) {\r\n                throw new Error(`Key chứa ký tự không hợp lệ: ${keyChar}`);\r\n            }\r\n\r\n            let shiftedValue = (digit + keyShift) % 26;\r\n            encrypted += ALPHABET[shiftedValue];\r\n        }\r\n\r\n        return encrypted;\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        const target = event.target;\r\n        if (target == this.receive_btn.node) {\r\n            // this.get_reward(1);\r\n            this.vnpay();\r\n        } else if (target == this.video_receive_btn.node) {\r\n            ReportData.instance.report_once_point(10527);\r\n            ReportData.instance.report_point(10528);\r\n            gm.channel.report_event(\"ohayoo_game_button_click\", {\r\n                ad_type: \"激励视频\",\r\n                rit_id: \"946114114\",\r\n                ad_position: \"签到_三倍奖励\",\r\n                ad_position_type: \"签到\",\r\n            });\r\n            gm.channel.show_video_ad(\r\n                () => {\r\n                    ReportData.instance.report_once_point(10627);\r\n                    ReportData.instance.report_point(10628);\r\n                    this.get_reward(3);\r\n                },\r\n                this,\r\n                {\r\n                    ad_position: \"签到_三倍奖励\",\r\n                    ad_position_type: \"签到\",\r\n                }\r\n            );\r\n        }\r\n    }\r\n\r\n    public get_reward(multiplier: number): void {\r\n        ReportData.instance.report_once_point(10833);\r\n        const data = this._data;\r\n        const rewardIds: number[] = [];\r\n        const rewardNums: number[] = [];\r\n\r\n        for (let i = 0; i < data.reward_array.length; i++) {\r\n            const reward = data.reward_array[i];\r\n            rewardIds.push(reward.reward_id);\r\n            rewardNums.push(reward.reward_num * multiplier);\r\n\r\n            if (reward.reward_id >= 23001 && reward.reward_id <= 23099) {\r\n                gm.data.mapCell_data.reelUnlcokHero(reward.reward_id);\r\n            } else if (reward.reward_id == RewardIdEnum.GOLD) {\r\n                gm.data.mapCell_data.setAddGameCoin(\r\n                    SetItemNumEnum.ADD_ITEM_TYPE,\r\n                    reward.reward_num * multiplier\r\n                );\r\n                gm.ui.show_coin_fly(\r\n                    RewardIdEnum.GOLD,\r\n                    this.node.convertToWorldSpaceAR(cc.Vec3.ZERO)\r\n                );\r\n            } else if (reward.reward_id == RewardIdEnum.DIAMOND) {\r\n                gm.data.mapCell_data.setAddGameDiamond(\r\n                    SetItemNumEnum.ADD_ITEM_TYPE,\r\n                    reward.reward_num * multiplier\r\n                );\r\n                gm.ui.show_coin_fly(\r\n                    RewardIdEnum.DIAMOND,\r\n                    this.node.convertToWorldSpaceAR(cc.Vec3.ZERO)\r\n                );\r\n            } else if (reward.reward_id == RewardIdEnum.BARREL) {\r\n                gm.data.mapCell_data.addBarrelNum(\r\n                    reward.reward_num * multiplier\r\n                );\r\n            } else {\r\n                const itemIds: number[] = [];\r\n                for (let j = 0; j < reward.reward_num * multiplier; j++) {\r\n                    itemIds.push(reward.reward_id);\r\n                }\r\n                gm.data.mapCell_data.addWareHouseList(itemIds);\r\n            }\r\n        }\r\n\r\n        gm.ui.set_module_args(gm.const.GETREWARDOP.key, {\r\n            idList: rewardIds,\r\n            numList: rewardNums,\r\n        });\r\n        gm.ui.async_show_module(gm.const.GETREWARDOP);\r\n        data.state = multiplier == 1 ? 2 : 3;\r\n        gm.data.sign_data.sign_state = data.state;\r\n        gm.data.sign_data.async_write_data();\r\n    }\r\n}\r\n"]}