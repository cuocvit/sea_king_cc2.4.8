{"version":3,"sources":["assets\\start-scene\\scripts\\SpecialGift.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { SetItemNumEnum, RewardIdEnum } from './Constants';\r\nimport { gm } from './GameManager';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass SpecialGift extends cc.Component {\r\n    @property(cc.Node)\r\n    private caseNode: cc.Node | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblTips: cc.Label | null = null;\r\n\r\n    @property([cc.Node])\r\n    private giftItem: cc.Node[] = [];\r\n\r\n    @property(cc.Node)\r\n    private giftRodeNode: cc.Node | null = null;\r\n\r\n    @property([cc.SpriteFrame])\r\n    private giftFrame: cc.SpriteFrame[] = [];\r\n\r\n    private _itemID: number = 0;\r\n    private _cellID: number = 0;\r\n    private _maxNumList: { [key: number]: number } = {\r\n        13: 8,\r\n        14: 5,\r\n        19: 7\r\n    };\r\n\r\n    protected onEnable(): void {\r\n        this.node.zIndex = gm.const.MAX_CELL_NUM + 3;\r\n        if (this._cellID && this._itemID) {\r\n            this.node.y = gm.ui.mapMainUI.mapContent.getChildByName(this._cellID.toString()).y + 90;\r\n            this.node.x = gm.ui.mapMainUI.mapContent.getChildByName(this._cellID.toString()).x + 30;\r\n\r\n            const itemConfig = gm.data.config_data.getItemCfgByID(this._itemID);\r\n            if (itemConfig) {\r\n                this.caseNode.position = this.giftItem[this._maxNumList[itemConfig.type] - 1].position,\r\n                    this.caseNode.children[2].getComponent(cc.ParticleSystem).resetSystem();\r\n\r\n                const maxNum = this._maxNumList[itemConfig.type];\r\n                if (maxNum) {\r\n                    if (13 == itemConfig.type) {\r\n                        this.caseNode.children[1].getComponent(cc.Sprite).spriteFrame = this.giftFrame[0];\r\n                    } else if (14 == itemConfig.type) {\r\n                        this.caseNode.children[1].getComponent(cc.Sprite).spriteFrame = this.giftFrame[1];\r\n                    } else {\r\n                        this.caseNode.children[1].getComponent(cc.Sprite).spriteFrame = this.giftFrame[2];\r\n                    }\r\n\r\n                    const itemName = 13 == itemConfig.type ? \"超级英雄\" : 14 == itemConfig.type ? \"超级炮塔\" : \"水精灵\";\r\n                    this.lblTips.string = \"可合成\" + itemName;\r\n\r\n                    for (let index = 0; index < this.giftItem.length; index++) {\r\n                        this.giftItem[index].active = false;\r\n                        this.giftItem[index].active = itemConfig.lv - 2 >= index;\r\n                        this.giftRodeNode.children[index].active = index < maxNum;\r\n                    }\r\n\r\n                    this.node.runAction(cc.sequence(cc.delayTime(.5), cc.callFunc(() => {\r\n                        this.giftItem[itemConfig.lv - 1].active = true;\r\n                    }), cc.delayTime(1.5), cc.callFunc(() => {\r\n                        if (itemConfig.lv == maxNum) {\r\n                            gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.ADD_ITEM_TYPE, itemConfig.number);\r\n                            gm.ui.show_coin_fly(RewardIdEnum.DIAMOND, this.node.convertToWorldSpaceAR(cc.Vec3.ZERO), itemConfig.number);\r\n                        }\r\n                        this.node.active = false;\r\n                    })))\r\n                }\r\n            }\r\n        } else {\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    public initData(itemID: number, cellID: number): void {\r\n        this.node.stopAllActions();\r\n        this._itemID = itemID;\r\n        this._cellID = cellID;\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.node.stopAllActions();\r\n    }\r\n}\r\n\r\nexport default SpecialGift;"]}