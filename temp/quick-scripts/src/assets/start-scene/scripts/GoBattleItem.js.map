{"version":3,"sources":["assets\\start-scene\\scripts\\GoBattleItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { ListViewItem } from './ListViewItem';\r\nimport { Utils } from './Utils';\r\nimport { BundleName, HeroTypeEnum } from './Constants';\r\nimport { TempData } from './TempData';\r\nimport { gm } from './GameManager';\r\nimport { roleGoBattleItemVO, DefenseHeroItemVO } from './MapCellCfgData';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\ninterface TypeData {\r\n    heroID: number;\r\n    heroNum: number;\r\n    heroUID: number[];\r\n    heroHp: number;\r\n    hero_type: number;\r\n    cellID: number[];\r\n}\r\n\r\n@ccclass\r\nexport class GoBattleItem extends ListViewItem {\r\n    @property(cc.Sprite)\r\n    private heroColorSpr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private heroSpr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Label)\r\n    private HeroNumLbl: cc.Label | null = null;\r\n\r\n    @property(cc.Sprite)\r\n    private heroLvlSpr: cc.Sprite | null = null;\r\n\r\n    @property(cc.Node)\r\n    private isSuperHero: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private heroHp: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private heroHpBar: cc.Node | null = null;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n\r\n    public get data(): TypeData {\r\n        return this._data;\r\n    }\r\n\r\n    public set data(value: TypeData) {\r\n        this._data = value;\r\n        this.update_view();\r\n    }\r\n\r\n    public update_view(): void {\r\n        const heroConfig = gm.data.config_data.getHeroCfgByID(this._data.heroID);\r\n        if (heroConfig) {\r\n            Utils.async_set_sprite_frame(this.heroColorSpr, BundleName.COMMON, \"res/color_\" + heroConfig.lv);\r\n            Utils.async_set_sprite_frame(this.heroSpr, BundleName.COMMON, \"res/handbook/\" + this._data.heroID);\r\n            Utils.async_set_sprite_frame(this.heroLvlSpr, BundleName.MAP, \"res/hero/heroPhoto\" + heroConfig.lv);\r\n            this.isSuperHero.active = heroConfig && heroConfig.hero_type == HeroTypeEnum.SUPER_HERO_TYPE;\r\n            this.HeroNumLbl.string = this._data.heroNum.toString();\r\n            this.heroHp.active = false;\r\n            if (this.isSuperHero?.active) {\r\n                this.heroHp.active = true;\r\n                this.heroHpBar.scaleX = Math.min(this._data.heroHp[0] / heroConfig.hp, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    private onClickAddHeroTobattle(): void {\r\n        if (TempData.getDefenseType() != 2) {\r\n            if (gm.data.fight_temp_data.get_battle_hero_is_space()) {\r\n                const heroID = this._data.heroID;\r\n                const cellID = this._data.cellID[0];\r\n                const roleItem = new roleGoBattleItemVO();\r\n                roleItem.cellID = cellID;\r\n                const heroConfig = gm.data.config_data.getHeroCfgByID(heroID);\r\n                if (heroConfig) {\r\n                    roleItem.itemID = heroConfig.heroid;\r\n                    roleItem.itemType = heroConfig.occupation;\r\n                    roleItem.hp = heroConfig.hp;\r\n                    roleItem.maxHp = heroConfig.hp;\r\n                    if (heroConfig.hero_type == HeroTypeEnum.SUPER_HERO_TYPE) {\r\n                        if (gm.data.fight_temp_data.getFightSuperHeroNum() >= 1) {\r\n                            gm.ui.show_notice(\"Chỉ có một siêu anh hùng có thể tham gia trận chiến!!\");\r\n                            return;\r\n                        }\r\n                        const superHeroData = gm.data.mapCell_data.getSuperHeroData(heroConfig.heroid, cellID);\r\n                        if (superHeroData) {\r\n                            roleItem.hp = superHeroData.hp;\r\n                            roleItem.maxHp = superHeroData.maxHp;\r\n                        }\r\n                    }\r\n                    gm.data.fight_temp_data.battle_hero_array.push(roleItem);\r\n                }\r\n                TempData.removeHeroByID(heroID);\r\n                gm.ui.emit(\"refreshHeroBattle\");\r\n                if (gm.data.mapCell_data.isGuide) {\r\n                    gm.channel.report_event(\"ohayoo_game_guide\", {\r\n                        guideid: gm.data.fight_temp_data.battle_hero_array.length + 10,\r\n                        guidedesc: cc.js.formatStr(\"%d.上阵英雄\", gm.data.fight_temp_data.battle_hero_array.length + 10)\r\n                    });\r\n                    gm.ui.mapMainUI.checkGuideIsShow();\r\n                }\r\n                gm.ui.emit(\"refreshBattleHero\");\r\n            }\r\n        } else if (gm.data.fight_temp_data.get_defense_hero_is_space()) {\r\n            const heroID = this._data.heroID;\r\n            const cellID = this._data.cellID[0];\r\n            const defenseItem = new DefenseHeroItemVO();\r\n            defenseItem.cellID = cellID;\r\n            const heroConfig = gm.data.config_data.getHeroCfgByID(heroID);\r\n            if (heroConfig) {\r\n                if (heroConfig.hero_type == HeroTypeEnum.SUPER_HERO_TYPE && gm.data.mapCell_data.getDefenseSuperNum() >= 1) {\r\n                    gm.ui.show_notice(\"Chỉ có một siêu anh hùng có thể tham gia trận chiến!!\");\r\n                    return;\r\n                }\r\n                defenseItem.cellID = this._data.cellID[0];\r\n                defenseItem.heroid = heroID;\r\n                defenseItem.heroUID = this._data.heroUID[0];\r\n                gm.data.mapCell_data.addDefenseDataByID(defenseItem);\r\n            }\r\n            TempData.removeHeroByID(heroID);\r\n            gm.ui.emit(\"refreshHeroBattle\");\r\n            gm.ui.emit(\"refreshBattleHero\");\r\n            gm.data.mapCell_data.async_write_data();\r\n        }\r\n    }\r\n\r\n    public reset(): void {\r\n        this.heroSpr.spriteFrame = null;\r\n        this.heroLvlSpr.spriteFrame = null;\r\n        this.HeroNumLbl.string = \"\";\r\n    }\r\n}"]}