{"version":3,"sources":["assets\\start-scene\\scripts\\HitTest.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAA8B,EAAE,CAAC,UAAU,EAAzC,OAAO,aAAA,EAAE,QAAQ,cAAA,EAAE,IAAI,UAAkB,CAAC;AAIlD;IAA6B,2BAAY;IAAzC;QAAA,qEA2CC;QAzCW,aAAO,GAAc,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;IAyC1F,CAAC;gBA3CY,OAAO;IAMN,0BAAQ,GAAlB;QACI,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;QACxC,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACnD,CAAC;IAES,2BAAS,GAAnB;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC;IAC5C,CAAC;IAEO,2BAAS,GAAjB,UAAkB,KAAc,EAAE,KAAU;QACxC,IAAI,KAAK,IAAI,IAAI,IAAI,KAAK,IAAI,IAAI,EAAE;YAChC,IAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;YAC1B,IAAM,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC,SAAO,CAAC,CAAC;YAC9C,IAAM,QAAQ,GAAG,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,oBAAoB,CAAC,KAAK,CAAC,EAAE,SAAS,CAAC,OAAO,CAAC,CAAC;YAC7F,KAAK,CAAC,cAAc,GAAG,QAAQ,CAAC;YAChC,OAAO,QAAQ,CAAC;SACnB;QACD,OAAO,KAAK,CAAC;IACjB,CAAC;IAEO,kCAAgB,GAAxB,UAAyB,KAAc,EAAE,OAAkB;QACvD,IAAI,QAAQ,GAAG,KAAK,CAAC;QACrB,IAAM,MAAM,GAAG,KAAK,CAAC,CAAC,CAAC;QACvB,IAAM,MAAM,GAAG,KAAK,CAAC,CAAC,CAAC;QACvB,IAAM,aAAa,GAAG,OAAO,CAAC,MAAM,CAAC;QAErC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,aAAa,GAAG,CAAC,EAAE,CAAC,GAAG,aAAa,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE;YAC/D,IAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACxB,IAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACxB,IAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACxB,IAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAExB,IAAM,SAAS,GAAG,CAAC,EAAE,GAAG,MAAM,CAAC,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;YAC3G,IAAI,SAAS;gBAAE,QAAQ,GAAG,CAAC,QAAQ,CAAC;SACvC;QACD,OAAO,QAAQ,CAAC;IACpB,CAAC;;IAxCD;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;4CACkE;IAF7E,OAAO;QAFnB,OAAO;QACP,IAAI,CAAC,iBAAiB,CAAC;OACX,OAAO,CA2CnB;IAAD,cAAC;CA3CD,AA2CC,CA3C4B,EAAE,CAAC,SAAS,GA2CxC;AA3CY,0BAAO","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property, menu } = cc._decorator;\r\n\r\n@ccclass\r\n@menu(\"添加自定义组件/HitTest\")\r\nexport class HitTest extends cc.Component {\r\n    @property([cc.Vec2])\r\n    private polygon: cc.Vec2[] = [cc.Vec2.ZERO, cc.Vec2.ZERO, cc.Vec2.ZERO, cc.Vec2.ZERO];\r\n\r\n    private _old_function: (point?: cc.Vec2, event?: any) => boolean;\r\n\r\n    protected onEnable(): void {\r\n        this._old_function = this.node._hitTest;\r\n        this.node._hitTest = this._hit_test.bind(this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.node._hitTest = this._old_function;\r\n    }\r\n\r\n    private _hit_test(point: cc.Vec2, event: any): boolean {\r\n        if (point != null && event != null) {\r\n            const owner = event.owner;\r\n            const component = owner.getComponent(HitTest);\r\n            const isInside = this.point_in_polygon(owner.convertToNodeSpaceAR(point), component.polygon);\r\n            event.swallowTouches = isInside;\r\n            return isInside;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private point_in_polygon(point: cc.Vec2, polygon: cc.Vec2[]): boolean {\r\n        let isInside = false;\r\n        const pointX = point.x;\r\n        const pointY = point.y;\r\n        const polygonLength = polygon.length;\r\n\r\n        for (let i = 0, j = polygonLength - 1; i < polygonLength; j = i++) {\r\n            const xi = polygon[i].x;\r\n            const yi = polygon[i].y;\r\n            const xj = polygon[j].x;\r\n            const yj = polygon[j].y;\r\n\r\n            const intersect = (yi > pointY) !== (yj > pointY) && (pointX < (xj - xi) * (pointY - yi) / (yj - yi) + xi);\r\n            if (intersect) isInside = !isInside;\r\n        }\r\n        return isInside;\r\n    }\r\n}"]}