{"version":3,"sources":["assets\\start-scene\\scripts\\DefenseOp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { gm } from './GameManager';\r\nimport { BuildTypeEnum, BundleName } from './Constants';\r\nimport { roleGoBattleItemVO } from './MapCellCfgData';\r\nimport { Utils } from './Utils';\r\nimport { TempData } from './TempData';\r\nimport { ListView } from './ListView';\r\nimport { GameModule } from './GameModule';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\ninterface TypeHeroList {\r\n    heroid: number;\r\n    heroUID: number;\r\n}\r\n\r\n@ccclass\r\nclass DefenseOp extends GameModule {\r\n    @property([cc.Node])\r\n    private heroPosNode: cc.Node[] = [];\r\n\r\n    @property(ListView)\r\n    private hero_list: ListView | null = null;\r\n\r\n    @property(cc.Node)\r\n    private noHeroTips: cc.Node | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblLvl: cc.Label | null = null;\r\n\r\n    private _curUnlockNum: number = 0;\r\n    private _tempLockList: number[] = [1, 1, 1, 2, 3, 4, 5, 6, 7, 8];\r\n    private _clickHeroData: roleGoBattleItemVO | null = null;\r\n    private _startPos = null;\r\n    private _heroList: TypeHeroList[] = [];\r\n\r\n    protected onEnable(): void {\r\n        TempData.setDefenseType(2);\r\n        this._clickHeroData = new roleGoBattleItemVO();\r\n        gm.ui.on(\"refreshHeroBattle\", this.refreshPanel, this);\r\n        gm.ui.on(\"refreshBattleHero\", this.update_view, this);\r\n\r\n        const buildData = gm.data.mapCell_data.buildData[BuildTypeEnum.GARRISION_TYPE];\r\n        const cfgByID = gm.data.config_data.getBuildCfgByID(buildData.buildID);\r\n\r\n        if (cfgByID) {\r\n            this.lblLvl.string = \"Lv.\" + buildData.buildLvl;\r\n            this._curUnlockNum = cfgByID.capacity;\r\n            const color = cc.Color.BLACK.fromHEX(\"#FFF8E8\");\r\n\r\n            for (let i = 0; i < this.heroPosNode.length; i++) {\r\n                this.heroPosNode[i].color = color;\r\n                if (this._curUnlockNum < i + 1) {\r\n                    this.heroPosNode[i].children[0].active = false;\r\n                    this.heroPosNode[i].children[1].active = true;\r\n                    const lockColor = cc.Color.BLACK.fromHEX(\"#BAAF93\");\r\n                    this.heroPosNode[i].children[1].children[0].color = lockColor;\r\n                    this.heroPosNode[i].children[1].children[1].color = lockColor;\r\n                    this.heroPosNode[i].children[1].children[1].getComponent(cc.Label).string = \"level \" + this._tempLockList[i];\r\n                } else {\r\n                    this.heroPosNode[i].children[0].active = true;\r\n                    this.heroPosNode[i].children[1].active = false;\r\n                }\r\n                this.heroPosNode[i].on(cc.Node.EventType.TOUCH_END, this.touchEnd.bind(this, i), this);\r\n            }\r\n            TempData.getInitAllHeroList(true);\r\n            this.noHeroTips.active = TempData.localHeroList.length <= 0;\r\n            this.refreshPanel();\r\n            this.update_view();\r\n        }\r\n    }\r\n\r\n    private update_view(): void {\r\n        this.hero_list?.setData(TempData.localHeroList);\r\n    }\r\n\r\n    private touchEnd(index: number): void {\r\n        if (this._curUnlockNum <= index || !(this._heroList.length > index)) return;\r\n        const heroData = gm.data.mapCell_data.getHeroDefanseDataByHeroUID(this._heroList[index].heroUID);\r\n        if (heroData) {\r\n            const cellID = heroData.cellID;\r\n            const heroid = heroData.heroid;\r\n            const heroUID = heroData.heroUID;\r\n            TempData.addHeroByID(heroid, cellID);\r\n            gm.data.mapCell_data.delDefenseDataByID(heroUID);\r\n            this.refreshPanel();\r\n            this.update_view();\r\n            gm.data.mapCell_data.async_write_data();\r\n        }\r\n    }\r\n\r\n    private refreshPanel(): void {\r\n        this._heroList = [];\r\n        const heroData = gm.data.mapCell_data.getDefanseHeroData();\r\n        let a = 0;\r\n\r\n        for (const key in heroData) {\r\n            const heroConfig = gm.data.config_data.getHeroCfgByID(heroData[key].heroid);\r\n            if (heroConfig) {\r\n                this.heroPosNode[a].children[0].children[1].active = true;\r\n                Utils.async_set_sprite_frame(this.heroPosNode[a].children[0].children[1].children[0].getComponent(cc.Sprite), BundleName.COMMON, \"res/color_\" + heroConfig.lv);\r\n                Utils.async_set_sprite_frame(this.heroPosNode[a].children[0].children[1].children[1].getComponent(cc.Sprite), BundleName.COMMON, \"res/handbook/\" + heroConfig.heroid);\r\n                Utils.async_set_sprite_frame(this.heroPosNode[a].children[0].children[1].children[2].getComponent(cc.Sprite), BundleName.MAP, \"res/hero/heroPhoto\" + heroConfig.lv);\r\n                this._heroList.push(heroData[key]);\r\n                a++;\r\n            }\r\n        }\r\n        for (let o = a; o < this._curUnlockNum; o++) {\r\n            this.heroPosNode[o].children[0].children[1].active = false;\r\n        }\r\n    }\r\n\r\n    private onClickClose(): void {\r\n        gm.ui.async_hide_module(gm.const.DEFENSE);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.hero_list?.reset();\r\n        gm.ui.off(\"refreshHeroBattle\", this.refreshPanel, this);\r\n        gm.ui.off(\"refreshBattleHero\", this.update_view, this);\r\n    }\r\n}\r\n\r\nexport default DefenseOp;"]}