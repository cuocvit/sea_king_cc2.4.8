{"version":3,"sources":["assets\\start-scene\\scripts\\EventScriptManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// @@\r\nimport { GuideConfig } from '../../common/configs/guide';\r\nimport { gm } from './GameManager';\r\nimport { TempData } from './TempData';\r\nconst { ccclass } = cc._decorator;\r\n\r\n@ccclass(\"EventScriptManager\")\r\nclass EventScriptManager {\r\n    // @@\r\n    private static _instance: EventScriptManager = null;\r\n    private _NewerGuideList: GuideConfig[];\r\n    private _isFinish: boolean;\r\n    private _guideID: Record<number, number>;\r\n\r\n    // @@\r\n    private constructor() {\r\n        this._NewerGuideList = [];\r\n        this._isFinish = true;\r\n        this._guideID = {\r\n            1: 1,\r\n            2: 1,\r\n            4: 1,\r\n            5: 1,\r\n            6: 1,\r\n            7: 1,\r\n            8: 1,\r\n            9: 1,\r\n            10: 1,\r\n            11: 1,\r\n            12: 1,\r\n            15: 1\r\n        };\r\n    }\r\n\r\n    // @@\r\n    public static get instance(): EventScriptManager {\r\n        return this._instance || (this._instance = new EventScriptManager());\r\n    }\r\n\r\n    // @@\r\n    public initEventList(): void {\r\n        const guideData = TempData.getRoleGuideData();\r\n        const guideID = gm.data.config_data.getGuideIDList(guideData.guideID);\r\n        if (guideID) {\r\n            this._NewerGuideList = guideID;\r\n            this.dispatchNewerGuideEvent();\r\n            if (8 == this._NewerGuideList[0].guideID) {\r\n                gm.ui.mapMainUI.playGuideBarrelFly(4);\r\n            }\r\n        }\r\n    }\r\n\r\n    private dispatchNewerGuideEvent(): void {\r\n        const guideData = TempData.getRoleGuideData();\r\n        if (guideData.runningIndex >= this._NewerGuideList.length) {\r\n            if (gm.ui.newerGuideOp && gm.ui.newerGuideOp.node.active) {\r\n                gm.ui.async_hide_module(gm.const.GUIDELOP);\r\n            }\r\n            this._guideID[guideData.guideID] && TempData.setRoleGuideDataEnd();\r\n\r\n            if (4 == this._NewerGuideList[this._NewerGuideList.length - 1].guideID) {\r\n                gm.data.mapCell_data.setRoleGuideData(13, 0);\r\n                gm.data.mapCell_data.async_write_data();\r\n                return;\r\n            }\r\n            if (15 != this._NewerGuideList[this._NewerGuideList.length - 1].guideID) {\r\n                if (15 != this._NewerGuideList[this._NewerGuideList.length - 1].guideID) {\r\n                    if (this._NewerGuideList[this._NewerGuideList.length - 1].nextGuideID) {\r\n                        gm.ui.mapMainUI.checkHandAnimDelay(0.5, this._NewerGuideList[this._NewerGuideList.length - 1].nextGuideID);\r\n                    } else {\r\n                        gm.ui.mapMainUI.checkHandAnimDelay();\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                gm.ui.mapMainUI.checkGuideIsShow();\r\n            }\r\n\r\n        } else {\r\n            const event = this._NewerGuideList[guideData.runningIndex];\r\n            if (1 == event.eventType) {\r\n                if (gm.ui.newerGuideOp && gm.ui.newerGuideOp.node.active) {\r\n                    gm.ui.newerGuideOp.showBtnMask(this._NewerGuideList[guideData.runningIndex]);\r\n                } else {\r\n                    gm.ui.set_module_args(gm.const.GETCOINOP.key, this._NewerGuideList[guideData.runningIndex]);\r\n                    gm.ui.show_panel(gm.const.GUIDELOP);\r\n                }\r\n\r\n            } else {\r\n                if (3 == event.eventType && event.circleWidth && 0 < event.circleWidth) {\r\n                    gm.data.mapCell_data.addBarrelNum(event.circleWidth);\r\n                }\r\n                if (gm.ui.newerGuideOp && gm.ui.newerGuideOp.node.active) {\r\n                    gm.ui.async_hide_module(gm.const.GUIDELOP);\r\n                }\r\n                gm.ui.mapMainUI.moveMapPosForGuide(event.eventType, event.roleDire, event.circleWidth, this.setRuningIndex, this);\r\n            }\r\n\r\n            if (event.soundID) {\r\n                gm.audio.play_effect(event.soundID);\r\n            }\r\n\r\n            if (0 < event.guideSerial) {\r\n                gm.channel.report_event(\"ohayoo_game_guide\", {\r\n                    guideid: event.guideSerial,\r\n                    guidedesc: cc.js.formatStr(\"%d.%s\", event.guideSerial, event.guideDesc)\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    public setRuningIndex(): void {\r\n        TempData.getRoleGuideData().runningIndex++;\r\n        this.dispatchNewerGuideEvent();\r\n    }\r\n\r\n    private getRuningIndex(): number {\r\n        return TempData.getRoleGuideData().runningIndex\r\n    }\r\n\r\n    private getCurGuideID(): void {\r\n        // Implementation needed\r\n    }\r\n\r\n    private clearEventList(): void {\r\n        const roleGuide = TempData.getRoleGuideData();\r\n        this._NewerGuideList = [];\r\n        roleGuide.runningIndex = 0;\r\n        gm.data.mapCell_data.setRoleGuideData(roleGuide.guideID, roleGuide.runningIndex);\r\n        this._isFinish = true;\r\n        gm.ui.async_hide_module(gm.const.GUIDELOP);\r\n    }\r\n}\r\n\r\nexport { EventScriptManager };"]}