{"version":3,"sources":["assets\\start-scene\\scripts\\BuildUpgrade.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM;AACN,iCAAgC;AAChC,yCAAsF;AACtF,6CAAmC;AACnC,uCAAwC;AAGlC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA2B,gCAAY;IAAvC;QAAA,qEA8KC;QA5KW,aAAO,GAAqB,IAAI,CAAC;QAGjC,kBAAY,GAAoB,IAAI,CAAC;QAGrC,cAAQ,GAAc,EAAE,CAAC;QAGzB,eAAS,GAAc,EAAE,CAAC;QAE1B,kBAAY,GAAiB,IAAI,CAAC;QAClC,YAAM,GAAa,EAAE,CAAC;QACtB,aAAO,GAAa,EAAE,CAAC;;IA+JnC,CAAC;IA7JW,+BAAQ,GAAhB,UAAiB,OAAe;QAC5B,IAAI,CAAC,YAAY,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;IACrE,CAAC;IAES,+BAAQ,GAAlB;QACI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAC/D,IAAM,WAAW,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,gBAAE,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;QAC9E,IAAI,WAAW,EAAE;YACb,IAAI,CAAC,YAAY,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;YACjF,IAAI,IAAI,CAAC,YAAY,EAAE;gBACnB,IAAM,SAAS,GAAG,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;gBACzD,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,OAAO,EAAE,sBAAU,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;gBACtE,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,GAAG,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC;gBAE7F,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;oBACvD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC;iBACvC;gBAED,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC;gBACnD,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,WAAW,CAAC;gBACzE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,GAAG,EAAE,CAAC;gBACvF,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,sBAAsB,CAAC,CAAC;gBAC9H,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC;gBACvD,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,WAAW,CAAC;gBACzE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,EAAE,CAAC;gBAC3F,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,2BAA2B,CAAC,CAAC;gBACnI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC;gBACxD,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,UAAU,CAAC;gBACxE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,GAAG,EAAE,CAAC;gBAC5F,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,6BAA6B,CAAC,CAAC;gBAErI,IAAM,MAAM,GAAG,WAAW,CAAC,MAAkB,CAAC;gBAC9C,IAAM,MAAM,GAAG,WAAW,CAAC,MAAkB,CAAC;gBAC9C,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;gBAEnD,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;oBACxD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;oBACrB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;oBACtB,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC;oBACrC,IAAI,MAAM,CAAC,MAAM,GAAG,KAAK,EAAE;wBACvB,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;wBACpC,IAAI,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,EAAE;4BACrB,IAAM,UAAU,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;4BACrE,IAAI,UAAU,EAAE;gCACZ,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,YAAY,GAAG,UAAU,CAAC,EAAE,CAAC,CAAC;gCACzI,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,eAAe,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;6BACjJ;yBACJ;6BAAM;4BACH,IAAM,UAAU,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;4BACrE,IAAI,UAAU,EAAE;gCACZ,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,YAAY,GAAG,CAAC,CAAC,IAAI,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC;gCACpK,IAAI,KAAK,IAAI,UAAU,CAAC,EAAE,IAAI,KAAK,IAAI,UAAU,CAAC,EAAE,IAAI,KAAK,IAAI,UAAU,CAAC,EAAE,EAAE;oCAC5E,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,GAAG,EAAE,iBAAiB,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;iCAChJ;qCAAM;oCACH,aAAK,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,sBAAU,CAAC,MAAM,EAAE,eAAe,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;iCACjJ;6BACJ;4BACD,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,GAAG,GAAG,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;yBACrG;qBACJ;iBACJ;aACJ;SACJ;IAEL,CAAC;IAEO,mCAAY,GAApB;QACI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;QAChE,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,gBAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,gBAAE,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;QAChD,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,yBAAa,CAAC,aAAa,EAAE;YACjF,gBAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,gBAAE,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;SACnD;IAEL,CAAC;IAEO,qCAAc,GAAtB;QACI,gBAAE,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IACnD,CAAC;IAEO,gCAAS,GAAjB;QACI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;QAChE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QACnB,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QACpD,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,gBAAE,CAAC,OAAO,CAAC,YAAY,CAAC,gCAAgC,EAAE;gBACtD,UAAU,EAAE,YAAY;gBACxB,IAAI,EAAE,oBAAoB;gBAC1B,aAAa,EAAE,IAAI,CAAC,YAAY,CAAC,SAAS;gBAC1C,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC,OAAO;aACnC,CAAC,CAAC;YACH,qBAAU,CAAC,QAAQ,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAC7C,qBAAU,CAAC,QAAQ,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;YACxC,gBAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,gBAAE,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;YAChD,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,yBAAa,CAAC,aAAa,EAAE;gBAC5D,gBAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,gBAAE,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;aACnD;SACJ;IAEL,CAAC;IAEO,gCAAS,GAAjB,UAAkB,UAAsB;QAAtB,2BAAA,EAAA,cAAsB;QACpC,IAAI,UAAU,GAAG,CAAC,CAAC;QACnB,IAAI,aAAa,GAAG,CAAC,CAAC;QACtB,IAAI,YAAY,GAAG,CAAC,CAAC;QACrB,IAAM,OAAO,GAAa,EAAE,CAAC;QAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACzC,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,wBAAY,CAAC,IAAI,EAAE;gBACrC,UAAU,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC;gBAC3C,gBAAE,CAAC,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;aACtF;iBAAM,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,wBAAY,CAAC,OAAO,EAAE;gBAC/C,aAAa,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC;gBAC9C,gBAAE,CAAC,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;aACtF;iBAAM,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,wBAAY,CAAC,MAAM,EAAE;gBAC9C,YAAY,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC;gBAC7C,gBAAE,CAAC,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,YAAY,EAAE,gBAAE,CAAC,EAAE,CAAC,SAAS,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;aACpK;iBAAM;gBACH,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,UAAU,EAAE,CAAC,EAAE,EAAE;oBACnD,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;iBAChC;aACJ;SACJ;QACD,IAAI,YAAY,GAAG,CAAC,EAAE;YAClB,gBAAE,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;SACnD;QACD,IAAI,UAAU,GAAG,CAAC,EAAE;YAChB,gBAAE,CAAC,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,0BAAc,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;SACjF;QACD,IAAI,aAAa,GAAG,CAAC,EAAE;YACnB,gBAAE,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,0BAAc,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;SACvF;QACD,IAAI,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;YACpB,gBAAE,CAAC,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;YAC/C,gBAAE,CAAC,IAAI,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC;SAC3C;IAEL,CAAC;IAES,gCAAS,GAAnB;QACI,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,IAAM,eAAe,GAAG,gBAAE,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;YAC3F,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,yBAAa,CAAC,aAAa,IAAI,eAAe,IAAI,eAAe,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE;gBACnH,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAC;oBAC5B,gBAAE,CAAC,EAAE,CAAC,eAAe,CAAC,gBAAE,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;oBAClD,gBAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,gBAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;gBAC9C,CAAC,EAAE,GAAG,CAAC,CAAC;aACX;iBAAM,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,yBAAa,CAAC,UAAU,EAAE;gBAChE,KAAK,IAAM,CAAC,IAAI,gBAAE,CAAC,KAAK,CAAC,kBAAkB,EAAE;oBACzC,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,IAAI,gBAAE,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE;wBACjE,gBAAE,CAAC,EAAE,CAAC,eAAe,CAAC,gBAAE,CAAC,KAAK,CAAC,iBAAiB,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;wBACnE,gBAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,gBAAE,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;wBACpD,OAAO;qBACV;iBACJ;aACJ;SACJ;IACL,CAAC;IA3KD;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;iDACqB;IAGzC;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;sDAC0B;IAG7C;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;kDACa;IAGjC;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;mDACc;IAXhC,YAAY;QADjB,OAAO;OACF,YAAY,CA8KjB;IAAD,mBAAC;CA9KD,AA8KC,CA9K0B,EAAE,CAAC,SAAS,GA8KtC;AAED,kBAAe,YAAY,CAAC","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { Utils } from './Utils';\r\nimport { BuildTypeEnum, RewardIdEnum, BundleName, SetItemNumEnum } from './Constants';\r\nimport { gm } from './GameManager';\r\nimport { ReportData } from './NetUtils';\r\nimport { Build } from \"../../common/configs/build\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass BuildUpgrade extends cc.Component {\r\n    @property(cc.Sprite)\r\n    private itemImg: cc.Sprite | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblBuildName: cc.Label | null = null;\r\n\r\n    @property([cc.Node])\r\n    private attrNode: cc.Node[] = [];\r\n\r\n    @property([cc.Node])\r\n    private photoList: cc.Node[] = [];\r\n\r\n    private _curBuildCfg: Build | null = null;\r\n    private idList: number[] = [];\r\n    private numList: number[] = [];\r\n\r\n    private initData(buildId: number): void {\r\n        this._curBuildCfg = gm.data.config_data.getBuildCfgByID(buildId);\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        this.node.getComponent(cc.Animation).play(\"buildUpgrade_open\");\r\n        const buildConfig = gm.data.config_data.getBuildCfgByID(gm.const.openBuildID);\r\n        if (buildConfig) {\r\n            this._curBuildCfg = gm.data.config_data.getBuildCfgByID(buildConfig.nextBuildID);\r\n            if (this._curBuildCfg) {\r\n                const modelPath = \"res/build/\" + this._curBuildCfg.model;\r\n                Utils.async_set_sprite_frame(this.itemImg, BundleName.MAP, modelPath);\r\n                this.lblBuildName.string = this._curBuildCfg.buildName + \"  Lv.\" + this._curBuildCfg.buildLv;\r\n\r\n                for (let index = 0; index < this.attrNode.length; index++) {\r\n                    this.attrNode[index].active = false;\r\n                }\r\n\r\n                this.attrNode[0].active = 0 < this._curBuildCfg.hp;\r\n                this.attrNode[0].children[1].getComponent(cc.Label).string = \"Sinh mạng\";\r\n                this.attrNode[0].children[2].getComponent(cc.Label).string = this._curBuildCfg.hp + \"\";\r\n                Utils.async_set_sprite_frame(this.attrNode[0].children[4].getComponent(cc.Sprite), BundleName.COMMON, \"res/attrIcon/Perk_HP\");\r\n                this.attrNode[1].active = 0 < this._curBuildCfg.attack;\r\n                this.attrNode[1].children[1].getComponent(cc.Label).string = \"Phòng thủ\";\r\n                this.attrNode[1].children[2].getComponent(cc.Label).string = this._curBuildCfg.attack + \"\";\r\n                Utils.async_set_sprite_frame(this.attrNode[1].children[4].getComponent(cc.Sprite), BundleName.COMMON, \"res/attrIcon/Perk_Defense\");\r\n                this.attrNode[2].active = 0 < this._curBuildCfg.defense;\r\n                this.attrNode[2].children[1].getComponent(cc.Label).string = \"Tấn công\";\r\n                this.attrNode[2].children[2].getComponent(cc.Label).string = this._curBuildCfg.defense + \"\";\r\n                Utils.async_set_sprite_frame(this.attrNode[2].children[4].getComponent(cc.Sprite), BundleName.COMMON, \"res/attrIcon/Perk_Attackers\");\r\n\r\n                const reward = buildConfig.reward as number[];\r\n                const amount = buildConfig.amount as number[];\r\n                this.photoList[0].x = reward.length <= 1 ? 0 : -80;\r\n\r\n                for (let index = 0; index < this.photoList.length; index++) {\r\n                    this.idList = reward;\r\n                    this.numList = amount;\r\n                    this.photoList[index].active = false;\r\n                    if (reward.length > index) {\r\n                        this.photoList[index].active = true;\r\n                        if (3e4 < reward[index]) {\r\n                            const heroConfig = gm.data.config_data.getHeroCfgByID(reward[index]);\r\n                            if (heroConfig) {\r\n                                Utils.async_set_sprite_frame(this.photoList[index].children[0].getComponent(cc.Sprite), BundleName.COMMON, \"res/color_\" + heroConfig.lv);\r\n                                Utils.async_set_sprite_frame(this.photoList[index].children[1].getComponent(cc.Sprite), BundleName.COMMON, \"res/handbook/\" + heroConfig.icon);\r\n                            }\r\n                        } else {\r\n                            const heroConfig = gm.data.config_data.getItemCfgByID(reward[index]);\r\n                            if (heroConfig) {\r\n                                Utils.async_set_sprite_frame(this.photoList[index].children[0].getComponent(cc.Sprite), BundleName.COMMON, \"res/color_\" + (0 == heroConfig.lv ? 1 : heroConfig.lv));\r\n                                if (11002 == heroConfig.id || 11003 == heroConfig.id || 11006 == heroConfig.id) {\r\n                                    Utils.async_set_sprite_frame(this.photoList[index].children[1].getComponent(cc.Sprite), BundleName.MAP, \"res/rewardIcon/\" + heroConfig.icon);\r\n                                } else {\r\n                                    Utils.async_set_sprite_frame(this.photoList[index].children[1].getComponent(cc.Sprite), BundleName.COMMON, \"res/handbook/\" + heroConfig.icon);\r\n                                }\r\n                            }\r\n                            this.photoList[index].children[2].getComponent(cc.Label).string = \"x\" + buildConfig.amount[index];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    private onClickClose(): void {\r\n        this.node.getComponent(cc.Animation).play(\"buildUpgrade_close\");\r\n        this.getReward();\r\n        gm.ui.async_hide_module(gm.const.BUILD_UPGRADE);\r\n        if (this._curBuildCfg && this._curBuildCfg.buildType == BuildTypeEnum.BARRACKS_TYPE) {\r\n            gm.ui.async_show_module(gm.const.BARRACKS_LIST);\r\n        }\r\n\r\n    }\r\n\r\n    private onClickWatchAd(): void {\r\n        gm.channel.show_video_ad(this.watchAdCb, this);\r\n    }\r\n\r\n    private watchAdCb(): void {\r\n        this.node.getComponent(cc.Animation).play(\"buildUpgrade_close\");\r\n        this.getReward(10);\r\n        console.log(\"this._curBuildCfg\", this._curBuildCfg);\r\n        if (this._curBuildCfg) {\r\n            gm.channel.report_event(\"building_upgrade_video_receive\", {\r\n                event_desc: \"建筑升级视频领取奖励\",\r\n                desc: \"%s建筑升级到Lv.%d视频领取奖励\",\r\n                building_name: this._curBuildCfg.buildName,\r\n                level: this._curBuildCfg.buildLv\r\n            });\r\n            ReportData.instance.report_once_point(10861);\r\n            ReportData.instance.report_point(10862);\r\n            gm.ui.async_hide_module(gm.const.BUILD_UPGRADE);\r\n            if (this._curBuildCfg.buildType == BuildTypeEnum.BARRACKS_TYPE) {\r\n                gm.ui.async_show_module(gm.const.BARRACKS_LIST);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    private getReward(multiplier: number = 1): void {\r\n        let goldAmount = 0;\r\n        let diamondAmount = 0;\r\n        let barrelAmount = 0;\r\n        const rewards: number[] = [];\r\n        for (let n = 0; n < this.idList.length; n++) {\r\n            if (this.idList[n] == RewardIdEnum.GOLD) {\r\n                goldAmount += this.numList[n] * multiplier;\r\n                gm.ui.show_coin_fly(this.idList[n], this.node.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n            } else if (this.idList[n] == RewardIdEnum.DIAMOND) {\r\n                diamondAmount += this.numList[n] * multiplier;\r\n                gm.ui.show_coin_fly(this.idList[n], this.node.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n            } else if (this.idList[n] == RewardIdEnum.BARREL) {\r\n                barrelAmount += this.numList[n] * multiplier;\r\n                gm.ui.show_coin_fly(this.idList[n], this.node.convertToWorldSpaceAR(cc.Vec3.ZERO), barrelAmount, gm.ui.mapMainUI.barrelNode.convertToWorldSpaceAR(cc.Vec3.ZERO));\r\n            } else {\r\n                for (let r = 0; r < this.numList[n] * multiplier; r++) {\r\n                    rewards.push(this.idList[n]);\r\n                }\r\n            }\r\n        }\r\n        if (barrelAmount > 0) {\r\n            gm.data.mapCell_data.addBarrelNum(barrelAmount);\r\n        }\r\n        if (goldAmount > 0) {\r\n            gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.ADD_ITEM_TYPE, goldAmount);\r\n        }\r\n        if (diamondAmount > 0) {\r\n            gm.data.mapCell_data.setAddGameDiamond(SetItemNumEnum.ADD_ITEM_TYPE, diamondAmount);\r\n        }\r\n        if (rewards.length > 0) {\r\n            gm.data.mapCell_data.addWareHouseList(rewards);\r\n            gm.data.mapCell_data.async_write_data();\r\n        }\r\n\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        if (this._curBuildCfg) {\r\n            const nextBuildConfig = gm.data.config_data.getBuildCfgByID(this._curBuildCfg.nextBuildID);\r\n            if (this._curBuildCfg.buildType == BuildTypeEnum.BARRACKS_TYPE && nextBuildConfig && nextBuildConfig.rate.length >= 0) {\r\n                cc.Canvas.instance.scheduleOnce(() => {\r\n                    gm.ui.set_module_args(gm.const.GetReel.key, true);\r\n                    gm.ui.async_show_module(gm.const.GetReel);\r\n                }, 0.1);\r\n            } else if (this._curBuildCfg.buildType == BuildTypeEnum.TOWER_TYPE) {\r\n                for (const e in gm.const.localCloudAreaList) {\r\n                    if (this._curBuildCfg.buildLv == gm.const.localCloudAreaList[e].lvl) {\r\n                        gm.ui.set_module_args(gm.const.UNLOCKAREACLOUDOP.key, parseInt(e));\r\n                        gm.ui.async_show_module(gm.const.UNLOCKAREACLOUDOP);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default BuildUpgrade;"]}