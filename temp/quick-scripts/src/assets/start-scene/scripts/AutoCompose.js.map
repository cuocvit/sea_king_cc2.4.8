{"version":3,"sources":["assets\\start-scene\\scripts\\AutoCompose.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["//\r\nimport { gm } from './GameManager';\r\nimport { GameModule } from './GameModule';\r\nimport { Utils } from './Utils';\r\nimport { ReportData } from './NetUtils';\r\nimport { TaskConditionType } from './TaskData';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class AutoCompose extends GameModule {\r\n    @property(cc.Sprite)\r\n    private mask: cc.Sprite | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblTime: cc.Label | null = null;\r\n\r\n    @property(cc.Node)\r\n    private newerIcon: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private handAni: cc.Node | null = null;\r\n\r\n    @property(cc.Animation)\r\n    private autoAnim: cc.Animation | null = null;\r\n\r\n    private _timeContainer: number = 0;\r\n    private _maxTime: number = 600;\r\n    public _stopTime: number = 0;\r\n    private timer: number = 0;\r\n\r\n    // @ (LIFE-CYCLE CALLBACKS)\r\n    protected onEnable(): void {\r\n        this.handAni.active = false;\r\n        this.autoAnim.node.active = false;\r\n        this.newerIcon.active = gm.data.mapCell_data.is_first_auto_compose === 0;\r\n        this.showReciveTime();\r\n        gm.ui.on(\"task_finish_20009\", this.showHandAnimAtAutoCom, this);\r\n        gm.data.event_emitter.on(\"auto_merge_message\", this.on_auto_merge_message, this);\r\n    }\r\n\r\n    // @ (LIFE-CYCLE CALLBACKS)\r\n    protected onDisable(): void {\r\n        gm.data.event_emitter.off(\"auto_merge_message\", this.on_auto_merge_message, this);\r\n        gm.ui.off(\"task_finish_20009\", this.showHandAnimAtAutoCom, this);\r\n    }\r\n\r\n    // @\r\n    private showHandAnimAtAutoCom(): void {\r\n        this.handAni.active = true;\r\n    }\r\n\r\n    // @\r\n    private on_auto_merge_message(): void {\r\n        this.handAni.active = false;\r\n        this.autoAnim.node.active = false;\r\n        if (gm.data.mapCell_data.is_first_auto_compose == 0) {\r\n            this.newerIcon.active = false;\r\n            gm.data.mapCell_data.setAutoComposeUsed();\r\n            this._stopTime = this._maxTime;\r\n        } else {\r\n            this._stopTime = this._maxTime;\r\n            gm.channel.report_event(\"video_auto_merge\", {\r\n                event_desc: \"Watch video automatically\", // 看视频自动合成\r\n                desc: \"Watch video automatically\" // 看视频自动合成\r\n            });\r\n            ReportData.instance.report_once_point(10881);\r\n            ReportData.instance.report_point(10882);\r\n        }\r\n        this.playAutoCompose();\r\n    }\r\n\r\n    // @\r\n    private playAutoCompose(): void {\r\n        gm.data.task_data.update_task_progress(TaskConditionType.AUTOCOMPOSE);\r\n        if (!gm.data.mapCell_data.autoCompose()) {\r\n            gm.data.mapCell_data.autoOpenCase();\r\n        }\r\n    }\r\n\r\n    // @\r\n    private onClick(): void {\r\n        this.handAni.active = false;\r\n        this.autoAnim.node.active = false;\r\n        if (gm.data.mapCell_data.is_first_auto_compose == 0) {\r\n            this.newerIcon.active = false;\r\n            gm.data.mapCell_data.setAutoComposeUsed();\r\n            this._stopTime = this._maxTime;\r\n            this.playAutoCompose();\r\n        } else if (this._stopTime <= 0) {\r\n            gm.channel.show_video_ad(this.watchAdCb, this);\r\n        }\r\n    }\r\n\r\n    // @\r\n    private watchAdCb(): void {\r\n        if (this._stopTime > 0) return;\r\n        this._stopTime = this._maxTime;\r\n        gm.channel.report_event(\"video_auto_merge\", {\r\n            event_desc: \"Watch video automatically\", // 看视频自动合成\r\n            desc: \"Watch video automatically\" // 看视频自动合成\r\n        });\r\n        ReportData.instance.report_once_point(10881);\r\n        ReportData.instance.report_point(10882);\r\n        this.playAutoCompose();\r\n    }\r\n\r\n    // @ (LIFE-CYCLE CALLBACKS)\r\n    protected update(deltaTime: number): void {\r\n        if (gm.data.mapCell_data.is_first_auto_compose == 0) {\r\n            this.timer += deltaTime;\r\n            if (this.timer > 15 && !this.autoAnim.node.active) {\r\n                this.autoAnim.node.active = true;\r\n                this.autoAnim.play();\r\n            }\r\n        }\r\n        if (this._stopTime > 0) {\r\n            this._timeContainer += deltaTime;\r\n            if (this._timeContainer >= 1) {\r\n                --this._timeContainer;\r\n                this._stopTime--;\r\n                this.playAutoCompose();\r\n                this.showReciveTime();\r\n            }\r\n        }\r\n    }\r\n\r\n    // @\r\n    private showReciveTime(): void {\r\n        this.lblTime.string = Utils.format_time_miunte(this._stopTime);\r\n        this.mask.fillRange = this._stopTime / this._maxTime;\r\n        if (this._stopTime === 0) {\r\n            this.lblTime.string = \"Tự động tổng hợp\"; // 自动合成\r\n            this.mask.fillRange = 0;\r\n        }\r\n    }\r\n}\r\n"]}