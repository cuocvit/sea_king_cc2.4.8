{"version":3,"sources":["assets\\start-scene\\scripts\\BarrelMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["//\r\nimport { gm } from './GameManager';\r\nimport { GameModule } from './GameModule';\r\nimport { Utils } from './Utils';\r\nimport { ItemTypeEnum, SetItemNumEnum, RewardIdEnum, PropTypeEnum } from './Constants';\r\nimport { ReportData } from './NetUtils';\r\nimport { TempData } from './TempData';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BarrelMgr extends GameModule {\r\n    @property(cc.Node)\r\n    private saleNode: cc.Node | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblSaleNum: cc.Label | null = null;\r\n\r\n    @property(cc.Node)\r\n    private noSpaceNode: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private noBarrelNode: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private noBarrel2Node: cc.Node | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblFreeTime: cc.Label | null = null;\r\n\r\n    @property(cc.Node)\r\n    private barWidth: cc.Node | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblNum: cc.Label | null = null;\r\n\r\n    @property(cc.Node)\r\n    private barInfoNode: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    private handAnim: cc.Node | null = null;\r\n\r\n    @property(cc.Node)\r\n    public guideNode: cc.Node | null = null;\r\n\r\n    @property(cc.Label)\r\n    private lblTips: cc.Label | null = null;\r\n\r\n    private _timeContainer: number = 0;\r\n    private _reciveTime: number = 0;\r\n    private _soulID: number = 0;\r\n    private isCd: boolean = false;\r\n\r\n\r\n    protected onEnable(): void {\r\n        this.node.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED, this.playAnimEnd, this);\r\n        this.node.getComponent(cc.Animation).play(\"btnBuy_open\");\r\n        gm.ui.on(\"item_move\", this.on_move_item_move, this);\r\n        gm.ui.on(\"item_move_end\", this.on_move_item_hide, this);\r\n        gm.ui.on(\"refresh_barrel_num\", this.refreshBarrelNum, this);\r\n        gm.ui.on(\"hide_barrel_ui\", this.on_item_not_move_hide, this);\r\n        gm.ui.on(\"show_hand_anim\", this.showHandAnim, this);\r\n\r\n        this._reciveTime = 0;\r\n        const nextFreeBarrelTime = gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime;\r\n        if (this._reciveTime < nextFreeBarrelTime) {\r\n            this._reciveTime = gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime - gm.data.mapCell_data.roleBarrelData.curFreeBarrelTime;\r\n            const value = gm.data.mapCell_data.roleBarrelData.maxBarrelNum - gm.data.mapCell_data.roleBarrelData.curBarrelNum;\r\n            const newVal = Math.ceil(value / gm.data.mapCell_data.roleBarrelData.nextFreeBarrelNum) * gm.data.mapCell_data.roleBarrelData.freeBarrelCd;\r\n            if (this._reciveTime > newVal) {\r\n                gm.data.mapCell_data.roleBarrelData.curFreeBarrelTime = Math.floor(Date.now() / 1000);\r\n                gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime = Math.floor(Date.now() / 1000) + newVal;\r\n            }\r\n        }\r\n\r\n        this.barInfoNode.active = true;\r\n        this.lblFreeTime.node.active = true;\r\n        this.lblNum.string = \"\";\r\n        this.noSpaceNode.active = !gm.data.mapCell_data.getMapHaveSpece();\r\n        this.noBarrelNode.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && gm.data.mapCell_data.isGuide;\r\n        this.noBarrel2Node.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && !gm.data.mapCell_data.isGuide;\r\n        this.refreshBarrelNum();\r\n    }\r\n\r\n    private playAnimEnd(type: string, state: cc.AnimationState): void {\r\n        if (\"btnBuySuol_open\" == state.name) {\r\n            this.node.getComponent(cc.Animation).play(\"btnBuySuol_normal\");\r\n        } else if (\"btnBuySuol_close\" == state.name) {\r\n            this._soulID = 0;\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.ui.off(\"item_move\", this.on_move_item_move, this);\r\n        gm.ui.off(\"item_move_end\", this.on_move_item_hide, this);\r\n        gm.ui.off(\"refresh_barrel_num\", this.refreshBarrelNum, this);\r\n        gm.ui.off(\"hide_barrel_ui\", this.on_item_not_move_hide, this);\r\n        gm.ui.off(\"show_hand_anim\", this.showHandAnim, this);\r\n    }\r\n\r\n    public refreshPanel(): void {\r\n        this._reciveTime = 0;\r\n        if (this._reciveTime < gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime) {\r\n            gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime - gm.data.mapCell_data.roleBarrelData.curFreeBarrelTime;\r\n        }\r\n\r\n        this.lblNum.string = \"\";\r\n        this.noSpaceNode.active = !gm.data.mapCell_data.getMapHaveSpece();\r\n        this.noBarrelNode.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && gm.data.mapCell_data.isGuide;\r\n        this.noBarrel2Node.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && !gm.data.mapCell_data.isGuide;\r\n        this.showBarrelInfo();\r\n    }\r\n\r\n    protected update(time: number): void {\r\n        if (0 < this._reciveTime) {\r\n            this._timeContainer += time;\r\n            if (1 <= this._timeContainer) {\r\n                --this._timeContainer;\r\n                this.showReciveTime();\r\n            }\r\n        }\r\n    }\r\n\r\n    private showReciveTime(): void {\r\n        this._reciveTime--;\r\n        if (this._reciveTime <= 0) {\r\n            this.lblFreeTime.string = \"\";\r\n            this._reciveTime = 0;\r\n            if (this._reciveTime < gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime) {\r\n                this._reciveTime = gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime - gm.data.mapCell_data.roleBarrelData.curFreeBarrelTime;\r\n            }\r\n\r\n            if (0 < gm.data.mapCell_data.roleBarrelData.curBarrelNum) {\r\n                if (this.saleNode?.active) {\r\n                    this.barInfoNode.active = false;\r\n                } else {\r\n                    this.barInfoNode.active = true;\r\n                }\r\n                this.lblNum.node.active = true;\r\n                this.lblNum.string = `${gm.data.mapCell_data.roleBarrelData.curBarrelNum}/${Math.max(gm.data.mapCell_data.roleBarrelData.maxBarrelNum, 40)}`;\r\n                this.barWidth.width = Math.min(gm.data.mapCell_data.roleBarrelData.curBarrelNum / gm.data.mapCell_data.roleBarrelData.maxBarrelNum * 125, 125);\r\n            } else {\r\n                this.lblNum.node.active = false;\r\n                this.barInfoNode.active = false;\r\n            }\r\n        } else {\r\n            this.lblFreeTime.string = Utils.format_time_miunte(this._reciveTime) + \"后获得\" + gm.data.mapCell_data.roleBarrelData.nextFreeBarrelNum + \"个桶\";\r\n        }\r\n    }\r\n\r\n    private on_move_item_move(event: cc.Vec2, _item: ItemTypeEnum, _id: number): void {\r\n        if (!gm.data.mapCell_data.isGuide) {\r\n            let cfgByID = gm.data.config_data.getItemCfgByID(_id);\r\n            if (_item == ItemTypeEnum.ITEM_TYPE && cfgByID && cfgByID.type == PropTypeEnum.SOUL_TYPE && !this.saleNode?.active) {\r\n                this.saleNode.active = true;\r\n                this._soulID = cfgByID.id;\r\n                this.barInfoNode.active = false;\r\n                this.lblFreeTime.node.active = false;\r\n                this.lblTips.string = cfgByID.lv < 3 ? \"绿魂以上\\n可召唤\" : \"召唤英雄\\n雕像\";\r\n                this.node.getComponent(cc.Animation).play(\"btnBuySuol_open\");\r\n                return;\r\n            }\r\n\r\n            if (!this.saleNode?.active || _item == ItemTypeEnum.BUILD_TYPE) {\r\n                this.saleNode.active = true;\r\n                this.barInfoNode.active = false;\r\n                this.lblFreeTime.node.active = false;\r\n\r\n                if (_item == ItemTypeEnum.ITEM_TYPE) {\r\n                    const cfgByID = gm.data.config_data.getItemCfgByID(_id);\r\n                    if (cfgByID) {\r\n                        this.lblSaleNum.string = cfgByID.price.toString();\r\n                    }\r\n                } else if (_item == ItemTypeEnum.HERO_TYPE) {\r\n                    const cfgByID = gm.data.config_data.getHeroCfgByID(_id);\r\n                    if (cfgByID) {\r\n                        this.lblSaleNum.string = cfgByID.price.toString();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private on_move_item_hide(event: cc.Vec2, cellID: number): void { // t: any, e: number\r\n        if (!gm.data.mapCell_data.isGuide) {\r\n            this.saleNode.active = false;\r\n            this.barInfoNode.active = true;\r\n            this.lblFreeTime.node.active = true;\r\n\r\n            if (this.node._hitTest(event)) { // ???????\r\n                if (0 < this._soulID) {\r\n                    const cfgByID = gm.data.config_data.getItemCfgByID(this._soulID);\r\n                    if (cfgByID && 0 < cfgByID.price) {\r\n                        gm.data.mapCell_data.randomStoneHero(cellID, cfgByID.price, gm.const.heroRandomList[cfgByID.lv]);\r\n                        gm.ui.emit(\"item_children_refresh\", cellID);\r\n                    }\r\n                } else {\r\n                    if (gm.data.mapCell_data.role_map_data[cellID].itemType == ItemTypeEnum.BUILD_TYPE) return;\r\n\r\n                    const itemId = gm.data.mapCell_data.role_map_data[cellID].itemID;\r\n                    gm.data.mapCell_data.delSingleSuperHeroCellID(itemId, cellID);\r\n                    gm.data.mapCell_data.delCellItemByCellID(cellID);\r\n                    gm.data.mapCell_data.setAddGameCoin(SetItemNumEnum.ADD_ITEM_TYPE, parseInt(this.lblSaleNum.string));\r\n                    gm.ui.show_coin_fly(RewardIdEnum.GOLD, this.node.convertToWorldSpaceAR(cc.Vec3.ZERO), parseInt(this.lblSaleNum.string));\r\n\r\n                    if (30000 < itemId) {\r\n                        const heroConfig = gm.data.config_data.getHeroCfgByID(itemId);\r\n                        if (heroConfig && 11 == heroConfig.occupation) {\r\n                            gm.ui.emit(\"build_show_towerBuff\");\r\n                        }\r\n                    }\r\n                    gm.ui.emit(\"item_children_refresh\", cellID);\r\n                }\r\n                this.noSpaceNode.active = !gm.data.mapCell_data.getMapHaveSpece();\r\n            }\r\n            if (0 < this._soulID) {\r\n                this.node.getComponent(cc.Animation).play(\"btnBuySuol_close\");\r\n                this.barInfoNode.active = true;\r\n                this.lblFreeTime.node.active = true;\r\n                this._soulID = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    private on_item_not_move_hide(): void {\r\n        if (!gm.data.mapCell_data.isGuide) {\r\n            this.saleNode.active = false;\r\n            this.barInfoNode.active = true;\r\n            this.lblFreeTime.node.active = true;\r\n\r\n            if (0 < this._soulID) {\r\n                this.node.getComponent(cc.Animation).play(\"btnBuySuol_close\");\r\n                this.barInfoNode.active = true;\r\n                this.lblFreeTime.node.active = true;\r\n                this._soulID = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    private showHandAnim(active: boolean = true): void {\r\n        TempData.map_have_hand = active;\r\n        if (!gm.data.mapCell_data.isGuide) {\r\n            this.handAnim.active = active;\r\n        }\r\n    }\r\n\r\n    private refreshBarrelNum(): void {\r\n        this.noSpaceNode.active = !gm.data.mapCell_data.getMapHaveSpece();\r\n        this.noBarrelNode.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && gm.data.mapCell_data.isGuide;\r\n        this.noBarrel2Node.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && !gm.data.mapCell_data.isGuide;\r\n\r\n        const barrelData = gm.data.mapCell_data.roleBarrelData;\r\n\r\n        if (gm.data.mapCell_data.isGuide) {\r\n            this.barInfoNode.active = false;\r\n            this.lblFreeTime.node.active = false;\r\n            this.lblNum.string = barrelData.curBarrelNum.toString();\r\n            this.lblFreeTime.string = \"\";\r\n            this.handAnim.active = false;\r\n\r\n            if (!gm.ui.newerGuideOp || !gm.ui.newerGuideOp.node.active) {\r\n                if (gm.data.mapCell_data.roleGuideVO.guideID === 8) {\r\n                    if (barrelData.curBarrelNum <= 3 && barrelData.curBarrelNum > 0) {\r\n                        this.handAnim.active = true;\r\n                    }\r\n                } else {\r\n                    this.handAnim.active = barrelData.curBarrelNum > 0;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (barrelData.curBarrelNum >= barrelData.maxBarrelNum) {\r\n            this.lblFreeTime.string = \"\";\r\n        } else {\r\n            this._reciveTime = 0;\r\n            if (this._reciveTime < gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime) {\r\n                this._reciveTime = gm.data.mapCell_data.roleBarrelData.nextFreeBarrelTime - gm.data.mapCell_data.roleBarrelData.curFreeBarrelTime;\r\n            }\r\n        }\r\n\r\n        this.barWidth.width = Math.min(barrelData.curBarrelNum / barrelData.maxBarrelNum * 125, 125);\r\n\r\n        if (0 < gm.data.mapCell_data.roleBarrelData.curBarrelNum) {\r\n            this.saleNode.active ? this.barInfoNode.active = false : this.barInfoNode.active = true;\r\n            this.lblNum.node.active = true;\r\n            this.lblNum.string = `${barrelData.curBarrelNum}/${Math.max(barrelData.maxBarrelNum, 40)}`;\r\n        } else {\r\n            this.lblNum.node.active = false;\r\n            this.barInfoNode.active = false;\r\n        }\r\n    }\r\n\r\n    private showBarrelInfo(): void {\r\n        this.handAnim.active = false;\r\n        const barrelData = gm.data.mapCell_data.roleBarrelData;\r\n\r\n        this.noBarrelNode.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && gm.data.mapCell_data.isGuide;\r\n        this.noBarrel2Node.active = gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0 && !gm.data.mapCell_data.isGuide;\r\n\r\n        if (gm.data.mapCell_data.isGuide) {\r\n            this.barInfoNode.active = false;\r\n            this.lblFreeTime.node.active = false;\r\n            this.lblNum.string = barrelData.curBarrelNum.toString();\r\n            this.lblFreeTime.string = \"\";\r\n            this.handAnim.active = false;\r\n\r\n            if (!gm.ui.newerGuideOp || !gm.ui.newerGuideOp.node.active) {\r\n                if (gm.data.mapCell_data.roleGuideVO.guideID === 8) {\r\n                    if (barrelData.curBarrelNum <= 3 && barrelData.curBarrelNum > 0) {\r\n                        this.handAnim.active = true;\r\n                    }\r\n                } else {\r\n                    this.handAnim.active = barrelData.curBarrelNum > 0;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        this._reciveTime = barrelData.nextFreeBarrelTime - Math.floor(Date.now() / 1000);\r\n        this.noSpaceNode.active = !gm.data.mapCell_data.getMapHaveSpece();\r\n        this.barWidth.width = Math.min(barrelData.curBarrelNum / barrelData.maxBarrelNum * 125, 125);\r\n\r\n        if (0 < barrelData.curBarrelNum) {\r\n            this.saleNode.active ? this.barInfoNode.active = false : this.barInfoNode.active = true;\r\n            this.lblNum.node.active = true;\r\n            this.lblNum.string = `${barrelData.curBarrelNum}/${Math.max(barrelData.maxBarrelNum, 40)}`;\r\n        } else {\r\n            this.lblNum.node.active = false;\r\n            this.barInfoNode.active = false;\r\n        }\r\n\r\n        if (barrelData.curBarrelNum >= barrelData.maxBarrelNum) {\r\n            this.lblFreeTime.string = \"\";\r\n        }\r\n    }\r\n\r\n    public onClickBuy(): void {\r\n        if (gm.data.mapCell_data.isGuide) {\r\n            this.handAnim.active = false;\r\n        }\r\n        console.log(\"TTTT\");\r\n        this.node.getComponent(cc.Animation).play(\"btnBuy_button\");\r\n\r\n        if (gm.data.mapCell_data.getIsHaveSpeceCellID()) {\r\n            if (gm.audio.play_effect(gm.const.AUDIO_159_MUTONGLUODI), 0 < gm.data.mapCell_data.roleBarrelData.curBarrelNum) {\r\n                gm.data.mapCell_data.buyBarrelNumTimes++;\r\n                gm.data.mapCell_data.reduceBarrelNum();\r\n                gm.data.mapCell_data.addBarrelInMap();\r\n\r\n                if (gm.data.mapCell_data.roleBarrelData.curBarrelNum <= 0) {\r\n                    this.isCd = true;\r\n                    this.unscheduleAllCallbacks();\r\n                    this.scheduleOnce(() => {\r\n                        this.isCd = false;\r\n                    }, 1);\r\n                }\r\n\r\n                if (gm.data.mapCell_data.buyBarrelNumTimes <= 50) {\r\n                    ReportData.instance.report_once_point(10200 + gm.data.mapCell_data.buyBarrelNumTimes);\r\n                }\r\n\r\n                gm.channel.report_event(\"buy_barrel\", {\r\n                    event_desc: \"购买木桶\",\r\n                    buy_count: gm.data.mapCell_data.buyBarrelNumTimes,\r\n                    task_desc: cc.js.formatStr(\"购买木桶%d次\", gm.data.mapCell_data.buyBarrelNumTimes)\r\n                });\r\n            } else {\r\n                if (gm.data.mapCell_data.isGuide) {\r\n                    gm.ui.show_notice(\"Bạn có thể xem video và mua thùng khi hướng dẫn hoàn tất\");\r\n                    return;\r\n                }\r\n\r\n                if (this.isCd) {\r\n                    gm.ui.show_notice(\"Không đủ thùng!!!\");\r\n                    return;\r\n                }\r\n\r\n                gm.channel.show_video_ad(() => {\r\n                    gm.data.mapCell_data.watch_ad_buy_barrel_times++;\r\n                    gm.data.mapCell_data.addBarrelNum(40);\r\n                    ReportData.instance.report_point(10301);\r\n                    ReportData.instance.report_once_point(10302);\r\n                    gm.channel.report_event(\"video_buy_barrel\", {\r\n                        event_desc: \"看视频购买木桶\",\r\n                        buy_count: gm.data.mapCell_data.watch_ad_buy_barrel_times,\r\n                        task_desc: cc.js.formatStr(\"购买木桶%d次\", gm.data.mapCell_data.watch_ad_buy_barrel_times)\r\n                    });\r\n                }, this);\r\n            }\r\n        } else {\r\n            gm.ui.show_auto_merge_message();\r\n        }\r\n\r\n        this.showBarrelInfo();\r\n    }\r\n}"]}