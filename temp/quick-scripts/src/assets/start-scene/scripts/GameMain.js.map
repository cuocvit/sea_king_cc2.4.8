{"version":3,"sources":["assets\\start-scene\\scripts\\GameMain.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// +-+\r\nimport { gm } from './GameManager';\r\nimport { GameObject } from './GameObject';\r\nimport { NetUtils, ReportData } from './NetUtils';\r\nimport { BrowserUtils } from './BrowserUtils';\r\nimport { GraphicsUtils } from './GraphicsUtils';\r\nimport { Launch, LoadingState } from './Launch';\r\n\r\nconst { ccclass } = cc._decorator;\r\n\r\n@ccclass(\"GameMain\")\r\nexport class GameMain extends GameObject {\r\n  private bg_node: cc.Node | null = null; // private ??\r\n  private notice_node: cc.Node | null = null; // private ??\r\n  private notice_txt: cc.RichText | null = null; // private ??\r\n\r\n  // @ (lifecycle method)\r\n  protected onLoad(): void {\r\n    console.log(\"GameMain->onLoad\", \"xxxxxxxxxxxxxxxxxxxxxxxx\");\r\n    // @\r\n    const self = this;\r\n    this.bg_node = cc.find(\"Canvas/bg_node\");\r\n    this.notice_node = cc.find(\"Canvas/bg_node/notice_node\");\r\n    if (this.notice_node) {\r\n      this.notice_txt = this.notice_node.getComponentInChildren(cc.RichText);\r\n    }\r\n    cc.macro.ENABLE_MULTI_TOUCH = true;\r\n    cc.macro.CLEANUP_IMAGE_CACHE = true;\r\n    cc.dynamicAtlasManager.enabled = false;\r\n    cc.assetManager.force = true;\r\n    cc.game.setFrameRate(30);\r\n    console.log(\"Gamemanager -> init\");\r\n    gm.init();\r\n    gm.channel.init();\r\n    gm.data.catch_error_log();\r\n    // @\r\n    if (cc.sys.isBrowser) {\r\n      console.log(\"--------------Browser debugging parameters start---------------\\n\\n\");\r\n      console.log(\"Version Number         version=1-n\");\r\n      console.log(\"Clear Save             clear=true|false\");\r\n      console.log(\"Combat Debugging       debug=true|false\");\r\n      console.log(\"\\n--------------Browser debugging parameters end-----------------\");\r\n      const version = Number(BrowserUtils.get_url_param_value(\"version\", 0));\r\n      if (NetUtils.get_version() < version) {\r\n        NetUtils.set_version(version.toString());\r\n        if (BrowserUtils.get_url_param_value(\"clear\", false)) {\r\n          gm.data.clear_store_data();\r\n        }\r\n      }\r\n    }\r\n    // @\r\n    console.log(\"GameMain->get_remote_config\", 1111111111);\r\n    gm.channel.get_remote_config(() => {\r\n      console.log(\"GameMain->get_remote_config\", 2222222222);\r\n      gm.data.priority_init(() => {\r\n        gm.data.event_emitter.on(\"connect_fail\", self.on_connect_fail_handler, self);\r\n        gm.channel.login(() => {\r\n          ReportData.instance.report_once_point(10020);\r\n          const uid: string = gm.data.server_data.uid;\r\n          const storedUid: string | null = cc.sys.localStorage.getItem(\"P2_UID\");\r\n          if (!storedUid) {\r\n            cc.sys.localStorage.setItem(\"P2_UID\", uid);\r\n          }\r\n          if (uid !== storedUid) {\r\n            cc.sys.localStorage.clear();\r\n            self.scheduleOnce(() => {\r\n              ReportData.instance.write_data();\r\n              NetUtils.save_game_uuid();\r\n              cc.sys.localStorage.setItem(\"P2_UID\", uid);\r\n              gm.data.main_data.clear();\r\n              gm.data.main_data.async_write_data();\r\n            });\r\n          }\r\n          //\r\n          gm.ui.init(() => {\r\n            Launch.instance.state = LoadingState.COMPLETE;\r\n            gm.channel.report_event(\"ohayoo_game_init\", {\r\n              initid: 2,\r\n              initname: \"Resource loading started\", // 资源加载开始\r\n              network: gm.channel.get_network_state_name(),\r\n              initresult: 0,\r\n              initerror: \"Resource loading started\" // 资源加载开始\r\n            });\r\n            //\r\n            gm.config.async_init(() => {\r\n              gm.config.load_all_config(() => {\r\n                gm.data.init(() => {\r\n                  if (gm.data.server_data.nickname === \"\") {\r\n                      gm.data.server_data.random_default_name((name: string) => {\r\n                          gm.data.server_data.nickname = name;\r\n                      });\r\n                  }\r\n                  //\r\n                  gm.data.server_data.open_polling();\r\n                  if (cc.sys.isBrowser) {\r\n                    gm.data.fight_temp_data.is_debug = BrowserUtils.get_url_param_value(\"debug\", false);\r\n                    GraphicsUtils.show_debug_draw = gm.data.fight_temp_data.is_debug;\r\n                  }\r\n                  //\r\n                  if (gm.data.fight_temp_data.is_debug) {\r\n                    gm.data.fight_temp_data.map_id = 2;\r\n                    gm.data.fight_temp_data.map_data_id = 1;\r\n                    gm.data.fight_temp_data.play_type = 0;\r\n                    gm.ui.show_fight();\r\n                  } else {\r\n                    gm.ui.show_start(function() {\r\n                      gm.data.get_player_score_data_request();\r\n                      ReportData.instance.report_once_point(10030);\r\n                      gm.channel.report_event(\"ohayoo_game_init\", {\r\n                        initid: 3,\r\n                        initname: \"Enter the main interface\", // 进入主界面\r\n                        network: gm.channel.get_network_state_name(),\r\n                        initresult: 0,\r\n                        initerror: \"Enter the main interface\" // 进入主界面\r\n                      });\r\n                    });\r\n                  }\r\n                }); // end: gm.data.init\r\n              }); // end: gm.config.load_all_config\r\n            }); // end: gm.config.async_init\r\n          }); // end: gm.ui.init\r\n        }); // end: gm.channel.login\r\n      }); // end: gm.data.priority_init\r\n    }); // end: gm.channel.get_remote_config\r\n  } // end: onLoad\r\n\r\n  // @\r\n  private on_connect_fail_handler(): void {\r\n    if (this.notice_node) this.notice_node.active = true;\r\n    if (this.notice_txt) {\r\n      this.notice_txt.string = \"Connection error, please check the network\"; // 连接错误，请检查网络\r\n    }\r\n    ReportData.instance.report_once_point(10040);\r\n  }\r\n}\r\n"]}