{"version":3,"sources":["assets\\test\\scripts\\Arrow.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAE5C,IAAY,eAGX;AAHD,WAAY,eAAe;IACvB,qEAAgB,CAAA;IAChB,qDAAQ,CAAA;AACZ,CAAC,EAHW,eAAe,GAAf,uBAAe,KAAf,uBAAe,QAG1B;AAGD;IAA2B,yBAAY;IAAvC;QAAA,qEAgFC;QA/EW,QAAE,GAAW,CAAC,EAAE,CAAC;QACjB,gBAAU,GAAW,GAAG,CAAC;QACzB,YAAM,GAAmB,IAAI,CAAC;QAC9B,cAAQ,GAAmB,IAAI,CAAC;QAChC,gBAAU,GAAmB,IAAI,CAAC;QAClC,YAAM,GAAW,CAAC,CAAC;QACnB,cAAQ,GAAW,CAAC,CAAC,CAAC;QACtB,UAAI,GAAW,CAAC,CAAC;QACjB,eAAS,GAAY,KAAK,CAAC;QAC3B,cAAQ,GAAmB,IAAI,CAAC;QAChC,YAAM,GAAmB,IAAI,CAAC;;IAqE1C,CAAC;cAhFY,KAAK;IAeJ,sBAAM,GAAhB;QACI,IAAI,CAAC,MAAM,GAAG,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QAC5B,IAAI,CAAC,QAAQ,GAAG,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QAC9B,IAAI,CAAC,UAAU,GAAG,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;IACpC,CAAC;IAEO,4BAAY,GAApB,UAAqB,OAAwB,EAAE,QAAiB,EAAE,MAAe;QAC7E,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAChB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACrC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAK,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACzD,IAAM,UAAU,GAAG,OAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACtD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,KAAK,eAAe,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACpE,IAAI,cAAc,GAAG,CAAC,CAAC;QACvB,IAAI,cAAc,GAAG,CAAC,CAAC;QAEvB,IAAI,IAAI,CAAC,QAAQ,KAAK,eAAe,CAAC,IAAI,EAAE;YACxC,cAAc,GAAG,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG,UAAU,CAAC;SAC9C;aAAM;YACH,cAAc,GAAG,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC;SAC1D;QAED,IAAI,CAAC,MAAM,GAAG,IAAI,EAAE,CAAC,IAAI,CACrB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,UAAU,GAAG,cAAc,EAC/D,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,UAAU,GAAG,cAAc,EAC/D,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC;QACpD,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;IAC1B,CAAC;IAEM,sBAAM,GAAb,UAAc,SAAiB;QAC3B,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,IAAI,CAAC,QAAQ,KAAK,eAAe,CAAC,IAAI,EAAE;gBACxC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,SAAS,CAAC,CAAC;aAC1D;iBAAM;gBACH,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC;aACtE;YAED,IAAM,eAAe,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;YAC3C,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,OAAK,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;YACpD,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,OAAK,CAAC,IAAI,EAAE,OAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAC1D,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,eAAe,EAAE,eAAe,EAAE,OAAK,CAAC,IAAI,CAAC,CAAC;YAE1D,IAAI,IAAI,CAAC,QAAQ,KAAK,eAAe,CAAC,IAAI,EAAE;gBACxC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;aACpG;iBAAM;gBACH,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;aACpG;YAED,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC;YACxC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;YACvC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAK,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;YAE3D,IAAI,OAAK,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,GAAG,EAAE;gBACzB,IAAI,CAAC,YAAY,EAAE,CAAC;aACvB;SACJ;IACL,CAAC;IAEO,4BAAY,GAApB;QACI,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACpC,CAAC;;IAlEc,UAAI,GAAY,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;IAbpC,KAAK;QADjB,OAAO;OACK,KAAK,CAgFjB;IAAD,YAAC;CAhFD,AAgFC,CAhF0B,EAAE,CAAC,SAAS,GAgFtC;AAhFY,sBAAK","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\nexport enum WEAPON_FLY_TYPE {\r\n    LEFT_PARABOL = 0,\r\n    LINE = 1\r\n}\r\n\r\n@ccclass\r\nexport class Arrow extends cc.Component {\r\n    private _g: number = -10;\r\n    private _shotSpeed: number = 400;\r\n    private _speed: cc.Vec3 | null = null;\r\n    private _gravity: cc.Vec3 | null = null;\r\n    private _currAngle: cc.Vec3 | null = null;\r\n    private _dTime: number = 0;\r\n    private _flyType: number = -1;\r\n    private _dir: number = 1;\r\n    private _isMoving: boolean = false;\r\n    private startPos: cc.Vec3 | null = null;\r\n    private endPos: cc.Vec3 | null = null;\r\n\r\n    private static vec3: cc.Vec3 = new cc.Vec3();\r\n\r\n    protected onLoad(): void {\r\n        this._speed = new cc.Vec3();\r\n        this._gravity = new cc.Vec3();\r\n        this._currAngle = new cc.Vec3();\r\n    }\r\n\r\n    private launchWeapon(flyType: WEAPON_FLY_TYPE, startPos: cc.Vec3, endPos: cc.Vec3): void {\r\n        this.startPos = startPos;\r\n        this.endPos = endPos;\r\n        this._flyType = flyType;\r\n        this._dTime = 0;\r\n        this.node.setPosition(this.startPos);\r\n        cc.Vec3.subtract(Arrow.vec3, this.startPos, this.endPos);\r\n        const travelTime = Arrow.vec3.mag() / this._shotSpeed;\r\n        this._dir = this._flyType === WEAPON_FLY_TYPE.LEFT_PARABOL ? -1 : 1;\r\n        let gravityOffsetY = 0;\r\n        let gravityOffsetX = 0;\r\n\r\n        if (this._flyType === WEAPON_FLY_TYPE.LINE) {\r\n            gravityOffsetY = .5 * this._g * travelTime;\r\n        } else {\r\n            gravityOffsetX = .5 * this._g * travelTime * this._dir;\r\n        }\r\n\r\n        this._speed = new cc.Vec3(\r\n            (this.endPos.x - this.startPos.x) / travelTime - gravityOffsetX,\r\n            (this.endPos.y - this.startPos.y) / travelTime - gravityOffsetY,\r\n            (this.endPos.z - this.startPos.z) / travelTime);\r\n        cc.Vec3.zero(this._gravity);\r\n        this._isMoving = true;\r\n    }\r\n\r\n    public update(deltaTime: number): void {\r\n        if (this._isMoving) {\r\n            if (this._flyType === WEAPON_FLY_TYPE.LINE) {\r\n                this._gravity.y = this._g * (this._dTime += deltaTime);\r\n            } else {\r\n                this._gravity.x = this._g * (this._dTime += deltaTime * this._dir);\r\n            }\r\n\r\n            const currentPosition = this.node.position;\r\n            cc.Vec3.add(Arrow.vec3, this._speed, this._gravity);\r\n            cc.Vec3.multiplyScalar(Arrow.vec3, Arrow.vec3, deltaTime);\r\n            cc.Vec3.add(currentPosition, currentPosition, Arrow.vec3);\r\n\r\n            if (this._flyType === WEAPON_FLY_TYPE.LINE) {\r\n                this._currAngle.x = 180 * Math.atan((this._speed.y + this._gravity.y) / this._speed.z) / Math.PI;\r\n            } else {\r\n                this._currAngle.y = 180 * Math.atan((this._speed.x + this._gravity.x) / this._speed.z) / Math.PI;\r\n            }\r\n\r\n            this.node.eulerAngles = this._currAngle;\r\n            this.node.setPosition(currentPosition);\r\n            cc.Vec3.subtract(Arrow.vec3, this.endPos, currentPosition);\r\n\r\n            if (Arrow.vec3.mag() <= 0.3) {\r\n                this.arriveTarget();\r\n            }\r\n        }\r\n    }\r\n\r\n    private arriveTarget(): void {\r\n        this._isMoving = false;\r\n        console.warn(\"达到终点～～～～～～～～～～～\");\r\n    }\r\n}"]}