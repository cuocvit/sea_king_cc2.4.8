{"version":3,"sources":["assets\\fight\\scripts\\FightHeroShowItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// file này ko đc import ở đâu\r\nimport { ListViewItem } from '../../start-scene/scripts/ListViewItem';\r\nimport { HeroInBattleState } from '../../start-scene/scripts/FightConstants';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { Utils } from '../../start-scene/scripts/Utils';\r\nimport { BundleName } from '../../start-scene/scripts/Constants';\r\nimport { FightHeroItemData } from '../../start-scene/scripts/FightTempData';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass FightHeroShowItem extends ListViewItem {\r\n    @property(cc.Sprite)\r\n    private color_spr: cc.Sprite = null;\r\n\r\n    @property(cc.Widget)\r\n    private mask_widget: cc.Widget = null;\r\n\r\n    @property(cc.Sprite)\r\n    private hero_spr: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    private lv_spr: cc.Sprite = null;\r\n\r\n    @property(cc.ProgressBar)\r\n    private hp_prg: cc.ProgressBar = null;\r\n\r\n    @property(cc.Node)\r\n    private in_battle_node: cc.Node = null;\r\n\r\n    @property(cc.Button)\r\n    private black_btn: cc.Button = null;\r\n\r\n    public _data: FightHeroItemData;\r\n\r\n    public get data(): FightHeroItemData {\r\n        return this._data;\r\n    }\r\n\r\n    public set data(value: FightHeroItemData) {\r\n        this._data = value;\r\n        this.update_view();\r\n    }\r\n\r\n    public get in_battle_state(): HeroInBattleState {\r\n        return this._data ? this._data.in_battle_state : HeroInBattleState.NOT_IN_BATTLE;\r\n    }\r\n\r\n    public set in_battle_state(value: HeroInBattleState) {\r\n        if (!this._data) return;\r\n        this._data.in_battle_state = value;\r\n        this.in_battle_node.active = value == HeroInBattleState.WILL_IN_BATTLE;\r\n        this.black_btn.node.active = value == HeroInBattleState.NOT_IN_BATTLE;\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        gm.data.event_emitter.on(\"fight_in_battle\", this.on_fight_in_battle_handler, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.data.event_emitter.off(\"fight_in_battle\", this.on_fight_in_battle_handler, this);\r\n    }\r\n\r\n    public update_view(): void {\r\n        Utils.async_set_sprite_frame(this.color_spr, BundleName.COMMON, \"res/color_\" + this._data.lv);\r\n        Utils.async_set_sprite_frame(this.hero_spr, BundleName.COMMON, \"res/handbook/\" + this._data.id);\r\n        Utils.async_set_sprite_frame(this.lv_spr, BundleName.FIGHT, \"res/lv_\" + this._data.lv);\r\n        this.hp_prg.progress = this._data.max_hp > 0 ? this._data.hp / this._data.max_hp : 0;\r\n        this.in_battle_state = this._data.in_battle_state;\r\n\r\n        const height = this._data.in_battle_state == HeroInBattleState.HAS_IN_BATTLE ? 80 : 128;\r\n        if (height !== this.color_spr.node.height) {\r\n            this.color_spr.node.height = height;\r\n            this.mask_widget.updateAlignment();\r\n        }\r\n        Utils.set_sprite_state(this.node, this._data.hp <= 0 ? cc.Sprite.State.GRAY : cc.Sprite.State.NORMAL, true);\r\n    }\r\n\r\n    private on_fight_in_battle_handler(eventData: FightHeroItemData): void {\r\n        if (eventData.in_battle_state !== HeroInBattleState.HAS_IN_BATTLE && this._data.in_battle_state !== HeroInBattleState.HAS_IN_BATTLE) {\r\n            this._data.in_battle_state = eventData == this._data ? HeroInBattleState.WILL_IN_BATTLE : HeroInBattleState.NOT_IN_BATTLE;\r\n            this.update_view();\r\n        } else if (eventData == this._data) {\r\n            this.update_view();\r\n        }\r\n    }\r\n\r\n    public reset(): void {\r\n        this.color_spr.spriteFrame = null;\r\n        this.hero_spr.spriteFrame = null;\r\n        this.lv_spr.spriteFrame = null;\r\n        this.in_battle_node.active = false;\r\n        this.black_btn.node.active = true;\r\n    }\r\n\r\n    protected editor_on_button_click_handler(event: cc.Event): void {\r\n        if (event.target == this.black_btn.node && this._data.in_battle_state == HeroInBattleState.NOT_IN_BATTLE) {\r\n            gm.data.fight_temp_data.in_battle_hero_data = this._data;\r\n            gm.data.event_emitter.emit(\"fight_in_battle\", this._data);\r\n        }\r\n    }\r\n}\r\n"]}