{"version":3,"sources":["assets\\settings\\scripts\\Rename.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BANNER_AD_TYPE } from '../../start-scene/scripts/ChannelManager';\r\nimport { RewardIdEnum } from '../../start-scene/scripts/Constants';\r\nimport { SettingsData } from '../../start-scene/scripts/SettingsData';\r\nimport { gm } from '../../start-scene/scripts/GameManager';\r\nimport { GameModule } from '../../start-scene/scripts/GameModule';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nclass Rename extends GameModule {\r\n    @property(cc.Button)\r\n    private close_btn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private anywhere_close_btn: cc.Button = null;\r\n\r\n    @property(cc.EditBox)\r\n    private name_edit: cc.EditBox = null;\r\n\r\n    @property(cc.RichText)\r\n    private tip_txt: cc.RichText = null;\r\n\r\n    @property(cc.Button)\r\n    private ok_btn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private random_btn: cc.Button = null;\r\n\r\n    @property(cc.Node)\r\n    private diamond_node: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    private diamond_lbl: cc.Label = null;\r\n\r\n    protected onEnable(): void {\r\n        gm.data.event_emitter.on(SettingsData.EVENT_DATA_CHANGE, this.update_view, this);\r\n        this.update_view();\r\n        gm.channel.show_banner_ad(BANNER_AD_TYPE.ALL);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        gm.data.event_emitter.off(SettingsData.EVENT_DATA_CHANGE, this.update_view, this);\r\n        gm.channel.hide_banner_ad(BANNER_AD_TYPE.ALL);\r\n    }\r\n\r\n    public update_view(): void {\r\n        this.name_edit.placeholderLabel.string = gm.data.server_data.nickname;\r\n        this.name_edit.string = \"\";\r\n        this.tip_txt.node.active = 0 == gm.data.server_data.free_rename;\r\n        this.diamond_node.active = 0 < gm.data.server_data.free_rename;\r\n        this.diamond_lbl.string = \"x\" + gm.const.RENAME_DIAMOND_PRICE;\r\n    }\r\n\r\n    private editor_on_button_click_handler(event: cc.Event): void {\r\n        if (event.target == this.close_btn.node || event.target == this.anywhere_close_btn.node) {\r\n            gm.ui.async_hide_module(gm.const.Rename);\r\n\r\n        } else if (event.target == this.ok_btn.node) {\r\n            const nickname = this.name_edit.string.trim()\r\n            if (\"\" != nickname) {\r\n                gm.data.server_data.rename_nickname(nickname, () => {\r\n                    if (0 == gm.data.server_data.free_rename) {\r\n                        gm.data.server_data.nickname = nickname;\r\n                        gm.data.server_data.free_rename = 1;\r\n                    } else {\r\n                        if (gm.data.mapCell_data.roleCoinData.diamondNum < 50) {\r\n                            gm.ui.set_module_args(gm.const.GETCOINOP.key, true);\r\n                            gm.ui.show_panel(gm.const.GETCOINOP);\r\n                            return;\r\n                        }\r\n                        gm.data.server_data.nickname = nickname;\r\n                        gm.data.mapCell_data.delCellItem(RewardIdEnum.DIAMOND, gm.const.RENAME_DIAMOND_PRICE);\r\n                    }\r\n                    gm.ui.show_notice(\"Thay đổi tên thành công!!\");\r\n                    gm.data.settings_data.async_write_data();\r\n                    this.update_view();\r\n                    gm.ui.async_hide_module(gm.const.Rename);\r\n                })\r\n            } else {\r\n                gm.ui.show_notice(\"Tên không được để trống!!\");\r\n            }\r\n        } else if (event.target == this.random_btn.node) {\r\n            this.name_edit.string = gm.data.server_data.random_nickname();\r\n        }\r\n    }\r\n}"]}